!function(){(function(){var t;t=function(){function t(e){return e instanceof t||"object"==typeof e&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.voxels?(this.voxels=e.voxels,this.x=e.x,this.y=e.y,this.z=e.z,!0):void 0}return t.prototype.verify=function(){var t,e,r,o,s,n,i,a,l,h,c,u,d,g,p,b;if(null==this.x||null==this.y||null==this.z||null==this.voxels)return!1;if(!(this.x>0&&this.y>0&&this.z>0&&Array.isArray(this.voxels)))return!1;if(this.voxels.length>this.z)return!1;for(h=this.voxels,o=0,i=h.length;i>o;o++){if(r=h[o],!Array.isArray(r)||r.length>this.y)return!1;for(s=0,a=r.length;a>s;s++){if(e=r[s],!Array.isArray(e)||e.length>this.x)return!1;for(n=0,l=e.length;l>n;n++){if(t=e[n],"object"!=typeof t)return!1;if(!("number"==typeof t.r&&0<=(c=t.r)&&255>=c))return!1;if(!("number"==typeof t.g&&0<=(u=t.g)&&255>=u))return!1;if(!("number"==typeof t.b&&0<=(d=t.b)&&255>=d))return!1;if(!("number"==typeof t.a&&0<=(g=t.a)&&255>=g))return!1;if("number"!=typeof t.t||!(0<=(p=t.t)&&4>=p||7===t.t))return!1;if("number"!=typeof t.s||!(0<=(b=t.s)&&3>=b||7===t.s))return!1}}}return!0},t.prototype.rotateX=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,g;for(e=this.voxels.slice(0),this.voxels=[],s=n=0,l=this.z;l>n;s=n+=1)for(o=i=0,h=this.y;h>i;o=i+=1)for(r=a=0,c=this.x;c>a;r=a+=1)null!=(null!=(u=e[t?this.z-s-1:s])&&null!=(d=u[t?o:this.y-o-1])?d[r]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][s]&&(this.voxels[o][s]=[]),this.voxels[o][s][r]=e[t?this.z-s-1:s][t?o:this.y-o-1][r]);return g=[this.y,this.z],this.z=g[0],this.y=g[1],g},t.prototype.rotateY=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,g;for(e=this.voxels.slice(0),this.voxels=[],s=n=0,l=this.z;l>n;s=n+=1)for(o=i=0,h=this.y;h>i;o=i+=1)for(r=a=0,c=this.x;c>a;r=a+=1)null!=(null!=(u=e[t?this.z-s-1:s])&&null!=(d=u[o])?d[t?r:this.x-r-1]:void 0)&&(null==this.voxels[r]&&(this.voxels[r]=[]),null==this.voxels[r][o]&&(this.voxels[r][o]=[]),this.voxels[r][o][s]=e[t?this.z-s-1:s][o][t?r:this.x-r-1]);return g=[this.x,this.z],this.z=g[0],this.x=g[1],g},t.prototype.rotateZ=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,g;for(e=this.voxels.slice(0),this.voxels=[],s=n=0,l=this.z;l>n;s=n+=1)for(o=i=0,h=this.y;h>i;o=i+=1)for(r=a=0,c=this.x;c>a;r=a+=1)null!=(null!=(u=e[s])&&null!=(d=u[t?o:this.y-o-1])?d[t?this.x-r-1:r]:void 0)&&(null==this.voxels[s]&&(this.voxels[s]=[]),null==this.voxels[s][r]&&(this.voxels[s][r]=[]),this.voxels[s][r][o]=e[s][t?o:this.y-o-1][t?this.x-r-1:r]);return g=[this.x,this.y],this.y=g[0],this.x=g[1],g},t.prototype.mirrorX=function(){var t,e,r,o,s,n,i;for(t=this.voxels.slice(0),this.voxels=[],i=[],o=s=0,n=this.z;n>s;o=s+=1)i.push(function(){var s,n,i;for(i=[],r=s=0,n=this.y;n>s;r=s+=1)i.push(function(){var s,n,i,a,l;for(l=[],e=s=0,n=this.x;n>s;e=s+=1)null!=(null!=(i=t[o])&&null!=(a=i[r])?a[this.x-e-1]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][r]&&(this.voxels[o][r]=[]),l.push(this.voxels[o][r][e]=t[o][r][this.x-e-1]));return l}.call(this));return i}.call(this));return i},t.prototype.mirrorY=function(){var t,e,r,o,s,n,i;for(t=this.voxels.slice(0),this.voxels=[],i=[],o=s=0,n=this.z;n>s;o=s+=1)i.push(function(){var s,n,i;for(i=[],r=s=0,n=this.y;n>s;r=s+=1)i.push(function(){var s,n,i,a,l;for(l=[],e=s=0,n=this.x;n>s;e=s+=1)null!=(null!=(i=t[o])&&null!=(a=i[this.y-r-1])?a[e]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][r]&&(this.voxels[o][r]=[]),l.push(this.voxels[o][r][e]=t[o][this.y-r-1][e]));return l}.call(this));return i}.call(this));return i},t.prototype.mirrorZ=function(){var t,e,r,o,s,n,i;for(t=this.voxels.slice(0),this.voxels=[],i=[],o=s=0,n=this.z;n>s;o=s+=1)i.push(function(){var s,n,i;for(i=[],r=s=0,n=this.y;n>s;r=s+=1)i.push(function(){var s,n,i,a,l;for(l=[],e=s=0,n=this.x;n>s;e=s+=1)null!=(null!=(i=t[this.z-o-1])&&null!=(a=i[r])?a[e]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][r]&&(this.voxels[o][r]=[]),l.push(this.voxels[o][r][e]=t[this.z-o-1][r][e]));return l}.call(this));return i}.call(this));return i},t}(),"object"==typeof module?module.exports=t:window.IO=t}).call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};t=function(t){function e(t,r){var o;e.__super__.constructor.call(this,t)||(this.voxels=[],this.x=this.y=this.z=-1,this.loadingState=0,o=new FileReader,o.onloadend=function(e){return function(){var s,n,i;return e.readFile(o.result,0),null!=t.a?(s=new FileReader,s.onloadend=function(){return e.readFile(s.result,1),2===e.loadingState++?r():void 0},console.log("reading alpha file with name: "+t.a.name),s.readAsArrayBuffer(t.a)):e.loadingState++,null!=t.t?(i=new FileReader,i.onloadend=function(){return e.readFile(i.result,2),2===e.loadingState++?r():void 0},console.log("reading type file with name: "+t.t.name),i.readAsArrayBuffer(t.t)):e.loadingState++,null!=t.s?(n=new FileReader,n.onloadend=function(){return e.readFile(n.result,3),2===e.loadingState++?r():void 0},console.log("reading specular file with name: "+t.s.name),n.readAsArrayBuffer(t.s)):e.loadingState++,3===e.loadingState?r():void 0}}(this),console.log("reading file with name: "+t.m.name),o.readAsArrayBuffer(t.m))}return r(e,t),e.prototype.readFile=function(t,e){var r,o,s,n,i,a,l,h,c,u,d,g,p,b,f,v,x,y,w,m,E,$,z,M,A,T,R,k,C,I,O,S,H,U,V,L,_,j,B,D,P,q;if(console.log("file.byteLength: "+t.byteLength),j=new Uint32Array(t.slice(0,24)),M=j[0],o=j[1],C=j[2],s=j[3],A=j[4],m=j[5],console.log("version: "+M+" (expected 257 = 1.1.0.0 = current version)"),257!==M&&console.warn("Expected version 257 but found version: "+M+" (May result in errors)"),console.log("color format: "+o+" (0 for RGBA (recommended) or 1 for BGRA)"),console.log("z-axis oriantation: "+C+" (0 for left (recommended), 1 for right handed)"),console.log("compression: "+s+" (0 for uncompressed, 1 for compressed with run length encoding (RLE))"),console.log("visability mask: "+A+" (should be 0 for encoded in A value, no partially visability)"),0!==A&&console.warn("partially visability not supported and will be ignored / handled as full visibility"),console.log("matrix count:  "+m),m>1&&console.warn("matrices will be merged into one matrix with regard to their offsets"),l=c=d=0,m>1)for(E=24,g=I=1;m>=I;g=I+=1)if(z=new Uint8Array(t.slice(E,E+1))[0],B=new Uint32Array(t.slice(E+1+z,E+13+z)),T=B[0],R=B[1],k=B[2],D=new Int32Array(t.slice(E+13+z,E+25+z)),a=D[0],h=D[1],u=D[2],l=Math.min(l,a),c=Math.min(c,h),d=Math.min(d,u),0===s)E+=25+z+4*T*R*k;else{for(p=0,i=new Uint8Array(t.slice(E+25+z)),x=O=0;k>O;x=O+=1)for(;;){if(p+=4,6===i[p-4]&&0===i[p-3]&&0===i[p-2]&&0===i[p-1])break;2===i[p-4]&&0===i[p-3]&&0===i[p-2]&&0===i[p-1]&&(p+=8)}E+=25+z+p}for(w=24,g=S=1;m>=S;g=S+=1)if(console.log("------------------------ Matrix: "+g+" ------------------------"),z=new Uint8Array(t.slice(w,w+1))[0],$=function(){var e,o,s,n;for(s=new Uint8Array(t.slice(w+1,w+1+z)),n=[],e=0,o=s.length;o>e;e++)r=s[e],n.push(String.fromCharCode(r));return n}().join(""),console.log("reading "+g+". matrix with name: "+$),P=new Uint32Array(t.slice(w+1+z,w+13+z)),T=P[0],R=P[1],k=P[2],console.log("dimensions: width: "+T+" height: "+R+" depth: "+k),q=new Int32Array(t.slice(w+13+z,w+25+z)),a=q[0],h=q[1],u=q[2],console.log("position: dx : "+a+" dy: "+h+" dz: "+u+" (ignored if only 1 matrix)"),1===m&&(a=h=u=0),m>1&&(a-=l,h-=c,u-=d),console.log("position result: dx : "+a+" dy: "+h+" dz: "+u),0===e&&(this.x=Math.max(this.x,T+a),this.y=Math.max(this.y,R+h),this.z=Math.max(this.z,k+u)),0===s){for(i=new Uint8Array(t.slice(w+25+z,w+25+z+4*T*R*k)),x=H=0;k>H;x=H+=1)for(v=U=0;R>U;v=U+=1)for(f=V=0;T>V;f=V+=1)p=4*(x*R*T+v*T+f),i[p+3]>0&&this.addValues(e,f+a,v+h,k,x,u,C,i[p],i[p+1],i[p+2],o);w+=25+z+4*T*R*k}else{for(i=new Uint8Array(t.slice(w+25+z)),p=0,x=L=0;k>L;x=L+=1)for(b=0;;){if(p+=4,6===i[p-4]&&0===i[p-3]&&0===i[p-2]&&0===i[p-1])break;if(2===i[p-4]&&0===i[p-3]&&0===i[p-2]&&0===i[p-1]){if(n=new Uint32Array(new Uint8Array([i[p],i[p+1],i[p+2],i[p+3]]).buffer)[0],n>255&&console.log("high voxel repeat count: "+n),i[p+7]>0)for(y=_=0;n>_;y=_+=1)f=b%T,v=Math.floor(b/T),b++,this.addValues(e,f+a,v+h,k,x,u,C,i[p+4],i[p+5],i[p+6],o);else b+=n;p+=8}else f=b%T,v=Math.floor(b/T),b++,i[p-1]>0&&this.addValues(e,f+a,v+h,k,x,u,C,i[p-4],i[p-3],i[p-2],o)}w+=25+z+p}return console.log("voxels:"),console.log(this.voxels),w!==t.byteLength?console.warn(console.log("There shouldn't be any bytes left")):void 0},e.prototype.addValues=function(t,e,r,o,s,n,i,a,l,h,c){var u;switch(o=(0===i?s:o-s-1)+n,1===c&&(u=[h,a],a=u[0],h=u[1]),t){case 0:return this.addColorValues(e,r,o,a,l,h);case 1:return this.addAlphaValues(e,r,o,a,l,h);case 2:return this.addTypeValues(e,r,o,a,l,h);case 3:return this.addSpecularValues(e,r,o,a,l,h)}},e.prototype.addColorValues=function(t,e,r,o,s,n){return null==this.voxels[r]&&(this.voxels[r]=[]),null==this.voxels[r][e]&&(this.voxels[r][e]=[]),this.voxels[r][e][t]={r:o,g:s,b:n,a:255,t:0,s:0}},e.prototype.addAlphaValues=function(t,e,r,o,s,n){var i,a;return null==(null!=(i=this.voxels[r])&&null!=(a=i[e])?a[t]:void 0)?console.warn("Ignoring alpha voxel because of non existing color voxel at the same position"):o===s&&s===n?16===o||48===o||80===o||112===o||144===o||176===o||208===o||240===o||255===o?this.voxels[r][e][t].a=o:(console.warn("invalid alpha value: falling back to fully opaque"),this.voxels[r][e][t].a=255):o===n&&255===n&&0===s?this.voxels[r][e][t].a=255:(console.warn("invalid alpha value: r, g and b are not equal, falling back to fully opaque"),this.voxels[r][e][t].a=255)},e.prototype.addTypeValues=function(t,e,r,o,s,n){var i,a;return null==(null!=(i=this.voxels[r])&&null!=(a=i[e])?a[t]:void 0)?console.warn("Ignoring type voxel because of non existing color voxel at the same position"):255===o&&255===s&&255===n?this.voxels[r][e][t].t=0:128===o&&128===s&&128===n?this.voxels[r][e][t].t=1:64===o&&64===s&&64===n?this.voxels[r][e][t].t=2:255===o&&0===s&&0===n?this.voxels[r][e][t].t=3:255===o&&255===s&&0===n?this.voxels[r][e][t].t=4:255===o&&0===s&&255===n?this.voxels[r][e][t].t=7:(console.warn("invalid type value (r: "+o+", g: "+s+", b: "+n+"), falling back to solid"),this.voxels[r][e][t].t=0)},e.prototype.addSpecularValues=function(t,e,r,o,s,n){var i,a;return null==(null!=(i=this.voxels[r])&&null!=(a=i[e])?a[t]:void 0)?console.warn("Ignoring specular voxel because of non existing color voxel at the same position"):128===o&&0===s&&0===n?this.voxels[r][e][t].s=0:0===o&&128===s&&0===n?this.voxels[r][e][t].s=1:0===o&&0===s&&128===n?this.voxels[r][e][t].s=2:128===o&&128===s&&0===n?this.voxels[r][e][t].s=3:255===o&&0===s&&255===n?this.voxels[r][e][t].s=7:(console.warn("invalid specular value (r: "+o+", g: "+s+", b: "+n+"), falling back to rough"),this.voxels[r][e][t].s=0)},e.prototype.export=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,g,p,b,f,v,x,y,w,m,E,$,z,M,A,T,R,k,C,I,O,S,H,U,V,L,_,j;if(n=[1,1,0,0,0,0,0,0,0,0,0,0,+t,0,0,0,0,0,0,0,1,0,0,0,5,77,157,144,145,154,this.x,0,0,0,this.y,0,0,0,this.z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=n.slice(0),l=n.slice(0),a=n.slice(0),c=function(t){return null!=t?(n=n.concat([t.r,t.g,t.b,255]),i=i.concat(function(){switch(!1){case!(7===t.t&&7===t.s):return[255,0,255,255];case 255!==t.a:return[255,255,255,255];case!(t.a>224):return[240,240,240,255];case!(t.a>192):return[208,208,208,255];case!(t.a>160):return[176,176,176,255];case!(t.a>128):return[144,144,144,255];case!(t.a>96):return[112,112,112,255];case!(t.a>64):return[80,80,80,255];case!(t.a>32):return[48,48,48,255];default:return[16,16,16,255]}}()),l=l.concat(function(){switch(t.t){case 0:return[255,255,255,255];case 1:return[128,128,128,255];case 2:return[64,64,64,255];case 3:return[255,0,0,255];case 4:return[255,255,0,255];case 7:return[255,0,255,255];default:return[255,255,255,255]}}()),a=a.concat(function(){switch(t.s){case 0:return[128,0,0,255];case 1:return[0,128,0,255];case 2:return[0,0,128,255];case 3:return[128,128,0,255];case 7:return[255,0,255,255];default:return[128,0,0,255]}}())):(n=n.concat([0,0,0,0]),i=i.concat([0,0,0,0]),l=l.concat([0,0,0,0]),a=a.concat([0,0,0,0]))},h=function(t,e){var r,o,s,n;if(null==t&&null==e)return!0;if(null==t||null==e)return!1;for(n=["r","g","b","a","t","s"],o=0,s=n.length;s>o;o++)if(r=n[o],t[r]!==e[r])return!1;return!0},t)for(x=y=0,T=this.z;T>y;x=y+=1){if(null!=this.voxels[x]){for(b=[],d=-1,v=w=0,R=this.y;R>w;v=w+=1)for(f=m=0,I=this.x;I>m;f=m+=1)b.push(null!=(O=this.voxels[x][v])?O[f]:void 0),null!=(null!=(S=this.voxels[x][v])?S[f]:void 0)&&(d=b.length-1);for(u=0;d>=u;){for(g=1;d>=u+g&&h(b[u+g-1],b[u+g]);)g++;g>1&&(H=new Uint8Array(new Uint32Array([g]).buffer),e=H[0],r=H[1],o=H[2],s=H[3],n=n.concat([2,0,0,0,e,r,o,s]),i=i.concat([2,0,0,0,e,r,o,s]),l=l.concat([2,0,0,0,e,r,o,s]),a=a.concat([2,0,0,0,e,r,o,s])),c(b[u]),u+=g}}n=n.concat([6,0,0,0]),i=i.concat([6,0,0,0]),l=l.concat([6,0,0,0]),a=a.concat([6,0,0,0])}else for(x=E=0,U=this.z;U>E;x=E+=1)for(v=z=0,V=this.y;V>z;v=z+=1)for(f=M=0,L=this.x;L>M;f=M+=1)c(null!=(_=this.voxels[x])&&null!=(k=_[v])?k[f]:void 0);for(console.log("export Qubicle:"),console.log(n),C=[n,i,l,a],j=[],A=0,$=C.length;$>A;A++)p=C[A],j.push(URL.createObjectURL(new Blob([new Uint8Array(p)],{type:"application/octet-binary"})));return j},e}(IO),"object"==typeof module?module.exports=t:window.QubicleIO=t}.call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};t=function(t){function e(t,r){var o;e.__super__.constructor.call(this,t)||(o=new FileReader,o.onloadend=function(t){return function(){var e,s,n,i,a,l,h,c,u,d,g,p,b,f,v,x,y,w,m,E,$,z,M,A,T,R,k,C;if(e=o.result,g=function(){var t,r,o,n;for(o=new Uint8Array(e.slice(0,4)),n=[],t=0,r=o.length;r>t;t++)s=o[t],n.push(String.fromCharCode(s));return n}().join(""),console.log("meta: "+g+" (expected VOX )"),"VOX "!==g)throw new Error("Expected Magica Voxel header not found");if(m=new Uint32Array(e.slice(4,8))[0],console.log("version: "+m+" (expected 150)"),150!==m&&console.warn("Expected version 150 but found version: "+m+" (May result in errors)"),u=function(){var t,r,o,n;for(o=new Uint8Array(e.slice(8,12)),n=[],t=0,r=o.length;r>t;t++)s=o[t],n.push(String.fromCharCode(s));return n}().join(""),console.log("mainChunkId: "+u+" (expected MAIN)"),"MAIN"!==u)throw new Error("Didn't found main Chunk as expected");for(T=new Uint32Array(e.slice(12,20)),d=T[0],c=T[1],console.log("mainChunkSize: "+d+" (expected 0)"),console.log("mainChunkChildSize: "+c),20+c!==e.byteLength&&console.warn(console.log("There shouldn't be any bytes left")),a=20+d,y=w=E=z=b=f=-1;20+d+c>a;){switch(i=function(){var t,r,o,n;for(o=new Uint8Array(e.slice(a,a+4)),n=[],t=0,r=o.length;r>t;t++)s=o[t],n.push(String.fromCharCode(s));return n}().join(""),console.log(new Uint8Array(e.slice(a,a+12))),R=new Uint32Array(e.slice(a+4,a+12)),l=R[0],n=R[1],console.log("found child chunk: "+i+" with begin: "+(a+12)+", size: "+l+" and childSize: "+n+" (expected 0)"),i){case"SIZE":12!==l&&console.warn("invalid length of size chunk"),y=a+12,w=y+l;break;case"XYZI":E=a+12,z=E+l;break;case"RGBA":b=a+12,1024!==l&&console.warn("invalid length of palette chunk"),f=l}a+=12+l+n}if(-1===y||-1===w||-1===E||-1===z)throw new Error("missing chunks");if(k=new Uint32Array(e.slice(y,w)),t.x=k[0],t.y=k[1],t.z=k[2],console.log("dimensions: width: "+t.x+" height: "+t.y+" depth: "+t.z),p=[],-1===b||-1===f)p=[{r:255,g:255,b:255,a:255,t:0,s:0},{r:255,g:255,b:204,a:255,t:0,s:0},{r:255,g:255,b:153,a:255,t:0,s:0},{r:255,g:255,b:102,a:255,t:0,s:0},{r:255,g:255,b:51,a:255,t:0,s:0},{r:255,g:255,b:0,a:255,t:0,s:0},{r:255,g:204,b:255,a:255,t:0,s:0},{r:255,g:204,b:204,a:255,t:0,s:0},{r:255,g:204,b:153,a:255,t:0,s:0},{r:255,g:204,b:102,a:255,t:0,s:0},{r:255,g:204,b:51,a:255,t:0,s:0},{r:255,g:204,b:0,a:255,t:0,s:0},{r:255,g:153,b:255,a:255,t:0,s:0},{r:255,g:153,b:204,a:255,t:0,s:0},{r:255,g:153,b:153,a:255,t:0,s:0},{r:255,g:153,b:102,a:255,t:0,s:0},{r:255,g:153,b:51,a:255,t:0,s:0},{r:255,g:153,b:0,a:255,t:0,s:0},{r:255,g:102,b:255,a:255,t:0,s:0},{r:255,g:102,b:204,a:255,t:0,s:0},{r:255,g:102,b:153,a:255,t:0,s:0},{r:255,g:102,b:102,a:255,t:0,s:0},{r:255,g:102,b:51,a:255,t:0,s:0},{r:255,g:102,b:0,a:255,t:0,s:0},{r:255,g:51,b:255,a:255,t:0,s:0},{r:255,g:51,b:204,a:255,t:0,s:0},{r:255,g:51,b:153,a:255,t:0,s:0},{r:255,g:51,b:102,a:255,t:0,s:0},{r:255,g:51,b:51,a:255,t:0,s:0},{r:255,g:51,b:0,a:255,t:0,s:0},{r:255,g:0,b:255,a:255,t:0,s:0},{r:255,g:0,b:204,a:255,t:0,s:0},{r:255,g:0,b:153,a:255,t:0,s:0},{r:255,g:0,b:102,a:255,t:0,s:0},{r:255,g:0,b:51,a:255,t:0,s:0},{r:255,g:0,b:0,a:255,t:0,s:0},{r:204,g:255,b:255,a:255,t:0,s:0},{r:204,g:255,b:204,a:255,t:0,s:0},{r:204,g:255,b:153,a:255,t:0,s:0},{r:204,g:255,b:102,a:255,t:0,s:0},{r:204,g:255,b:51,a:255,t:0,s:0},{r:204,g:255,b:0,a:255,t:0,s:0},{r:204,g:204,b:255,a:255,t:0,s:0},{r:204,g:204,b:204,a:255,t:0,s:0},{r:204,g:204,b:153,a:255,t:0,s:0},{r:204,g:204,b:102,a:255,t:0,s:0},{r:204,g:204,b:51,a:255,t:0,s:0},{r:204,g:204,b:0,a:255,t:0,s:0},{r:204,g:153,b:255,a:255,t:0,s:0},{r:204,g:153,b:204,a:255,t:0,s:0},{r:204,g:153,b:153,a:255,t:0,s:0},{r:204,g:153,b:102,a:255,t:0,s:0},{r:204,g:153,b:51,a:255,t:0,s:0},{r:204,g:153,b:0,a:255,t:0,s:0},{r:204,g:102,b:255,a:255,t:0,s:0},{r:204,g:102,b:204,a:255,t:0,s:0},{r:204,g:102,b:153,a:255,t:0,s:0},{r:204,g:102,b:102,a:255,t:0,s:0},{r:204,g:102,b:51,a:255,t:0,s:0},{r:204,g:102,b:0,a:255,t:0,s:0},{r:204,g:51,b:255,a:255,t:0,s:0},{r:204,g:51,b:204,a:255,t:0,s:0},{r:204,g:51,b:153,a:255,t:0,s:0},{r:204,g:51,b:102,a:255,t:0,s:0},{r:204,g:51,b:51,a:255,t:0,s:0},{r:204,g:51,b:0,a:255,t:0,s:0},{r:204,g:0,b:255,a:255,t:0,s:0},{r:204,g:0,b:204,a:255,t:0,s:0},{r:204,g:0,b:153,a:255,t:0,s:0},{r:204,g:0,b:102,a:255,t:0,s:0},{r:204,g:0,b:51,a:255,t:0,s:0},{r:204,g:0,b:0,a:255,t:0,s:0},{r:153,g:255,b:255,a:255,t:0,s:0},{r:153,g:255,b:204,a:255,t:0,s:0},{r:153,g:255,b:153,a:255,t:0,s:0},{r:153,g:255,b:102,a:255,t:0,s:0},{r:153,g:255,b:51,a:255,t:0,s:0},{r:153,g:255,b:0,a:255,t:0,s:0},{r:153,g:204,b:255,a:255,t:0,s:0},{r:153,g:204,b:204,a:255,t:0,s:0},{r:153,g:204,b:153,a:255,t:0,s:0},{r:153,g:204,b:102,a:255,t:0,s:0},{r:153,g:204,b:51,a:255,t:0,s:0},{r:153,g:204,b:0,a:255,t:0,s:0},{r:153,g:153,b:255,a:255,t:0,s:0},{r:153,g:153,b:204,a:255,t:0,s:0},{r:153,g:153,b:153,a:255,t:0,s:0},{r:153,g:153,b:102,a:255,t:0,s:0},{r:153,g:153,b:51,a:255,t:0,s:0},{r:153,g:153,b:0,a:255,t:0,s:0},{r:153,g:102,b:255,a:255,t:0,s:0},{r:153,g:102,b:204,a:255,t:0,s:0},{r:153,g:102,b:153,a:255,t:0,s:0},{r:153,g:102,b:102,a:255,t:0,s:0},{r:153,g:102,b:51,a:255,t:0,s:0},{r:153,g:102,b:0,a:255,t:0,s:0},{r:153,g:51,b:255,a:255,t:0,s:0},{r:153,g:51,b:204,a:255,t:0,s:0},{r:153,g:51,b:153,a:255,t:0,s:0},{r:153,g:51,b:102,a:255,t:0,s:0},{r:153,g:51,b:51,a:255,t:0,s:0},{r:153,g:51,b:0,a:255,t:0,s:0},{r:153,g:0,b:255,a:255,t:0,s:0},{r:153,g:0,b:204,a:255,t:0,s:0},{r:153,g:0,b:153,a:255,t:0,s:0},{r:153,g:0,b:102,a:255,t:0,s:0},{r:153,g:0,b:51,a:255,t:0,s:0},{r:153,g:0,b:0,a:255,t:0,s:0},{r:102,g:255,b:255,a:255,t:0,s:0},{r:102,g:255,b:204,a:255,t:0,s:0},{r:102,g:255,b:153,a:255,t:0,s:0},{r:102,g:255,b:102,a:255,t:0,s:0},{r:102,g:255,b:51,a:255,t:0,s:0},{r:102,g:255,b:0,a:255,t:0,s:0},{r:102,g:204,b:255,a:255,t:0,s:0},{r:102,g:204,b:204,a:255,t:0,s:0},{r:102,g:204,b:153,a:255,t:0,s:0},{r:102,g:204,b:102,a:255,t:0,s:0},{r:102,g:204,b:51,a:255,t:0,s:0},{r:102,g:204,b:0,a:255,t:0,s:0},{r:102,g:153,b:255,a:255,t:0,s:0},{r:102,g:153,b:204,a:255,t:0,s:0},{r:102,g:153,b:153,a:255,t:0,s:0},{r:102,g:153,b:102,a:255,t:0,s:0},{r:102,g:153,b:51,a:255,t:0,s:0},{r:102,g:153,b:0,a:255,t:0,s:0},{r:102,g:102,b:255,a:255,t:0,s:0},{r:102,g:102,b:204,a:255,t:0,s:0},{r:102,g:102,b:153,a:255,t:0,s:0},{r:102,g:102,b:102,a:255,t:0,s:0},{r:102,g:102,b:51,a:255,t:0,s:0},{r:102,g:102,b:0,a:255,t:0,s:0},{r:102,g:51,b:255,a:255,t:0,s:0},{r:102,g:51,b:204,a:255,t:0,s:0},{r:102,g:51,b:153,a:255,t:0,s:0},{r:102,g:51,b:102,a:255,t:0,s:0},{r:102,g:51,b:51,a:255,t:0,s:0},{r:102,g:51,b:0,a:255,t:0,s:0},{r:102,g:0,b:255,a:255,t:0,s:0},{r:102,g:0,b:204,a:255,t:0,s:0},{r:102,g:0,b:153,a:255,t:0,s:0},{r:102,g:0,b:102,a:255,t:0,s:0},{r:102,g:0,b:51,a:255,t:0,s:0},{r:102,g:0,b:0,a:255,t:0,s:0},{r:51,g:255,b:255,a:255,t:0,s:0},{r:51,g:255,b:204,a:255,t:0,s:0},{r:51,g:255,b:153,a:255,t:0,s:0},{r:51,g:255,b:102,a:255,t:0,s:0},{r:51,g:255,b:51,a:255,t:0,s:0},{r:51,g:255,b:0,a:255,t:0,s:0},{r:51,g:204,b:255,a:255,t:0,s:0},{r:51,g:204,b:204,a:255,t:0,s:0},{r:51,g:204,b:153,a:255,t:0,s:0},{r:51,g:204,b:102,a:255,t:0,s:0},{r:51,g:204,b:51,a:255,t:0,s:0},{r:51,g:204,b:0,a:255,t:0,s:0},{r:51,g:153,b:255,a:255,t:0,s:0},{r:51,g:153,b:204,a:255,t:0,s:0},{r:51,g:153,b:153,a:255,t:0,s:0},{r:51,g:153,b:102,a:255,t:0,s:0},{r:51,g:153,b:51,a:255,t:0,s:0},{r:51,g:153,b:0,a:255,t:0,s:0},{r:51,g:102,b:255,a:255,t:0,s:0},{r:51,g:102,b:204,a:255,t:0,s:0},{r:51,g:102,b:153,a:255,t:0,s:0},{r:51,g:102,b:102,a:255,t:0,s:0},{r:51,g:102,b:51,a:255,t:0,s:0},{r:51,g:102,b:0,a:255,t:0,s:0},{r:51,g:51,b:255,a:255,t:0,s:0},{r:51,g:51,b:204,a:255,t:0,s:0},{r:51,g:51,b:153,a:255,t:0,s:0},{r:51,g:51,b:102,a:255,t:0,s:0},{r:51,g:51,b:51,a:255,t:0,s:0},{r:51,g:51,b:0,a:255,t:0,s:0},{r:51,g:0,b:255,a:255,t:0,s:0},{r:51,g:0,b:204,a:255,t:0,s:0},{r:51,g:0,b:153,a:255,t:0,s:0},{r:51,g:0,b:102,a:255,t:0,s:0},{r:51,g:0,b:51,a:255,t:0,s:0},{r:51,g:0,b:0,a:255,t:0,s:0},{r:0,g:255,b:255,a:255,t:0,s:0},{r:0,g:255,b:204,a:255,t:0,s:0},{r:0,g:255,b:153,a:255,t:0,s:0},{r:0,g:255,b:102,a:255,t:0,s:0},{r:0,g:255,b:51,a:255,t:0,s:0},{r:0,g:255,b:0,a:255,t:0,s:0},{r:0,g:204,b:255,a:255,t:0,s:0},{r:0,g:204,b:204,a:255,t:0,s:0},{r:0,g:204,b:153,a:255,t:0,s:0},{r:0,g:204,b:102,a:255,t:0,s:0},{r:0,g:204,b:51,a:255,t:0,s:0},{r:0,g:204,b:0,a:255,t:0,s:0},{r:0,g:153,b:255,a:255,t:0,s:0},{r:0,g:153,b:204,a:255,t:0,s:0},{r:0,g:153,b:153,a:255,t:0,s:0},{r:0,g:153,b:102,a:255,t:0,s:0},{r:0,g:153,b:51,a:255,t:0,s:0},{r:0,g:153,b:0,a:255,t:0,s:0},{r:0,g:102,b:255,a:255,t:0,s:0},{r:0,g:102,b:204,a:255,t:0,s:0},{r:0,g:102,b:153,a:255,t:0,s:0},{r:0,g:102,b:102,a:255,t:0,s:0},{r:0,g:102,b:51,a:255,t:0,s:0},{r:0,g:102,b:0,a:255,t:0,s:0},{r:0,g:51,b:255,a:255,t:0,s:0},{r:0,g:51,b:204,a:255,t:0,s:0},{r:0,g:51,b:153,a:255,t:0,s:0},{r:0,g:51,b:102,a:255,t:0,s:0},{r:0,g:51,b:51,a:255,t:0,s:0},{r:0,g:51,b:0,a:255,t:0,s:0},{r:0,g:0,b:255,a:255,t:0,s:0},{r:0,g:0,b:204,a:255,t:0,s:0},{r:0,g:0,b:153,a:255,t:0,s:0},{r:0,g:0,b:102,a:255,t:0,s:0},{r:0,g:0,b:51,a:255,t:0,s:0},{r:238,g:0,b:0,a:255,t:0,s:0},{r:221,g:0,b:0,a:255,t:0,s:0},{r:187,g:0,b:0,a:255,t:0,s:0},{r:170,g:0,b:0,a:255,t:0,s:0},{r:136,g:0,b:0,a:255,t:0,s:0},{r:119,g:0,b:0,a:255,t:0,s:0},{r:85,g:0,b:0,a:255,t:0,s:0},{r:68,g:0,b:0,a:255,t:0,s:0},{r:34,g:0,b:0,a:255,t:0,s:0},{r:17,g:0,b:0,a:255,t:0,s:0},{r:0,g:238,b:0,a:255,t:0,s:0},{r:0,g:221,b:0,a:255,t:0,s:0},{r:0,g:187,b:0,a:255,t:0,s:0},{r:0,g:170,b:0,a:255,t:0,s:0},{r:0,g:136,b:0,a:255,t:0,s:0},{r:0,g:119,b:0,a:255,t:0,s:0},{r:0,g:85,b:0,a:255,t:0,s:0},{r:0,g:68,b:0,a:255,t:0,s:0},{r:0,g:34,b:0,a:255,t:0,s:0},{r:0,g:17,b:0,a:255,t:0,s:0},{r:0,g:0,b:238,a:255,t:0,s:0},{r:0,g:0,b:221,a:255,t:0,s:0},{r:0,g:0,b:187,a:255,t:0,s:0},{r:0,g:0,b:170,a:255,t:0,s:0},{r:0,g:0,b:136,a:255,t:0,s:0},{r:0,g:0,b:119,a:255,t:0,s:0},{r:0,g:0,b:85,a:255,t:0,s:0},{r:0,g:0,b:68,a:255,t:0,s:0},{r:0,g:0,b:34,a:255,t:0,s:0},{r:0,g:0,b:17,a:255,t:0,s:0},{r:238,g:238,b:238,a:255,t:0,s:0},{r:221,g:221,b:221,a:255,t:0,s:0},{r:187,g:187,b:187,a:255,t:0,s:0},{r:170,g:170,b:170,a:255,t:0,s:0},{r:136,g:136,b:136,a:255,t:0,s:0},{r:119,g:119,b:119,a:255,t:0,s:0},{r:85,g:85,b:85,a:255,t:0,s:0},{r:68,g:68,b:68,a:255,t:0,s:0},{r:34,g:34,b:34,a:255,t:0,s:0},{r:17,g:17,b:17,a:255,t:0,s:0}],console.log("default palette");else{for(v=new Uint8Array(e.slice(b,b+f)),h=M=0;f>M;h=M+=4)p.push({r:v[h],g:v[h+1],b:v[h+2],a:v[h+3],t:0,s:0});console.log("palette:"),console.log(p)}for(t.voxels=[],$=new Uint32Array(e.slice(E,E+4))[0],console.log("voxel count: "+$),E+4+4*$!==z&&console.warn("invalid length of voxel chunk"),x=new Uint8Array(e.slice(E+4,E+4+4*$)),h=A=0,C=4*$;C>A;h=A+=4)null==t.voxels[x[h]]&&(t.voxels[x[h]]=[]),null==t.voxels[x[h]][x[h+2]]&&(t.voxels[x[h]][x[h+2]]=[]),t.voxels[x[h]][x[h+2]][x[h+1]]=p[x[h+3]-1];return console.log("voxels:"),console.log(t.voxels),r()}}(this),console.log("reading file with name: "+t.name),o.readAsArrayBuffer(t))}return r(e,t),e.prototype.export=function(){var t,e,r,o,s,n,i,a,l,h,c,u,d,g,p,b,f,v,x,y,w,m,E,$,z,M,A,T,R,k,C,I,O,S,H,U,V,L,_,j,B,D,P,q;for(s=[86,79,88,32,150,0,0,0,77,65,73,78,0,0,0,0],S=new Uint8Array(new Uint32Array([this.x]).buffer),f=S[0],v=S[1],x=S[2],y=S[3],H=new Uint8Array(new Uint32Array([this.y]).buffer),m=H[0],E=H[1],$=H[2],z=H[3],V=new Uint8Array(new Uint32Array([this.z]).buffer),A=V[0],T=V[1],R=V[2],k=V[3],g=[83,73,90,69,12,0,0,0,0,0,0,0,f,v,x,y,m,E,$,z,A,T,R,k],p=[],a=[82,71,66,65,0,4,0,0,0,0,0,0],n={},M=C=0,L=this.z;L>C;M=C+=1)for(w=I=0,_=this.y;_>I;w=I+=1)for(b=O=0,j=this.x;j>O;b=O+=1)if(null!=(null!=(B=this.voxels[M])&&null!=(D=B[w])?D[b]:void 0)){if(l=(this.voxels[M][w][b].r<<24|this.voxels[M][w][b].g<<16|this.voxels[M][w][b].b<<8|this.voxels[M][w][b].a)>>>0,i=n[l],null==i){if(!(a.length<1036))throw new Error("To many colors for Magica Voxel palette");a=a.concat([this.voxels[M][w][b].r,this.voxels[M][w][b].g,this.voxels[M][w][b].b,this.voxels[M][w][b].a]),i=a.length/4-3,n[l]=i}p=p.concat([M,b,w,i])}for(;a.length<1036;)a=a.concat([255,255,255,255]);return P=new Uint8Array(new Uint32Array([1076+p.length]).buffer),h=P[0],c=P[1],u=P[2],d=P[3],s=s.concat([h,c,u,d]),s=s.concat(g),q=new Uint8Array(new Uint32Array([p.length+4]).buffer),h=q[0],c=q[1],u=q[2],d=q[3],U=new Uint8Array(new Uint32Array([p.length/4]).buffer),t=U[0],e=U[1],r=U[2],o=U[3],s=s.concat([88,89,90,73,h,c,u,d,0,0,0,0,t,e,r,o]),s=s.concat(p),s=s.concat(a),console.log("export Magica:"),console.log(s),URL.createObjectURL(new Blob([new Uint8Array(s)],{type:"application/octet-binary"}))},e}(IO),"object"==typeof module?module.exports=t:window.MagicaIO=t}.call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};t=function(t){function e(t,r){var o;e.__super__.constructor.call(this,t)||(this.voxels=[],o=new FileReader,o.onloadend=function(t){return function(){var e,s,n,i,a,l,h,c,u,d,g,p,b;for(s=JSON.parse(o.result),e=s.creator,t.x=s.width,t.y=s.height,t.z=s.depth,a=s.version,i=s.frames,console.log("creator: "+l),console.log("version: "+a+" (expected 1)"),console.log("frames: "+i+" (expected 1)"),console.log("dimensions: width : "+t.x+" height: "+t.y+" depth: "+t.z),console.log("frame data:"),n=u=1;i>=u;n=u+=1)for(console.log(s["frame"+n]),p=s["frame"+n],d=0,g=p.length;g>d;d++)b=p[d],l=b[0],h=b[1],c=b[2],e=b[3],null==t.voxels[c]&&(t.voxels[c]=[]),null==t.voxels[c][h]&&(t.voxels[c][h]=[]),t.voxels[c][h][l]={r:(4278190080&e)>>>24,g:(16711680&e)>>>16,b:(65280&e)>>>8,a:255&e,t:0,s:0};return console.log("voxels:"),console.log(t.voxels),r()}}(this),console.log("reading file with name: "+t.name),o.readAsText(t))}return r(e,t),e.prototype.export=function(){var t,e,r,o,s,n,i,a,l,h,c,u,d,g,p;for(t=[],p=this.voxels,o=l=0,u=p.length;u>l;o=++l)if(a=p[o],null!=a)for(r=h=0,d=a.length;d>h;r=++h)if(i=a[r],null!=i)for(e=c=0,g=i.length;g>c;e=++c)n=i[e],null!=n&&t.push([e,r,o,(n.r<<24|n.g<<16|n.b<<8|n.a)>>>0]);return s={creator:"Troxel",width:this.x,height:this.y,depth:this.z,version:1,frames:1,frame1:t},console.log("Zoxel export:"),console.log(s),"data:application/octet-binary;base64,"+btoa(JSON.stringify(s))},e}(IO),"object"==typeof module?module.exports=t:window.ZoxelIO=t}.call(this),function(){var t,e,r={}.hasOwnProperty,o=function(t,e){function o(){this.constructor=t}for(var s in e)r.call(e,s)&&(t[s]=e[s]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},s=[].slice;t=function(t){function e(t){var r,o,n,i,a,l,h,c,u,d,g,p,b,f;if(!e.__super__.constructor.call(this,t)){for(this.voxels=[],g=atob(t).split("").map(function(t){return t.charCodeAt(0)}),this.x=g[0],this.y=g[1],this.z=g[2],this.readonly=g[3],r=5<=g.length?s.call(g,4):[],o=n=0,i={},h=c=0,p=this.z;p>c;h=c+=1)for(l=u=0,b=this.y;b>u;l=u+=1)for(a=d=0,f=this.x;f>d;a=d+=1){if(0===n){if(r[o]>127?(n=r[o]-127,o++):n=1,r[o]>127)throw new Error("Base64 parsing error");r[o]<64?(i={r:r[o+1],g:r[o+2],b:r[o+3],a:r[o+4],s:r[o]%8,t:r[o]>>3},o+=5):(i=null,o++)}null!=i&&(null==this.voxels[h]&&(this.voxels[h]=[]),null==this.voxels[h][l]&&(this.voxels[h][l]=[]),this.voxels[h][l][a]=i),n--}o!==r.length&&console.warn("There shouldn't be any bytes left"),this.readonly||console.log("voxels:"),this.readonly||console.log(this.voxels)}}return o(e,t),e.prototype.export=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,g,p,b,f;for(r=function(t,e,r){var o,s,i,a;if(!(r<n.length))return!1;if(null==t&&null==e)return!0;if(null==t||null==e)return!1;for(a=["r","g","b","a","t","s"],s=0,i=a.length;i>s;s++)if(o=a[s],t[o]!==e[o])return!1;return!0},e=[this.x,this.y,this.z,t?1:0],n=[],l=h=0,d=this.z;d>h;l=h+=1)for(a=c=0,g=this.y;g>c;a=c+=1)for(i=u=0,p=this.x;p>u;i=u+=1)n.push(null!=(b=this.voxels[l])&&null!=(f=b[a])?f[i]:void 0);for(o=0;o<n.length;){for(s=1;128>s&&r(n[o+s-1],n[o+s],o+s);)s++;s>1&&e.push(127+s),null!=n[o]?e=e.concat([8*n[o].t+n[o].s,n[o].r,n[o].g,n[o].b,n[o].a]):e.push(64),o+=s}return console.log("export base64:"),console.log(e),btoa(String.fromCharCode.apply(null,e))},e}(IO),e=function(t){function e(t){var r;e.__super__.constructor.call(this,t)||(r=JSON.parse(t),this.x=r.x,this.y=r.y,this.z=r.z,this.voxels=r.voxels)}return o(e,t),e.prototype.export=function(t){return JSON.stringify({x:this.x,y:this.y,z:this.z,voxels:this.voxels},null,t?"    ":"")},e}(IO),("undefined"!=typeof exports&&null!==exports?exports:window).Base64IO=t,("undefined"!=typeof exports&&null!==exports?exports:window).JsonIO=e}.call(this),function(){var t;t=function(){function t(t,e,r){var o,s,n,i,a,l,h,c,u,d,g,p,b,f,v,x,y,w,m,E,z,M;for(this.embedded=null!=e?e:!1,this.domContainer=null!=r?r:$("#WebGlContainer"),this.voxels=t.voxels,this.x=t.x,this.y=t.y,this.z=t.z,this.objects=[],this.width=this.domContainer.width(),this.height=this.embedded?this.domContainer.height():window.innerHeight-55,this.scene=new THREE.Scene,n=new THREE.BoxGeometry(50,50,50),i=new THREE.MeshBasicMaterial({color:16711680,opacity:.5,transparent:!0}),this.rollOverMesh=new THREE.Mesh(n,i),this.scene.add(this.rollOverMesh),o=new THREE.Geometry,c=u=0,v=this.z;v>=u;c=u+=1)o.vertices.push(new THREE.Vector3(0,0,50*c)),o.vertices.push(new THREE.Vector3(50*this.x,0,50*c)),o.vertices.push(new THREE.Vector3(50*this.x,0,50*c)),o.vertices.push(new THREE.Vector3(50*this.x,50*this.y,50*c));for(l=d=0,x=this.x;x>=d;l=d+=1)o.vertices.push(new THREE.Vector3(50*l,0,0)),o.vertices.push(new THREE.Vector3(50*l,0,50*this.z)),o.vertices.push(new THREE.Vector3(50*l,0,0)),o.vertices.push(new THREE.Vector3(50*l,50*this.y,0));for(h=g=0,y=this.y;y>=g;h=g+=1)o.vertices.push(new THREE.Vector3(0,50*h,0)),o.vertices.push(new THREE.Vector3(50*this.x,50*h,0)),o.vertices.push(new THREE.Vector3(50*this.x,50*h,0)),o.vertices.push(new THREE.Vector3(50*this.x,50*h,50*this.z));for(s=new THREE.LineBasicMaterial({color:0,opacity:.2,transparent:!0}),this.grid=new THREE.Line(o,s,THREE.LinePieces),this.scene.add(this.grid),o=new THREE.PlaneBufferGeometry(50*this.x,50*this.z),o.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),this.plane=new THREE.Mesh(o),this.plane.position.x=25*this.x,this.plane.position.z=25*this.z,this.plane.visible=!1,this.scene.add(this.plane),this.objects.push(this.plane),this.vector=new THREE.Vector3,this.raycaster=new THREE.Raycaster,c=p=0,w=this.z;w>p;c=p+=1)for(h=b=0,m=this.y;m>b;h=b+=1)for(l=f=0,E=this.x;E>f;l=f+=1)null!=(null!=(z=this.voxels[c])&&null!=(M=z[h])?M[l]:void 0)&&(s=new THREE.MeshLambertMaterial({color:new THREE.Color("rgb("+this.voxels[c][h][l].r+","+this.voxels[c][h][l].g+","+this.voxels[c][h][l].b+")"),shading:THREE.FlatShading}),s.ambient=s.color,this.voxels[c][h][l].a<255&&(s.transparent=!0,s.opacity=this.voxels[c][h][l].a/255),a=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),s),a.position.x=50*l+25,a.position.y=50*h+25,a.position.z=50*c+25,this.scene.add(a),this.objects.push(a));
this.ambientLight=new THREE.AmbientLight(6316128),this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(16777215),this.directionalLight.position.set(1,.75,.5).normalize(),this.scene.add(this.directionalLight),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(8947848),this.renderer.setSize(this.width,this.height),this.domContainer.empty().append(this.renderer.domElement),this.domContainer.on("mousedown",function(t){return function(e){return t.onDocumentMouseDown(e)}}(this)),this.domContainer.on("mousemove",function(t){return function(e){return t.onDocumentMouseMove(e)}}(this)),document.addEventListener("keydown",function(t){return function(e){return t.onDocumentKeyDown(e)}}(this)),document.addEventListener("keyup",function(t){return function(e){return t.onDocumentKeyUp(e)}}(this)),window.addEventListener("resize",function(t){return function(e){return t.onWindowResize(e)}}(this)),this.embedded||(this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.domContainer.append(this.stats.domElement)),this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e4),this.camera.position.y=50*this.y,this.camera.position.x=-75*this.x,this.camera.position.z=25*this.z,this.controls=new THREE.OrbitControls(this.camera,this.domContainer[0]),this.controls.target=new THREE.Vector3(25*this.x,25*this.y,25*this.z),this.controls.addEventListener("change",function(t){return function(){return t.render()}}(this)),this.controls.enabled=!1,this.changeEditMode($("#modeEdit").parent().hasClass("active")),this.animate(),this.render()}return t.prototype.reload=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,g,p,b,f,v;for(this.voxels=t.voxels,this.x=t.x,this.y=t.y,this.z=t.z,d=this.objects,a=0,u=d.length;u>a;a++)r=d[a],r!==this.plane&&this.scene.remove(r);for(this.objects=[this.plane],i=l=0,g=this.z;g>l;i=l+=1)for(n=h=0,p=this.y;p>h;n=h+=1)for(s=c=0,b=this.x;b>c;s=c+=1)null!=(null!=(f=this.voxels[i])&&null!=(v=f[n])?v[s]:void 0)&&(e=new THREE.MeshLambertMaterial({color:new THREE.Color("rgb("+this.voxels[i][n][s].r+","+this.voxels[i][n][s].g+","+this.voxels[i][n][s].b+")"),shading:THREE.FlatShading}),e.ambient=e.color,this.voxels[i][n][s].a<255&&(e.transparent=!0,e.opacity=this.voxels[i][n][s].a/255),o=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),e),o.position.x=50*s+25,o.position.y=50*n+25,o.position.z=50*i+25,this.scene.add(o),this.objects.push(o));return this.render()},t.prototype.changeEditMode=function(t){return this.editMode=t,this.editMode?(this.grid.visible=!0,this.rollOverMesh.visible=!0,this.controls.enabled=!1):(this.grid.visible=!1,this.rollOverMesh.visible=!1,this.controls.enabled=!0),this.render()},t.prototype.animate=function(){return requestAnimationFrame(function(t){return function(){return t.animate()}}(this)),this.controls.update(),this.embedded?void 0:this.stats.update()},t.prototype.render=function(t){return this.renderer.render(this.scene,this.camera),t?window.open(this.renderer.domElement.toDataURL("image/png"),"Exported png"):void 0},t.prototype.onDocumentMouseMove=function(t){var e,r;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display"))return t.preventDefault(),this.vector.set(t.clientX/this.width*2-1,2*-((t.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),r=this.raycaster.intersectObjects(this.objects),r.length>0&&(e=r[0],this.rollOverMesh.position.copy(e.point).add(e.face.normal),this.rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)),this.render()},t.prototype.onDocumentMouseDown=function(t){var e,r,o,s,n,i,a,l;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display")&&(this.vector.set(t.clientX/this.width*2-1,2*-((t.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),s=this.raycaster.intersectObjects(this.objects),s.length>0)){if(o=s[0],2===t.button&&o.object!==this.plane&&(i=(o.object.position.x-25)/50,a=(o.object.position.y-25)/50,l=(o.object.position.z-25)/50,delete this.voxels[l][a][i],0===this.voxels[l][a].filter(function(t){return void 0!==t}).length&&delete this.voxels[l][a],0===this.voxels[l].filter(function(t){return void 0!==t}).length&&delete this.voxels[l],this.scene.remove(o.object),this.objects.splice(this.objects.indexOf(o.object),1)),0===t.button){if(r=new THREE.MeshLambertMaterial({color:new THREE.Color($("#addVoxColor").val()),shading:THREE.FlatShading}),r.ambient=r.color,e=parseInt($("#addVoxAlpha").val()),272===e&&(e=255),255>e&&(r.transparent=!0,r.opacity=e/255),n=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),r),n.position.copy(o.point).add(o.face.normal),n.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25),i=(n.position.x-25)/50,a=(n.position.y-25)/50,l=(n.position.z-25)/50,!(i>=0&&i<this.x&&a>=0&&a<this.y&&l>=0&&l<this.z))return;null==this.voxels[l]&&(this.voxels[l]=[]),null==this.voxels[l][a]&&(this.voxels[l][a]=[]),this.voxels[l][a][i]={r:parseInt($("#addVoxColor").val().substring(1,3),16),g:parseInt($("#addVoxColor").val().substring(3,5),16),b:parseInt($("#addVoxColor").val().substring(5,7),16),a:e,t:parseInt($("#addVoxType").val()),s:parseInt($("#addVoxSpecular").val())},this.scene.add(n),this.objects.push(n)}return this.render()}},t.prototype.onDocumentKeyDown=function(t){if(1!==$(".active #modeView").length)switch(t.keyCode){case 18:return this.controls.enabled=!0,this.editMode=!1}},t.prototype.onDocumentKeyUp=function(t){if(1!==$(".active #modeView").length)switch(t.keyCode){case 18:return this.controls.enabled=!1,this.editMode=!0}},t.prototype.onWindowResize=function(){return this.width=this.domContainer.width(),this.height=this.embedded?this.domContainer.height():window.innerHeight-55,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.render()},t}(),"object"==typeof module?module.exports=t:window.Renderer=t}.call(this),function(){var t,e,r,o,s;r=null,t=null,o=null,window.applicationCache.status!==window.applicationCache.UNCACHED&&(window.applicationCache.addEventListener("updateready",function(){return window.applicationCache.status===window.applicationCache.UPDATEREADY&&confirm("A new version of Troxel is available! Do you want to reload this page now to update? (You can reload this page at any time later to update to the new version.)")?(location.reload(),clearInterval(s)):void 0}),s=setInterval(function(){return window.applicationCache.update()},6e5)),window.onpopstate=function(){var t,e,s,n,i,a,l,h;for(a=decodeURI(window.location.hash).replace("#","").split("&"),h=[],n=0,i=a.length;i>n;n++){if(t=a[n],l=t.split("="),e=l[0],s=l[1],"m"===e){r=new Base64IO(s),1===r.readonly&&$("#btnExport").hide(),0===r.readonly&&$("#btnExport").show(),$("#btnExportPng").show(),o=new Renderer(r);break}if("b"===e){$.getJSON("static/Trove.json",function(t){var e;return e=t[s],null!=e?(r=new Base64IO(e),$("#btnExport").hide(),$("#btnExportPng").show(),o=new Renderer(r)):void 0});break}h.push(void 0)}return h},window.onpopstate(),$('input[type="file"]').change(function(){var e,r,o,s;if($(this).prop("files").length>1){for(t=$(this).prop("files"),$("#filetabs li:last a").tab("show"),$("#tabdrag ul").empty(),s=[],r=0,o=t.length;o>r;r++)e=t[r],s.push($("#tabdrag ul").append($("<li>"+e.name+"</li>")));return s}}),e=document.getElementById("openModal"),e.addEventListener("dragover",function(t){return t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),e.addEventListener("drop",function(e){var r,o,s,n;if(e.stopPropagation(),e.preventDefault(),t=e.dataTransfer.files,t.length>0){for($("#filetabs li:last a").tab("show"),$("#tabdrag ul").empty(),n=[],o=0,s=t.length;s>o;o++)r=t[o],n.push($("#tabdrag ul").append($("<li>"+r.name+"</li>")));return n}}),$("#open").click(function(){var e,s,n,i,a,l;switch(e=function(){return $("#openModal").modal("hide"),(null==r.readonly||0===r.readonly)&&$("#btnExport").show(),$("#btnExportPng").show(),o=new Renderer(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#m="+new Base64IO(r).export(!1))},console.log("##################################################"),$("#filetabs li.active a").attr("href")){case"#tabdrag":if("zox"===t[0].name.split(".").pop())r=new ZoxelIO(t[0],e);else if("vox"===t[0].name.split(".").pop())r=new MagicaIO(t[0],e);else if("qb"===t[0].name.split(".").pop()){for(n={},i=a=0,l=t.length;l>a;i=++a)switch(s=t[i],s.name.substr(-5)){case"_a.qb":null==n.a&&(n.a=s);break;case"_t.qb":null==n.t&&(n.t=s);break;case"_s.qb":null==n.s&&(n.s=s);break;default:".qb"===s.name.substr(-3)&&(n.m=s)}null!=n.m?r=new QubicleIO(n,e):alert("Can't find Qubicle main mesh file!")}else alert("Can't import selected file format.");break;case"#tabqb":s=$("#fqb").prop("files")[0],s&&"qb"===s.name.split(".").pop()?r=new QubicleIO({m:s,a:s=$("#fqba").prop("files")[0],t:s=$("#fqbt").prop("files")[0],s:s=$("#fqbs").prop("files")[0]},e):alert("Please choose at least a valid main mesh Qubicle (.qb) file above!");break;case"#tabvox":s=$("#fvox").prop("files")[0],s&&"vox"===s.name.split(".").pop()?r=new MagicaIO(s,e):alert("Please choose a valid Magica Voxel (.vox) file above!");break;case"#tabzox":s=$("#fzox").prop("files")[0],s&&"zox"===s.name.split(".").pop()?r=new ZoxelIO(s,e):alert("Please choose a valid Zoxel (.zox) file above!");break;case"#tabjson":r=new JsonIO($("#sjson").val()),e();break;case"#tabtrove":$.getJSON("static/Trove.json",function(t){var o;return o=t[$("#sbtrove").val()],null!=o?(r=new Base64IO(o),e()):void 0})}}),$("#openTroveTab").click(function(){var t,e;return e=0,t=new Bloodhound({datumTokenizer:function(t){return t.value.split(/[\[,\],_]/i)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:1e4,prefetch:{url:"static/Trove.json",cacheKey:"TroveBlueprintCache",filter:function(t){return $.map(t,function(t,e){return{value:e}})}}}),t.initialize(),$("#sbtrove").typeahead({highlight:!0,minLength:2,hint:!1},{name:"troveBlueprints",source:t.ttAdapter()})}),$("#btnExport").click(function(){return $("#exportQb").text("Export as Qubicle (.qb) ...").removeAttr("href"),$("#exportQba").hide().removeAttr("href"),$("#exportQbt").hide().removeAttr("href"),$("#exportQbs").hide().removeAttr("href"),$("#exportZox").text("Export as Zoxel (.zox) ...").removeAttr("href"),$("#exportVox").text("Export as Magica Voxel (.vox) ...").removeAttr("href"),$("#exportBase64Ta").hide(),$("#exportJsonTa").hide()}),$("#exportQb").click(function(){var t,e,o,s,n;if(!r.readonly)return null==$(this).attr("href")?(n=new QubicleIO(r).export($("#exportQbComp").prop("checked")),t=n[0],e=n[1],s=n[2],o=n[3],$(this).text("Download main mash (.qb)").attr("href",t),$("#exportQba").show().attr("href",e),$("#exportQbt").show().attr("href",s),$("#exportQbs").show().attr("href",o)):void 0}),$("#exportZox").click(function(){return r.readonly?void 0:null==$(this).attr("href")?$(this).text("Download as Zoxel (.zox)").attr("href",new ZoxelIO(r).export()):void 0}),$("#exportVox").click(function(){return r.readonly?void 0:null==$(this).attr("href")?$(this).text("Download as Magica Voxel (.vox)").attr("href",new MagicaIO(r).export()):void 0}),$("#exportBase64").click(function(){return r.readonly?void 0:$("#exportBase64Ta").val(window.location.origin+"/#m="+new Base64IO(r).export($("#exportBase64Ro").prop("checked"))).fadeIn()}),$("#exportJson").click(function(){return r.readonly?void 0:$("#exportJsonTa").val(new JsonIO(r).export($("#exportJsonPret").prop("checked"))).fadeIn()}),$("#btnExportPng").click(function(){return o.render(!0)}),$("#ulSavedModels").parent().on("show.bs.dropdown",function(t){var e,s,n,i;if("#ulSavedModels"===$(t.relatedTarget).data("tag")){for($("#ulSavedModels li:gt(6)").remove(),e=n=0,i=window.localStorage.length;i>n;e=n+=1)s=window.localStorage.key(e),0!==s.indexOf("__")&&$("#ulSavedModels").append("<li><a class='openSavedModel' data-model='"+window.localStorage.getItem(s)+"'>"+s+"</a></li>");0===$(".openSavedModel").length&&$("#ulSavedModels").append('<li class="disabled"><a>No saved models</a></li>')}return $(".openSavedModel").click(function(){return r=new Base64IO($(this).data("model")),(null==r.readonly||0===r.readonly)&&$("#btnExport").show(),$("#btnExportPng").show(),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Toxel","#m="+$(this).data("model")),o=new Renderer(r),$("#ulSavedModels li:eq(1) a").text($(this).text())})}),$("#saveModelAs").click(function(){return $("#saveModelName").val().length>0&&null!=r?(window.localStorage.setItem($("#saveModelName").val(),new Base64IO(r).export(!1)),$("#saveModal").modal("hide")):void 0}),$("#modeView").click(function(){return $(this).parent().addClass("active"),$("#modeEdit").parent().removeClass("active"),o.changeEditMode(!1),$("#addPanel").fadeOut()}),$("#modeEdit").click(function(){return r.readonly?void 0:($(this).parent().addClass("active"),$("#modeView").parent().removeClass("active"),o.changeEditMode(!0),$("#addPanel").fadeIn())}),$(".rotateBtn").click(function(){if(null!=r){switch($(this).data("rotate")){case"x":r.rotateX(!0);break;case"-x":r.rotateX(!1);break;case"y":r.rotateY(!0);break;case"-y":r.rotateY(!1);break;case"z":r.rotateZ(!0);break;case"-z":r.rotateZ(!1)}return o=new Renderer(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#m="+new Base64IO(r).export(!1))}}),$(".mirrorBtn").click(function(){if(null!=r){switch($(this).data("mirror")){case"x":r.mirrorX(!0);break;case"y":r.mirrorY(!0);break;case"z":r.mirrorZ(!0)}return o.reload(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#m="+new Base64IO(r).export(!1))}}),$(".panel-heading").click(function(){return $(this).next().toggle()}),$("#ambLightColor").val("#606060").change(function(){return null!=r?(o.ambientLight.color=new THREE.Color($(this).val()),o.render()):void 0}),$("#dirLightColor").val("#ffffff").change(function(){return null!=r?(o.directionalLight.color=new THREE.Color($(this).val()),o.render()):void 0}),$("#dirLightIntensity").val(1).change(function(){return null!=r?(o.directionalLight.intensity=$(this).val(),o.render()):void 0}),$("#dirLightX").val("1"),$("#dirLightY").val("0.75"),$("#dirLightZ").val("0.5"),$("#dirLightVector").click(function(){return null!=r?(o.directionalLight.position.set(parseFloat($("#dirLightX").val()),parseFloat($("#dirLightY").val()),parseFloat($("#dirLightZ").val())).normalize(),o.render()):void 0})}.call(this)}();