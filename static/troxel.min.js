(function(){(function(){var IO;IO=function(){function IO(other){if(other instanceof IO||typeof other==="object"&&other.x!=null&&other.y!=null&&other.z!=null&&other.voxels!=null){this.voxels=other.voxels;this.x=other.x;this.y=other.y;this.z=other.z;return true}}IO.prototype.verify=function(){var x,y,z,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6;if(!(this.x!=null&&this.y!=null&&this.z!=null&&this.voxels!=null)){return false}if(!(this.x>0&&this.y>0&&this.z>0&&Array.isArray(this.voxels))){return false}if(this.voxels.length>this.z){return false}_ref=this.voxels;for(_i=0,_len=_ref.length;_i<_len;_i++){z=_ref[_i];if(!Array.isArray(z)||z.length>this.y){return false}for(_j=0,_len1=z.length;_j<_len1;_j++){y=z[_j];if(!Array.isArray(y)||y.length>this.x){return false}for(_k=0,_len2=y.length;_k<_len2;_k++){x=y[_k];if(typeof x!=="object"){return false}if(!(typeof x.r==="number"&&(0<=(_ref1=x.r)&&_ref1<=255))){return false}if(!(typeof x.g==="number"&&(0<=(_ref2=x.g)&&_ref2<=255))){return false}if(!(typeof x.b==="number"&&(0<=(_ref3=x.b)&&_ref3<=255))){return false}if(!(typeof x.a==="number"&&(0<=(_ref4=x.a)&&_ref4<=255))){return false}if(!(typeof x.t==="number"&&(0<=(_ref5=x.t)&&_ref5<=4||x.t===7))){return false}if(!(typeof x.s==="number"&&(0<=(_ref6=x.s)&&_ref6<=3||x.s===7))){return false}}}}return true};IO.prototype.rotateX=function(d){var voxels,x,y,z,_i,_j,_k,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;voxels=this.voxels.slice(0);this.voxels=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){if(!(((_ref3=voxels[d?this.z-z-1:z])!=null?(_ref4=_ref3[d?y:this.y-y-1])!=null?_ref4[x]:void 0:void 0)!=null)){continue}if(this.voxels[y]==null){this.voxels[y]=[]}if(this.voxels[y][z]==null){this.voxels[y][z]=[]}this.voxels[y][z][x]=voxels[d?this.z-z-1:z][d?y:this.y-y-1][x]}}}return _ref5=[this.y,this.z],this.z=_ref5[0],this.y=_ref5[1],_ref5};IO.prototype.rotateY=function(d){var voxels,x,y,z,_i,_j,_k,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;voxels=this.voxels.slice(0);this.voxels=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){if(!(((_ref3=voxels[d?this.z-z-1:z])!=null?(_ref4=_ref3[y])!=null?_ref4[d?x:this.x-x-1]:void 0:void 0)!=null)){continue}if(this.voxels[x]==null){this.voxels[x]=[]}if(this.voxels[x][y]==null){this.voxels[x][y]=[]}this.voxels[x][y][z]=voxels[d?this.z-z-1:z][y][d?x:this.x-x-1]}}}return _ref5=[this.x,this.z],this.z=_ref5[0],this.x=_ref5[1],_ref5};IO.prototype.rotateZ=function(d){var voxels,x,y,z,_i,_j,_k,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;voxels=this.voxels.slice(0);this.voxels=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){if(!(((_ref3=voxels[z])!=null?(_ref4=_ref3[d?y:this.y-y-1])!=null?_ref4[d?this.x-x-1:x]:void 0:void 0)!=null)){continue}if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][x]==null){this.voxels[z][x]=[]}this.voxels[z][x][y]=voxels[z][d?y:this.y-y-1][d?this.x-x-1:x]}}}return _ref5=[this.x,this.y],this.y=_ref5[0],this.x=_ref5[1],_ref5};IO.prototype.mirrorX=function(){var voxels,x,y,z,_i,_ref,_results;voxels=this.voxels.slice(0);this.voxels=[];_results=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){_results.push(function(){var _j,_ref1,_results1;_results1=[];for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){_results1.push(function(){var _k,_ref2,_ref3,_ref4,_results2;_results2=[];for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){if(!(((_ref3=voxels[z])!=null?(_ref4=_ref3[y])!=null?_ref4[this.x-x-1]:void 0:void 0)!=null)){continue}if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][y]==null){this.voxels[z][y]=[]}_results2.push(this.voxels[z][y][x]=voxels[z][y][this.x-x-1])}return _results2}.call(this))}return _results1}.call(this))}return _results};IO.prototype.mirrorY=function(){var voxels,x,y,z,_i,_ref,_results;voxels=this.voxels.slice(0);this.voxels=[];_results=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){_results.push(function(){var _j,_ref1,_results1;_results1=[];for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){_results1.push(function(){var _k,_ref2,_ref3,_ref4,_results2;_results2=[];for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){if(!(((_ref3=voxels[z])!=null?(_ref4=_ref3[this.y-y-1])!=null?_ref4[x]:void 0:void 0)!=null)){continue}if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][y]==null){this.voxels[z][y]=[]}_results2.push(this.voxels[z][y][x]=voxels[z][this.y-y-1][x])}return _results2}.call(this))}return _results1}.call(this))}return _results};IO.prototype.mirrorZ=function(){var voxels,x,y,z,_i,_ref,_results;voxels=this.voxels.slice(0);this.voxels=[];_results=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){_results.push(function(){var _j,_ref1,_results1;_results1=[];for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){_results1.push(function(){var _k,_ref2,_ref3,_ref4,_results2;_results2=[];for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){if(!(((_ref3=voxels[this.z-z-1])!=null?(_ref4=_ref3[y])!=null?_ref4[x]:void 0:void 0)!=null)){continue}if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][y]==null){this.voxels[z][y]=[]}_results2.push(this.voxels[z][y][x]=voxels[this.z-z-1][y][x])}return _results2}.call(this))}return _results1}.call(this))}return _results};return IO}();if(typeof module==="object"){module.exports=IO}else{window.IO=IO}}).call(this);(function(){var QubicleIO,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};QubicleIO=function(_super){__extends(QubicleIO,_super);function QubicleIO(files,callback){var fr;if(QubicleIO.__super__.constructor.call(this,files)){return}this.voxels=[];this.x=this.y=this.z=-1;this.loadingState=0;fr=new FileReader;fr.onloadend=function(_this){return function(){var fra,frs,frt;_this.readFile(fr.result,0);if(files.a!=null){fra=new FileReader;fra.onloadend=function(){_this.readFile(fra.result,1);if(_this.loadingState++===2){return callback()}};console.log("reading alpha file with name: "+files.a.name);fra.readAsArrayBuffer(files.a)}else{_this.loadingState++}if(files.t!=null){frt=new FileReader;frt.onloadend=function(){_this.readFile(frt.result,2);if(_this.loadingState++===2){return callback()}};console.log("reading type file with name: "+files.t.name);frt.readAsArrayBuffer(files.t)}else{_this.loadingState++}if(files.s!=null){frs=new FileReader;frs.onloadend=function(){_this.readFile(frs.result,3);if(_this.loadingState++===2){return callback()}};console.log("reading specular file with name: "+files.s.name);frs.readAsArrayBuffer(files.s)}else{_this.loadingState++}if(_this.loadingState===3){return callback()}}}(this);console.log("reading file with name: "+files.m.name);fr.readAsArrayBuffer(files.m)}QubicleIO.prototype.readFile=function(ab,type){var char,colorFormat,compression,count,data,dx,dx_offset,dy,dy_offset,dz,dz_offset,i,ia,index,ix,iy,iz,j,matrixBegin,matrixCount,mb,name,nameLen,version,visabilityMask,x,y,z,zOriantation,_i,_j,_k,_l,_m,_n,_o,_p,_ref,_ref1,_ref2,_ref3,_ref4;console.log("file.byteLength: "+ab.byteLength);_ref=new Uint32Array(ab.slice(0,24)),version=_ref[0],colorFormat=_ref[1],zOriantation=_ref[2],compression=_ref[3],visabilityMask=_ref[4],matrixCount=_ref[5];console.log("version: "+version+" (expected 257 = 1.1.0.0 = current version)");if(version!==257){console.warn("Expected version 257 but found version: "+version+" (May result in errors)")}console.log("color format: "+colorFormat+" (0 for RGBA (recommended) or 1 for BGRA)");console.log("z-axis oriantation: "+zOriantation+" (0 for left (recommended), 1 for right handed)");console.log("compression: "+compression+" (0 for uncompressed, 1 for compressed with run length encoding (RLE))");console.log("visability mask: "+visabilityMask+" (should be 0 for encoded in A value, no partially visability)");if(visabilityMask!==0){console.warn("partially visability not supported and will be ignored / handled as full visibility")}console.log("matrix count:  "+matrixCount);if(matrixCount>1){console.warn("matrices will be merged into one matrix with regard to their offsets")}dx_offset=dy_offset=dz_offset=0;if(matrixCount>1){mb=24;for(i=_i=1;_i<=matrixCount;i=_i+=1){nameLen=new Uint8Array(ab.slice(mb,mb+1))[0];_ref1=new Uint32Array(ab.slice(mb+1+nameLen,mb+13+nameLen)),x=_ref1[0],y=_ref1[1],z=_ref1[2];_ref2=new Int32Array(ab.slice(mb+13+nameLen,mb+25+nameLen)),dx=_ref2[0],dy=_ref2[1],dz=_ref2[2];dx_offset=Math.min(dx_offset,dx);dy_offset=Math.min(dy_offset,dy);dz_offset=Math.min(dz_offset,dz);if(compression===0){mb+=25+nameLen+4*x*y*z}else{ia=0;data=new Uint8Array(ab.slice(mb+25+nameLen));for(iz=_j=0;_j<z;iz=_j+=1){while(true){ia+=4;if(data[ia-4]===6&&data[ia-3]===0&&data[ia-2]===0&&data[ia-1]===0){break}if(data[ia-4]===2&&data[ia-3]===0&&data[ia-2]===0&&data[ia-1]===0){ia+=8}}}mb+=25+nameLen+ia}}}matrixBegin=24;for(i=_k=1;_k<=matrixCount;i=_k+=1){console.log("------------------------ Matrix: "+i+" ------------------------");nameLen=new Uint8Array(ab.slice(matrixBegin,matrixBegin+1))[0];name=function(){var _l,_len,_ref3,_results;_ref3=new Uint8Array(ab.slice(matrixBegin+1,matrixBegin+1+nameLen));_results=[];for(_l=0,_len=_ref3.length;_l<_len;_l++){char=_ref3[_l];_results.push(String.fromCharCode(char))}return _results}().join("");console.log("reading "+i+". matrix with name: "+name);_ref3=new Uint32Array(ab.slice(matrixBegin+1+nameLen,matrixBegin+13+nameLen)),x=_ref3[0],y=_ref3[1],z=_ref3[2];console.log("dimensions: width: "+x+" height: "+y+" depth: "+z);_ref4=new Int32Array(ab.slice(matrixBegin+13+nameLen,matrixBegin+25+nameLen)),dx=_ref4[0],dy=_ref4[1],dz=_ref4[2];console.log("position: dx : "+dx+" dy: "+dy+" dz: "+dz+" (ignored if only 1 matrix)");if(matrixCount===1){dx=dy=dz=0}if(matrixCount>1){dx-=dx_offset;dy-=dy_offset;dz-=dz_offset}console.log("position result: dx : "+dx+" dy: "+dy+" dz: "+dz);if(type===0){this.x=Math.max(this.x,x+dx);this.y=Math.max(this.y,y+dy);this.z=Math.max(this.z,z+dz)}if(compression===0){data=new Uint8Array(ab.slice(matrixBegin+25+nameLen,matrixBegin+25+nameLen+4*x*y*z));for(iz=_l=0;_l<z;iz=_l+=1){for(iy=_m=0;_m<y;iy=_m+=1){for(ix=_n=0;_n<x;ix=_n+=1){ia=4*(iz*y*x+iy*x+ix);if(data[ia+3]>0){this.addValues(type,ix+dx,iy+dy,z,iz,dz,zOriantation,data[ia],data[ia+1],data[ia+2],colorFormat)}}}}matrixBegin+=25+nameLen+4*x*y*z}else{data=new Uint8Array(ab.slice(matrixBegin+25+nameLen));ia=0;for(iz=_o=0;_o<z;iz=_o+=1){index=0;while(true){ia+=4;if(data[ia-4]===6&&data[ia-3]===0&&data[ia-2]===0&&data[ia-1]===0){break}if(data[ia-4]===2&&data[ia-3]===0&&data[ia-2]===0&&data[ia-1]===0){count=new Uint32Array(new Uint8Array([data[ia],data[ia+1],data[ia+2],data[ia+3]]).buffer)[0];if(count>255){console.log("high voxel repeat count: "+count)}if(data[ia+7]>0){for(j=_p=0;_p<count;j=_p+=1){ix=index%x;iy=Math.floor(index/x);index++;this.addValues(type,ix+dx,iy+dy,z,iz,dz,zOriantation,data[ia+4],data[ia+5],data[ia+6],colorFormat)}}else{index+=count}ia+=8}else{ix=index%x;iy=Math.floor(index/x);index++;if(data[ia-1]>0){this.addValues(type,ix+dx,iy+dy,z,iz,dz,zOriantation,data[ia-4],data[ia-3],data[ia-2],colorFormat)}}}}matrixBegin+=25+nameLen+ia}}console.log("voxels:");console.log(this.voxels);if(matrixBegin!==ab.byteLength){return console.warn(console.log("There shouldn't be any bytes left"))}};QubicleIO.prototype.addValues=function(type,x,y,z,iz,dz,zOriantation,r,g,b,colorFormat){var _ref;z=(zOriantation===0?iz:z-iz-1)+dz;if(colorFormat===1){_ref=[b,r],r=_ref[0],b=_ref[1]}switch(type){case 0:return this.addColorValues(x,y,z,r,g,b);case 1:return this.addAlphaValues(x,y,z,r,g,b);case 2:return this.addTypeValues(x,y,z,r,g,b);case 3:return this.addSpecularValues(x,y,z,r,g,b)}};QubicleIO.prototype.addColorValues=function(x,y,z,r,g,b){if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][y]==null){this.voxels[z][y]=[]}return this.voxels[z][y][x]={r:r,g:g,b:b,a:255,t:0,s:0}};QubicleIO.prototype.addAlphaValues=function(x,y,z,r,g,b){var _ref,_ref1;if(((_ref=this.voxels[z])!=null?(_ref1=_ref[y])!=null?_ref1[x]:void 0:void 0)==null){return console.warn("Ignoring alpha voxel because of non existing color voxel at the same position")}if(r===g&&g===b){return this.voxels[z][y][x].a=function(){switch(r){case 16:return 255;case 48:return 240;case 80:return 208;case 112:return 176;case 144:return 144;case 176:return 112;case 208:return 80;case 240:return 48;case 255:return 16;default:console.warn("invalid alpha value: r, g and b are not equal, falling back to fully opaque");return 255}}()}if(r===b&&b===255&&g===0){return this.voxels[z][y][x].a=255}console.warn("invalid alpha value: r, g and b are not equal, falling back to fully opaque");return this.voxels[z][y][x].a=255};QubicleIO.prototype.addTypeValues=function(x,y,z,r,g,b){var _ref,_ref1;if(((_ref=this.voxels[z])!=null?(_ref1=_ref[y])!=null?_ref1[x]:void 0:void 0)==null){return console.warn("Ignoring type voxel because of non existing color voxel at the same position")}if(r===255&&g===255&&b===255){return this.voxels[z][y][x].t=0}if(r===128&&g===128&&b===128){return this.voxels[z][y][x].t=1}if(r===64&&g===64&&b===64){return this.voxels[z][y][x].t=2}if(r===255&&g===0&&b===0){return this.voxels[z][y][x].t=3}if(r===255&&g===255&&b===0){return this.voxels[z][y][x].t=4}if(r===255&&g===0&&b===255){return this.voxels[z][y][x].t=7}console.warn("invalid type value (r: "+r+", g: "+g+", b: "+b+"), falling back to solid");return this.voxels[z][y][x].t=0};QubicleIO.prototype.addSpecularValues=function(x,y,z,r,g,b){var _ref,_ref1;if(((_ref=this.voxels[z])!=null?(_ref1=_ref[y])!=null?_ref1[x]:void 0:void 0)==null){return console.warn("Ignoring specular voxel because of non existing color voxel at the same position")}if(r===128&&g===0&&b===0){return this.voxels[z][y][x].s=0}if(r===0&&g===128&&b===0){return this.voxels[z][y][x].s=1}if(r===0&&g===0&&b===128){return this.voxels[z][y][x].s=2}if(r===128&&g===128&&b===0){return this.voxels[z][y][x].s=3}if(r===255&&g===0&&b===255){return this.voxels[z][y][x].s=7}console.warn("invalid specular value (r: "+r+", g: "+g+", b: "+b+"), falling back to rough");return this.voxels[z][y][x].s=0};QubicleIO.prototype["export"]=function(comp){var c1,c2,c3,c4,data,data_a,data_s,data_t,equal,exportValues,i,lastVox,r,ta,vox,x,y,z,_i,_j,_k,_l,_len,_m,_n,_o,_ref,_ref1,_ref10,_ref11,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9,_results;data=[1,1,0,0,0,0,0,0,0,0,0,0,+comp,0,0,0,0,0,0,0,1,0,0,0,5,77,157,144,145,154,this.x,0,0,0,this.y,0,0,0,this.z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];data_a=data.slice(0);data_t=data.slice(0);data_s=data.slice(0);exportValues=function(vox){if(vox!=null){data=data.concat([vox.r,vox.g,vox.b,255]);data_a=data_a.concat(function(){switch(false){case!(vox.t===7&&vox.s===7):return[255,0,255,255];case vox.a!==255:return[16,16,16,255];case!(vox.a>224):return[48,48,48,255];case!(vox.a>192):return[80,80,80,255];case!(vox.a>160):return[112,112,112,255];case!(vox.a>128):return[144,144,144,255];case!(vox.a>96):return[176,176,176,255];case!(vox.a>64):return[208,208,208,255];case!(vox.a>32):return[240,240,240,255];default:return[255,255,255,255]}}());data_t=data_t.concat(function(){switch(vox.t){case 0:return[255,255,255,255];case 1:return[128,128,128,255];case 2:return[64,64,64,255];case 3:return[255,0,0,255];case 4:return[255,255,0,255];case 7:return[255,0,255,255];default:return[255,255,255,255]}}());return data_s=data_s.concat(function(){switch(vox.s){case 0:return[128,0,0,255];case 1:return[0,128,0,255];case 2:return[0,0,128,255];case 3:return[128,128,0,255];case 7:return[255,0,255,255];default:return[128,0,0,255]}}())}else{data=data.concat([0,0,0,0]);data_a=data_a.concat([0,0,0,0]);data_t=data_t.concat([0,0,0,0]);return data_s=data_s.concat([0,0,0,0])}};equal=function(a,b){var i,_i,_len,_ref;if(a==null&&b==null){return true}if(a==null||b==null){return false}_ref=["r","g","b","a","t","s"];for(_i=0,_len=_ref.length;_i<_len;_i++){i=_ref[_i];if(a[i]!==b[i]){return false}}return true};if(comp){for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){if(this.voxels[z]!=null){vox=[];lastVox=-1;for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){vox.push((_ref3=this.voxels[z][y])!=null?_ref3[x]:void 0);if(((_ref4=this.voxels[z][y])!=null?_ref4[x]:void 0)!=null){lastVox=vox.length-1}}}i=0;while(i<=lastVox){r=1;while(i+r<=lastVox){if(equal(vox[i+r-1],vox[i+r])){r++}else{break}}if(r>1){_ref5=new Uint8Array(new Uint32Array([r]).buffer),c1=_ref5[0],c2=_ref5[1],c3=_ref5[2],c4=_ref5[3];data=data.concat([2,0,0,0,c1,c2,c3,c4]);data_a=data_a.concat([2,0,0,0,c1,c2,c3,c4]);data_t=data_t.concat([2,0,0,0,c1,c2,c3,c4]);data_s=data_s.concat([2,0,0,0,c1,c2,c3,c4])}exportValues(vox[i]);i+=r}}data=data.concat([6,0,0,0]);data_a=data_a.concat([6,0,0,0]);data_t=data_t.concat([6,0,0,0]);data_s=data_s.concat([6,0,0,0])}}else{for(z=_l=0,_ref6=this.z;_l<_ref6;z=_l+=1){for(y=_m=0,_ref7=this.y;_m<_ref7;y=_m+=1){for(x=_n=0,_ref8=this.x;_n<_ref8;x=_n+=1){exportValues((_ref9=this.voxels[z])!=null?(_ref10=_ref9[y])!=null?_ref10[x]:void 0:void 0)}}}}console.log("export Qubicle:");console.log(data);_ref11=[data,data_a,data_t,data_s];_results=[];for(_o=0,_len=_ref11.length;_o<_len;_o++){ta=_ref11[_o];_results.push(URL.createObjectURL(new Blob([new Uint8Array(ta)],{type:"application/octet-binary"})))}return _results};return QubicleIO}(IO);if(typeof module==="object"){module.exports=QubicleIO}else{window.QubicleIO=QubicleIO}}).call(this);(function(){var MagicaIO,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};MagicaIO=function(_super){__extends(MagicaIO,_super);function MagicaIO(file,callback){var fr;if(MagicaIO.__super__.constructor.call(this,file)){return}fr=new FileReader;fr.onloadend=function(_this){return function(){var ab,char,chunkChildSize,chunkId,chunkPointer,chunkSize,i,mainChunkChildSize,mainChunkId,mainChunkSize,meta,palette,paletteBegin,paletteLength,rawpalette,rawvoxels,sizeBegin,sizeEnd,version,voxelBegin,voxelCount,voxelEnd,_i,_j,_ref,_ref1,_ref2,_ref3;ab=fr.result;meta=function(){var _i,_len,_ref,_results;_ref=new Uint8Array(ab.slice(0,4));_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){char=_ref[_i];_results.push(String.fromCharCode(char))}return _results}().join("");console.log("meta: "+meta+" (expected VOX )");if(meta!=="VOX "){throw new Error("Expected Magica Voxel header not found")}version=new Uint32Array(ab.slice(4,8))[0];console.log("version: "+version+" (expected 150)");if(version!==150){console.warn("Expected version 150 but found version: "+version+" (May result in errors)")}mainChunkId=function(){var _i,_len,_ref,_results;_ref=new Uint8Array(ab.slice(8,12));_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){char=_ref[_i];_results.push(String.fromCharCode(char))}return _results}().join("");console.log("mainChunkId: "+mainChunkId+" (expected MAIN)");if(mainChunkId!=="MAIN"){throw new Error("Didn't found main Chunk as expected")}_ref=new Uint32Array(ab.slice(12,20)),mainChunkSize=_ref[0],mainChunkChildSize=_ref[1];console.log("mainChunkSize: "+mainChunkSize+" (expected 0)");console.log("mainChunkChildSize: "+mainChunkChildSize);if(20+mainChunkChildSize!==ab.byteLength){console.warn(console.log("There shouldn't be any bytes left"))}chunkPointer=20+mainChunkSize;sizeBegin=sizeEnd=voxelBegin=voxelEnd=paletteBegin=paletteLength=-1;while(chunkPointer<20+mainChunkSize+mainChunkChildSize){chunkId=function(){var _i,_len,_ref1,_results;_ref1=new Uint8Array(ab.slice(chunkPointer,chunkPointer+4));_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){char=_ref1[_i];_results.push(String.fromCharCode(char))}return _results}().join("");console.log(new Uint8Array(ab.slice(chunkPointer,chunkPointer+12)));_ref1=new Uint32Array(ab.slice(chunkPointer+4,chunkPointer+12)),chunkSize=_ref1[0],chunkChildSize=_ref1[1];console.log("found child chunk: "+chunkId+" with begin: "+(chunkPointer+12)+", size: "+chunkSize+" and childSize: "+chunkChildSize+" (expected 0)");switch(chunkId){case"SIZE":if(chunkSize!==12){console.warn("invalid length of size chunk")}sizeBegin=chunkPointer+12;sizeEnd=sizeBegin+chunkSize;break;case"XYZI":voxelBegin=chunkPointer+12;voxelEnd=voxelBegin+chunkSize;break;case"RGBA":paletteBegin=chunkPointer+12;if(chunkSize!==1024){console.warn("invalid length of palette chunk")}paletteLength=chunkSize}chunkPointer+=12+chunkSize+chunkChildSize}if(sizeBegin===-1||sizeEnd===-1||voxelBegin===-1||voxelEnd===-1){throw new Error("missing chunks")}_ref2=new Uint32Array(ab.slice(sizeBegin,sizeEnd)),_this.x=_ref2[0],_this.y=_ref2[1],_this.z=_ref2[2];console.log("dimensions: width: "+_this.x+" height: "+_this.y+" depth: "+_this.z);palette=[];if(paletteBegin===-1||paletteLength===-1){palette=[{r:255,g:255,b:255,a:255,t:0,s:0},{r:255,g:255,b:204,a:255,t:0,s:0},{r:255,g:255,b:153,a:255,t:0,s:0},{r:255,g:255,b:102,a:255,t:0,s:0},{r:255,g:255,b:51,a:255,t:0,s:0},{r:255,g:255,b:0,a:255,t:0,s:0},{r:255,g:204,b:255,a:255,t:0,s:0},{r:255,g:204,b:204,a:255,t:0,s:0},{r:255,g:204,b:153,a:255,t:0,s:0},{r:255,g:204,b:102,a:255,t:0,s:0},{r:255,g:204,b:51,a:255,t:0,s:0},{r:255,g:204,b:0,a:255,t:0,s:0},{r:255,g:153,b:255,a:255,t:0,s:0},{r:255,g:153,b:204,a:255,t:0,s:0},{r:255,g:153,b:153,a:255,t:0,s:0},{r:255,g:153,b:102,a:255,t:0,s:0},{r:255,g:153,b:51,a:255,t:0,s:0},{r:255,g:153,b:0,a:255,t:0,s:0},{r:255,g:102,b:255,a:255,t:0,s:0},{r:255,g:102,b:204,a:255,t:0,s:0},{r:255,g:102,b:153,a:255,t:0,s:0},{r:255,g:102,b:102,a:255,t:0,s:0},{r:255,g:102,b:51,a:255,t:0,s:0},{r:255,g:102,b:0,a:255,t:0,s:0},{r:255,g:51,b:255,a:255,t:0,s:0},{r:255,g:51,b:204,a:255,t:0,s:0},{r:255,g:51,b:153,a:255,t:0,s:0},{r:255,g:51,b:102,a:255,t:0,s:0},{r:255,g:51,b:51,a:255,t:0,s:0},{r:255,g:51,b:0,a:255,t:0,s:0},{r:255,g:0,b:255,a:255,t:0,s:0},{r:255,g:0,b:204,a:255,t:0,s:0},{r:255,g:0,b:153,a:255,t:0,s:0},{r:255,g:0,b:102,a:255,t:0,s:0},{r:255,g:0,b:51,a:255,t:0,s:0},{r:255,g:0,b:0,a:255,t:0,s:0},{r:204,g:255,b:255,a:255,t:0,s:0},{r:204,g:255,b:204,a:255,t:0,s:0},{r:204,g:255,b:153,a:255,t:0,s:0},{r:204,g:255,b:102,a:255,t:0,s:0},{r:204,g:255,b:51,a:255,t:0,s:0},{r:204,g:255,b:0,a:255,t:0,s:0},{r:204,g:204,b:255,a:255,t:0,s:0},{r:204,g:204,b:204,a:255,t:0,s:0},{r:204,g:204,b:153,a:255,t:0,s:0},{r:204,g:204,b:102,a:255,t:0,s:0},{r:204,g:204,b:51,a:255,t:0,s:0},{r:204,g:204,b:0,a:255,t:0,s:0},{r:204,g:153,b:255,a:255,t:0,s:0},{r:204,g:153,b:204,a:255,t:0,s:0},{r:204,g:153,b:153,a:255,t:0,s:0},{r:204,g:153,b:102,a:255,t:0,s:0},{r:204,g:153,b:51,a:255,t:0,s:0},{r:204,g:153,b:0,a:255,t:0,s:0},{r:204,g:102,b:255,a:255,t:0,s:0},{r:204,g:102,b:204,a:255,t:0,s:0},{r:204,g:102,b:153,a:255,t:0,s:0},{r:204,g:102,b:102,a:255,t:0,s:0},{r:204,g:102,b:51,a:255,t:0,s:0},{r:204,g:102,b:0,a:255,t:0,s:0},{r:204,g:51,b:255,a:255,t:0,s:0},{r:204,g:51,b:204,a:255,t:0,s:0},{r:204,g:51,b:153,a:255,t:0,s:0},{r:204,g:51,b:102,a:255,t:0,s:0},{r:204,g:51,b:51,a:255,t:0,s:0},{r:204,g:51,b:0,a:255,t:0,s:0},{r:204,g:0,b:255,a:255,t:0,s:0},{r:204,g:0,b:204,a:255,t:0,s:0},{r:204,g:0,b:153,a:255,t:0,s:0},{r:204,g:0,b:102,a:255,t:0,s:0},{r:204,g:0,b:51,a:255,t:0,s:0},{r:204,g:0,b:0,a:255,t:0,s:0},{r:153,g:255,b:255,a:255,t:0,s:0},{r:153,g:255,b:204,a:255,t:0,s:0},{r:153,g:255,b:153,a:255,t:0,s:0},{r:153,g:255,b:102,a:255,t:0,s:0},{r:153,g:255,b:51,a:255,t:0,s:0},{r:153,g:255,b:0,a:255,t:0,s:0},{r:153,g:204,b:255,a:255,t:0,s:0},{r:153,g:204,b:204,a:255,t:0,s:0},{r:153,g:204,b:153,a:255,t:0,s:0},{r:153,g:204,b:102,a:255,t:0,s:0},{r:153,g:204,b:51,a:255,t:0,s:0},{r:153,g:204,b:0,a:255,t:0,s:0},{r:153,g:153,b:255,a:255,t:0,s:0},{r:153,g:153,b:204,a:255,t:0,s:0},{r:153,g:153,b:153,a:255,t:0,s:0},{r:153,g:153,b:102,a:255,t:0,s:0},{r:153,g:153,b:51,a:255,t:0,s:0},{r:153,g:153,b:0,a:255,t:0,s:0},{r:153,g:102,b:255,a:255,t:0,s:0},{r:153,g:102,b:204,a:255,t:0,s:0},{r:153,g:102,b:153,a:255,t:0,s:0},{r:153,g:102,b:102,a:255,t:0,s:0},{r:153,g:102,b:51,a:255,t:0,s:0},{r:153,g:102,b:0,a:255,t:0,s:0},{r:153,g:51,b:255,a:255,t:0,s:0},{r:153,g:51,b:204,a:255,t:0,s:0},{r:153,g:51,b:153,a:255,t:0,s:0},{r:153,g:51,b:102,a:255,t:0,s:0},{r:153,g:51,b:51,a:255,t:0,s:0},{r:153,g:51,b:0,a:255,t:0,s:0},{r:153,g:0,b:255,a:255,t:0,s:0},{r:153,g:0,b:204,a:255,t:0,s:0},{r:153,g:0,b:153,a:255,t:0,s:0},{r:153,g:0,b:102,a:255,t:0,s:0},{r:153,g:0,b:51,a:255,t:0,s:0},{r:153,g:0,b:0,a:255,t:0,s:0},{r:102,g:255,b:255,a:255,t:0,s:0},{r:102,g:255,b:204,a:255,t:0,s:0},{r:102,g:255,b:153,a:255,t:0,s:0},{r:102,g:255,b:102,a:255,t:0,s:0},{r:102,g:255,b:51,a:255,t:0,s:0},{r:102,g:255,b:0,a:255,t:0,s:0},{r:102,g:204,b:255,a:255,t:0,s:0},{r:102,g:204,b:204,a:255,t:0,s:0},{r:102,g:204,b:153,a:255,t:0,s:0},{r:102,g:204,b:102,a:255,t:0,s:0},{r:102,g:204,b:51,a:255,t:0,s:0},{r:102,g:204,b:0,a:255,t:0,s:0},{r:102,g:153,b:255,a:255,t:0,s:0},{r:102,g:153,b:204,a:255,t:0,s:0},{r:102,g:153,b:153,a:255,t:0,s:0},{r:102,g:153,b:102,a:255,t:0,s:0},{r:102,g:153,b:51,a:255,t:0,s:0},{r:102,g:153,b:0,a:255,t:0,s:0},{r:102,g:102,b:255,a:255,t:0,s:0},{r:102,g:102,b:204,a:255,t:0,s:0},{r:102,g:102,b:153,a:255,t:0,s:0},{r:102,g:102,b:102,a:255,t:0,s:0},{r:102,g:102,b:51,a:255,t:0,s:0},{r:102,g:102,b:0,a:255,t:0,s:0},{r:102,g:51,b:255,a:255,t:0,s:0},{r:102,g:51,b:204,a:255,t:0,s:0},{r:102,g:51,b:153,a:255,t:0,s:0},{r:102,g:51,b:102,a:255,t:0,s:0},{r:102,g:51,b:51,a:255,t:0,s:0},{r:102,g:51,b:0,a:255,t:0,s:0},{r:102,g:0,b:255,a:255,t:0,s:0},{r:102,g:0,b:204,a:255,t:0,s:0},{r:102,g:0,b:153,a:255,t:0,s:0},{r:102,g:0,b:102,a:255,t:0,s:0},{r:102,g:0,b:51,a:255,t:0,s:0},{r:102,g:0,b:0,a:255,t:0,s:0},{r:51,g:255,b:255,a:255,t:0,s:0},{r:51,g:255,b:204,a:255,t:0,s:0},{r:51,g:255,b:153,a:255,t:0,s:0},{r:51,g:255,b:102,a:255,t:0,s:0},{r:51,g:255,b:51,a:255,t:0,s:0},{r:51,g:255,b:0,a:255,t:0,s:0},{r:51,g:204,b:255,a:255,t:0,s:0},{r:51,g:204,b:204,a:255,t:0,s:0},{r:51,g:204,b:153,a:255,t:0,s:0},{r:51,g:204,b:102,a:255,t:0,s:0},{r:51,g:204,b:51,a:255,t:0,s:0},{r:51,g:204,b:0,a:255,t:0,s:0},{r:51,g:153,b:255,a:255,t:0,s:0},{r:51,g:153,b:204,a:255,t:0,s:0},{r:51,g:153,b:153,a:255,t:0,s:0},{r:51,g:153,b:102,a:255,t:0,s:0},{r:51,g:153,b:51,a:255,t:0,s:0},{r:51,g:153,b:0,a:255,t:0,s:0},{r:51,g:102,b:255,a:255,t:0,s:0},{r:51,g:102,b:204,a:255,t:0,s:0},{r:51,g:102,b:153,a:255,t:0,s:0},{r:51,g:102,b:102,a:255,t:0,s:0},{r:51,g:102,b:51,a:255,t:0,s:0},{r:51,g:102,b:0,a:255,t:0,s:0},{r:51,g:51,b:255,a:255,t:0,s:0},{r:51,g:51,b:204,a:255,t:0,s:0},{r:51,g:51,b:153,a:255,t:0,s:0},{r:51,g:51,b:102,a:255,t:0,s:0},{r:51,g:51,b:51,a:255,t:0,s:0},{r:51,g:51,b:0,a:255,t:0,s:0},{r:51,g:0,b:255,a:255,t:0,s:0},{r:51,g:0,b:204,a:255,t:0,s:0},{r:51,g:0,b:153,a:255,t:0,s:0},{r:51,g:0,b:102,a:255,t:0,s:0},{r:51,g:0,b:51,a:255,t:0,s:0},{r:51,g:0,b:0,a:255,t:0,s:0},{r:0,g:255,b:255,a:255,t:0,s:0},{r:0,g:255,b:204,a:255,t:0,s:0},{r:0,g:255,b:153,a:255,t:0,s:0},{r:0,g:255,b:102,a:255,t:0,s:0},{r:0,g:255,b:51,a:255,t:0,s:0},{r:0,g:255,b:0,a:255,t:0,s:0},{r:0,g:204,b:255,a:255,t:0,s:0},{r:0,g:204,b:204,a:255,t:0,s:0},{r:0,g:204,b:153,a:255,t:0,s:0},{r:0,g:204,b:102,a:255,t:0,s:0},{r:0,g:204,b:51,a:255,t:0,s:0},{r:0,g:204,b:0,a:255,t:0,s:0},{r:0,g:153,b:255,a:255,t:0,s:0},{r:0,g:153,b:204,a:255,t:0,s:0},{r:0,g:153,b:153,a:255,t:0,s:0},{r:0,g:153,b:102,a:255,t:0,s:0},{r:0,g:153,b:51,a:255,t:0,s:0},{r:0,g:153,b:0,a:255,t:0,s:0},{r:0,g:102,b:255,a:255,t:0,s:0},{r:0,g:102,b:204,a:255,t:0,s:0},{r:0,g:102,b:153,a:255,t:0,s:0},{r:0,g:102,b:102,a:255,t:0,s:0},{r:0,g:102,b:51,a:255,t:0,s:0},{r:0,g:102,b:0,a:255,t:0,s:0},{r:0,g:51,b:255,a:255,t:0,s:0},{r:0,g:51,b:204,a:255,t:0,s:0},{r:0,g:51,b:153,a:255,t:0,s:0},{r:0,g:51,b:102,a:255,t:0,s:0},{r:0,g:51,b:51,a:255,t:0,s:0},{r:0,g:51,b:0,a:255,t:0,s:0},{r:0,g:0,b:255,a:255,t:0,s:0},{r:0,g:0,b:204,a:255,t:0,s:0},{r:0,g:0,b:153,a:255,t:0,s:0},{r:0,g:0,b:102,a:255,t:0,s:0},{r:0,g:0,b:51,a:255,t:0,s:0},{r:238,g:0,b:0,a:255,t:0,s:0},{r:221,g:0,b:0,a:255,t:0,s:0},{r:187,g:0,b:0,a:255,t:0,s:0},{r:170,g:0,b:0,a:255,t:0,s:0},{r:136,g:0,b:0,a:255,t:0,s:0},{r:119,g:0,b:0,a:255,t:0,s:0},{r:85,g:0,b:0,a:255,t:0,s:0},{r:68,g:0,b:0,a:255,t:0,s:0},{r:34,g:0,b:0,a:255,t:0,s:0},{r:17,g:0,b:0,a:255,t:0,s:0},{r:0,g:238,b:0,a:255,t:0,s:0},{r:0,g:221,b:0,a:255,t:0,s:0},{r:0,g:187,b:0,a:255,t:0,s:0},{r:0,g:170,b:0,a:255,t:0,s:0},{r:0,g:136,b:0,a:255,t:0,s:0},{r:0,g:119,b:0,a:255,t:0,s:0},{r:0,g:85,b:0,a:255,t:0,s:0},{r:0,g:68,b:0,a:255,t:0,s:0},{r:0,g:34,b:0,a:255,t:0,s:0},{r:0,g:17,b:0,a:255,t:0,s:0},{r:0,g:0,b:238,a:255,t:0,s:0},{r:0,g:0,b:221,a:255,t:0,s:0},{r:0,g:0,b:187,a:255,t:0,s:0},{r:0,g:0,b:170,a:255,t:0,s:0},{r:0,g:0,b:136,a:255,t:0,s:0},{r:0,g:0,b:119,a:255,t:0,s:0},{r:0,g:0,b:85,a:255,t:0,s:0},{r:0,g:0,b:68,a:255,t:0,s:0},{r:0,g:0,b:34,a:255,t:0,s:0},{r:0,g:0,b:17,a:255,t:0,s:0},{r:238,g:238,b:238,a:255,t:0,s:0},{r:221,g:221,b:221,a:255,t:0,s:0},{r:187,g:187,b:187,a:255,t:0,s:0},{r:170,g:170,b:170,a:255,t:0,s:0},{r:136,g:136,b:136,a:255,t:0,s:0},{r:119,g:119,b:119,a:255,t:0,s:0},{r:85,g:85,b:85,a:255,t:0,s:0},{r:68,g:68,b:68,a:255,t:0,s:0},{r:34,g:34,b:34,a:255,t:0,s:0},{r:17,g:17,b:17,a:255,t:0,s:0}];console.log("default palette")}else{rawpalette=new Uint8Array(ab.slice(paletteBegin,paletteBegin+paletteLength));for(i=_i=0;_i<paletteLength;i=_i+=4){palette.push({r:rawpalette[i],g:rawpalette[i+1],b:rawpalette[i+2],a:rawpalette[i+3],t:0,s:0})}console.log("palette:");console.log(palette)}_this.voxels=[];voxelCount=new Uint32Array(ab.slice(voxelBegin,voxelBegin+4))[0];console.log("voxel count: "+voxelCount);if(voxelBegin+4+4*voxelCount!==voxelEnd){console.warn("invalid length of voxel chunk")}rawvoxels=new Uint8Array(ab.slice(voxelBegin+4,voxelBegin+4+4*voxelCount));for(i=_j=0,_ref3=4*voxelCount;_j<_ref3;i=_j+=4){if(_this.voxels[rawvoxels[i]]==null){_this.voxels[rawvoxels[i]]=[]}if(_this.voxels[rawvoxels[i]][rawvoxels[i+2]]==null){_this.voxels[rawvoxels[i]][rawvoxels[i+2]]=[]}_this.voxels[rawvoxels[i]][rawvoxels[i+2]][rawvoxels[i+1]]=palette[rawvoxels[i+3]-1]}console.log("voxels:");console.log(_this.voxels);return callback()}}(this);console.log("reading file with name: "+file.name);fr.readAsArrayBuffer(file)}MagicaIO.prototype["export"]=function(){var c1,c2,c3,c4,data,helpPalette,i,paletteChunk,rgba,s1,s2,s3,s4,sizeChunk,voxelChunk,x,x1,x2,x3,x4,y,y1,y2,y3,y4,z,z1,z2,z3,z4,_i,_j,_k,_ref,_ref1,_ref10,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;data=[86,79,88,32,150,0,0,0,77,65,73,78,0,0,0,0];_ref=new Uint8Array(new Uint32Array([this.x]).buffer),x1=_ref[0],x2=_ref[1],x3=_ref[2],x4=_ref[3];_ref1=new Uint8Array(new Uint32Array([this.y]).buffer),y1=_ref1[0],y2=_ref1[1],y3=_ref1[2],y4=_ref1[3];_ref2=new Uint8Array(new Uint32Array([this.z]).buffer),z1=_ref2[0],z2=_ref2[1],z3=_ref2[2],z4=_ref2[3];sizeChunk=[83,73,90,69,12,0,0,0,0,0,0,0,x1,x2,x3,x4,y1,y2,y3,y4,z1,z2,z3,z4];voxelChunk=[];paletteChunk=[82,71,66,65,0,4,0,0,0,0,0,0];helpPalette={};for(z=_i=0,_ref3=this.z;_i<_ref3;z=_i+=1){for(y=_j=0,_ref4=this.y;_j<_ref4;y=_j+=1){for(x=_k=0,_ref5=this.x;_k<_ref5;x=_k+=1){if(!(((_ref6=this.voxels[z])!=null?(_ref7=_ref6[y])!=null?_ref7[x]:void 0:void 0)!=null)){continue}rgba=(this.voxels[z][y][x].r<<24|this.voxels[z][y][x].g<<16|this.voxels[z][y][x].b<<8|this.voxels[z][y][x].a)>>>0;i=helpPalette[rgba];if(i==null){if(!(paletteChunk.length<1036)){throw new Error("To many colors for Magica Voxel palette")}paletteChunk=paletteChunk.concat([this.voxels[z][y][x].r,this.voxels[z][y][x].g,this.voxels[z][y][x].b,this.voxels[z][y][x].a]);i=paletteChunk.length/4-3;helpPalette[rgba]=i}voxelChunk=voxelChunk.concat([z,x,y,i])}}}while(paletteChunk.length<1036){paletteChunk=paletteChunk.concat([255,255,255,255])}_ref8=new Uint8Array(new Uint32Array([1076+voxelChunk.length]).buffer),s1=_ref8[0],s2=_ref8[1],s3=_ref8[2],s4=_ref8[3];data=data.concat([s1,s2,s3,s4]);data=data.concat(sizeChunk);_ref9=new Uint8Array(new Uint32Array([voxelChunk.length+4]).buffer),s1=_ref9[0],s2=_ref9[1],s3=_ref9[2],s4=_ref9[3];
_ref10=new Uint8Array(new Uint32Array([voxelChunk.length/4]).buffer),c1=_ref10[0],c2=_ref10[1],c3=_ref10[2],c4=_ref10[3];data=data.concat([88,89,90,73,s1,s2,s3,s4,0,0,0,0,c1,c2,c3,c4]);data=data.concat(voxelChunk);data=data.concat(paletteChunk);console.log("export Magica:");console.log(data);return URL.createObjectURL(new Blob([new Uint8Array(data)],{type:"application/octet-binary"}))};return MagicaIO}(IO);if(typeof module==="object"){module.exports=MagicaIO}else{window.MagicaIO=MagicaIO}}).call(this);(function(){var ZoxelIO,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ZoxelIO=function(_super){__extends(ZoxelIO,_super);function ZoxelIO(file,callback){var fr;if(ZoxelIO.__super__.constructor.call(this,file)){return}this.voxels=[];fr=new FileReader;fr.onloadend=function(_this){return function(){var c,data,f,frames,v,x,y,z,_i,_j,_len,_ref,_ref1;data=JSON.parse(fr.result);c=data["creator"],_this.x=data["width"],_this.y=data["height"],_this.z=data["depth"],v=data["version"],frames=data["frames"];console.log("creator: "+x);console.log("version: "+v+" (expected 1)");console.log("frames: "+frames+" (expected 1)");console.log("dimensions: width : "+_this.x+" height: "+_this.y+" depth: "+_this.z);console.log("frame data:");for(f=_i=1;_i<=frames;f=_i+=1){console.log(data["frame"+f]);_ref=data["frame"+f];for(_j=0,_len=_ref.length;_j<_len;_j++){_ref1=_ref[_j],x=_ref1[0],y=_ref1[1],z=_ref1[2],c=_ref1[3];if(_this.voxels[z]==null){_this.voxels[z]=[]}if(_this.voxels[z][y]==null){_this.voxels[z][y]=[]}_this.voxels[z][y][x]={r:(c&4278190080)>>>24,g:(c&16711680)>>>16,b:(c&65280)>>>8,a:c&255,t:0,s:0}}}console.log("voxels:");console.log(_this.voxels);return callback()}}(this);console.log("reading file with name: "+file.name);fr.readAsText(file)}ZoxelIO.prototype["export"]=function(){var frame,ix,iy,iz,json,x,y,z,_i,_j,_k,_len,_len1,_len2,_ref;frame=[];_ref=this.voxels;for(iz=_i=0,_len=_ref.length;_i<_len;iz=++_i){z=_ref[iz];if(z!=null){for(iy=_j=0,_len1=z.length;_j<_len1;iy=++_j){y=z[iy];if(y!=null){for(ix=_k=0,_len2=y.length;_k<_len2;ix=++_k){x=y[ix];if(x!=null){frame.push([ix,iy,iz,(x.r<<24|x.g<<16|x.b<<8|x.a)>>>0])}}}}}}json={creator:"Troxel",height:this.y,width:this.x,depth:this.z,version:1,frames:1,frame1:frame};console.log("Zoxel export:");console.log(json);return"data:application/octet-binary;base64,"+btoa(JSON.stringify(json))};return ZoxelIO}(IO);if(typeof module==="object"){module.exports=ZoxelIO}else{window.ZoxelIO=ZoxelIO}}).call(this);(function(){var Base64IO,JsonIO,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__slice=[].slice;Base64IO=function(_super){__extends(Base64IO,_super);function Base64IO(base64){var data,i,r,vox,x,y,z,_i,_j,_k,_ref,_ref1,_ref2,_ref3;if(Base64IO.__super__.constructor.call(this,base64)){return}this.voxels=[];_ref=atob(base64).split("").map(function(c){return c.charCodeAt(0)}),this.x=_ref[0],this.y=_ref[1],this.z=_ref[2],this.readonly=_ref[3],data=5<=_ref.length?__slice.call(_ref,4):[];i=r=0;vox={};for(z=_i=0,_ref1=this.z;_i<_ref1;z=_i+=1){for(y=_j=0,_ref2=this.y;_j<_ref2;y=_j+=1){for(x=_k=0,_ref3=this.x;_k<_ref3;x=_k+=1){if(r===0){if(data[i]>127){r=data[i]-127;i++}else{r=1}if(data[i]>127){throw new Error("Base64 parsing error")}if(data[i]<64){vox={r:data[i+1],g:data[i+2],b:data[i+3],a:data[i+4],s:data[i]%8,t:data[i]>>3};i+=5}else{vox=null;i++}}if(vox!=null){if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][y]==null){this.voxels[z][y]=[]}this.voxels[z][y][x]=vox}r--}}}if(i!==data.length){console.warn("There shouldn't be any bytes left")}if(!this.readonly){console.log("voxels:")}if(!this.readonly){console.log(this.voxels)}}Base64IO.prototype["export"]=function(readonly){var data,equal,i,r,vox,x,y,z,_i,_j,_k,_ref,_ref1,_ref2,_ref3,_ref4;equal=function(a,b,index){var i,_i,_len,_ref;if(!(index<vox.length)){return false}if(a==null&&b==null){return true}if(a==null||b==null){return false}_ref=["r","g","b","a","t","s"];for(_i=0,_len=_ref.length;_i<_len;_i++){i=_ref[_i];if(a[i]!==b[i]){return false}}return true};data=[this.x,this.y,this.z,readonly?1:0];vox=[];for(z=_i=0,_ref=this.z;_i<_ref;z=_i+=1){for(y=_j=0,_ref1=this.y;_j<_ref1;y=_j+=1){for(x=_k=0,_ref2=this.x;_k<_ref2;x=_k+=1){vox.push((_ref3=this.voxels[z])!=null?(_ref4=_ref3[y])!=null?_ref4[x]:void 0:void 0)}}}i=0;while(i<vox.length){r=1;while(r<128){if(equal(vox[i+r-1],vox[i+r],i+r)){r++}else{break}}if(r>1){data.push(127+r)}if(vox[i]!=null){data=data.concat([8*vox[i].t+vox[i].s,vox[i].r,vox[i].g,vox[i].b,vox[i].a])}else{data.push(64)}i+=r}console.log("export base64:");console.log(data);return btoa(String.fromCharCode.apply(null,data))};return Base64IO}(IO);JsonIO=function(_super){__extends(JsonIO,_super);function JsonIO(json){var _ref;if(JsonIO.__super__.constructor.call(this,json)){return}_ref=JSON.parse(json),this.x=_ref.x,this.y=_ref.y,this.z=_ref.z,this.voxels=_ref.voxels}JsonIO.prototype["export"]=function(pretty){return JSON.stringify({x:this.x,y:this.y,z:this.z,voxels:this.voxels},null,pretty?"    ":"")};return JsonIO}(IO);(typeof exports!=="undefined"&&exports!==null?exports:window).Base64IO=Base64IO;(typeof exports!=="undefined"&&exports!==null?exports:window).JsonIO=JsonIO}).call(this);(function(){var Renderer;Renderer=function(){function Renderer(io){var container,geometry,material,rollOverGeo,rollOverMaterial,voxel,x,y,z,_i,_j,_k,_l,_m,_n,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;this.voxels=io.voxels;this.x=io.x;this.y=io.y;this.z=io.z;this.objects=[];this.theta=-90;this.width=$("#WebGlContainer").width();this.height=window.innerHeight-55;this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e4);this.camera.position.y=this.y*60;this.camera.position.x=this.x*25+100*this.x*Math.sin(THREE.Math.degToRad(this.theta));this.camera.position.z=this.z*25+100*this.y*Math.cos(THREE.Math.degToRad(this.theta));this.camera.lookAt(new THREE.Vector3(this.x*25,this.y*25,this.z*25));this.scene=new THREE.Scene;rollOverGeo=new THREE.BoxGeometry(50,50,50);rollOverMaterial=new THREE.MeshBasicMaterial({color:16711680,opacity:.5,transparent:true});this.rollOverMesh=new THREE.Mesh(rollOverGeo,rollOverMaterial);this.scene.add(this.rollOverMesh);geometry=new THREE.Geometry;for(z=_i=0,_ref=this.z;_i<=_ref;z=_i+=1){geometry.vertices.push(new THREE.Vector3(0,0,50*z));geometry.vertices.push(new THREE.Vector3(50*this.x,0,50*z));geometry.vertices.push(new THREE.Vector3(50*this.x,0,50*z));geometry.vertices.push(new THREE.Vector3(50*this.x,50*this.y,50*z))}for(x=_j=0,_ref1=this.x;_j<=_ref1;x=_j+=1){geometry.vertices.push(new THREE.Vector3(50*x,0,0));geometry.vertices.push(new THREE.Vector3(50*x,0,50*this.z));geometry.vertices.push(new THREE.Vector3(50*x,0,0));geometry.vertices.push(new THREE.Vector3(50*x,50*this.y,0))}for(y=_k=0,_ref2=this.y;_k<=_ref2;y=_k+=1){geometry.vertices.push(new THREE.Vector3(0,50*y,0));geometry.vertices.push(new THREE.Vector3(50*this.x,50*y,0));geometry.vertices.push(new THREE.Vector3(50*this.x,50*y,0));geometry.vertices.push(new THREE.Vector3(50*this.x,50*y,50*this.z))}material=new THREE.LineBasicMaterial({color:0,opacity:.2,transparent:true});this.grid=new THREE.Line(geometry,material,THREE.LinePieces);this.scene.add(this.grid);geometry=new THREE.PlaneBufferGeometry(50*this.x,50*this.z);geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));this.plane=new THREE.Mesh(geometry);this.plane.position.x=25*this.x;this.plane.position.z=25*this.z;this.plane.visible=false;this.scene.add(this.plane);this.objects.push(this.plane);this.vector=new THREE.Vector3;this.raycaster=new THREE.Raycaster;for(z=_l=0,_ref3=this.z;_l<_ref3;z=_l+=1){for(y=_m=0,_ref4=this.y;_m<_ref4;y=_m+=1){for(x=_n=0,_ref5=this.x;_n<_ref5;x=_n+=1){if(!(((_ref6=this.voxels[z])!=null?(_ref7=_ref6[y])!=null?_ref7[x]:void 0:void 0)!=null)){continue}material=new THREE.MeshLambertMaterial({color:new THREE.Color("rgb("+this.voxels[z][y][x].r+","+this.voxels[z][y][x].g+","+this.voxels[z][y][x].b+")"),shading:THREE.FlatShading});material.ambient=material.color;if(this.voxels[z][y][x].a<255){material.transparent=true;material.opacity=this.voxels[z][y][x].a/255}voxel=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),material);voxel.position.x=x*50+25;voxel.position.y=y*50+25;voxel.position.z=z*50+25;this.scene.add(voxel);this.objects.push(voxel)}}}this.ambientLight=new THREE.AmbientLight(6316128);this.scene.add(this.ambientLight);this.directionalLight=new THREE.DirectionalLight(16777215);this.directionalLight.position.set(1,.75,.5).normalize();this.scene.add(this.directionalLight);this.renderer=new THREE.WebGLRenderer({antialias:true});this.renderer.setClearColor(8947848);this.renderer.setSize(this.width,this.height);$("#WebGlContainer").empty().append(this.renderer.domElement);container=document.getElementById("WebGlContainer");container.addEventListener("mousedown",function(_this){return function(e){return _this.onDocumentMouseDown(e)}}(this));container.addEventListener("mousemove",function(_this){return function(e){return _this.onDocumentMouseMove(e)}}(this));document.addEventListener("keydown",function(_this){return function(e){return _this.onDocumentKeyDown(e)}}(this));document.addEventListener("keyup",function(_this){return function(e){return _this.onDocumentKeyUp(e)}}(this));window.addEventListener("resize",function(_this){return function(e){return _this.onWindowResize(e)}}(this));this.controls=new THREE.OrbitControls(this.camera,container);this.controls.target=new THREE.Vector3(500,500,500);this.controls.addEventListener("change",function(_this){return function(){return _this.render()}}(this));this.controls.enabled=false;this.changeEditMode($("#modeEdit").parent().hasClass("active"));this.animate();this.render()}Renderer.prototype.reload=function(io){var material,o,voxel,x,y,z,_i,_j,_k,_l,_len,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;this.voxels=io.voxels;this.x=io.x;this.y=io.y;this.z=io.z;_ref=this.objects;for(_i=0,_len=_ref.length;_i<_len;_i++){o=_ref[_i];if(o!==this.plane){this.scene.remove(o)}}this.objects=[this.plane];for(z=_j=0,_ref1=this.z;_j<_ref1;z=_j+=1){for(y=_k=0,_ref2=this.y;_k<_ref2;y=_k+=1){for(x=_l=0,_ref3=this.x;_l<_ref3;x=_l+=1){if(!(((_ref4=this.voxels[z])!=null?(_ref5=_ref4[y])!=null?_ref5[x]:void 0:void 0)!=null)){continue}material=new THREE.MeshLambertMaterial({color:new THREE.Color("rgb("+this.voxels[z][y][x].r+","+this.voxels[z][y][x].g+","+this.voxels[z][y][x].b+")"),shading:THREE.FlatShading});material.ambient=material.color;if(this.voxels[z][y][x].a<255){material.transparent=true;material.opacity=this.voxels[z][y][x].a/255}voxel=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),material);voxel.position.x=x*50+25;voxel.position.y=y*50+25;voxel.position.z=z*50+25;this.scene.add(voxel);this.objects.push(voxel)}}}return this.render()};Renderer.prototype.changeEditMode=function(editMode){this.editMode=editMode;if(this.editMode){this.grid.visible=true;this.rollOverMesh.visible=true;this.controls.enabled=false}else{this.grid.visible=false;this.rollOverMesh.visible=false;this.controls.enabled=true}return this.render()};Renderer.prototype.animate=function(){requestAnimationFrame(function(_this){return function(){return _this.animate()}}(this));return this.controls.update()};Renderer.prototype.render=function(exportPng){this.renderer.render(this.scene,this.camera);if(exportPng){return window.open(this.renderer.domElement.toDataURL("image/png"),"Exported png")}};Renderer.prototype.onDocumentMouseMove=function(e){var intersect,intersects;if(!this.editMode||$("#openModal").css("display")==="block"||$("#exportModal").css("display")==="block"||$("#saveModal").css("display")==="block"){return}e.preventDefault();this.vector.set(e.clientX/this.width*2-1,-((e.clientY-50)/this.height)*2+1,.5);this.vector.unproject(this.camera);this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize());intersects=this.raycaster.intersectObjects(this.objects);if(intersects.length>0){intersect=intersects[0];this.rollOverMesh.position.copy(intersect.point).add(intersect.face.normal);this.rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)}return this.render()};Renderer.prototype.onDocumentMouseDown=function(e){var a,cubeMaterial,intersect,intersects,voxel,x,y,z;if(!this.editMode||$("#openModal").css("display")==="block"||$("#exportModal").css("display")==="block"||$("#saveModal").css("display")==="block"){return}this.vector.set(e.clientX/this.width*2-1,-((e.clientY-50)/this.height)*2+1,.5);this.vector.unproject(this.camera);this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize());intersects=this.raycaster.intersectObjects(this.objects);if(intersects.length>0){intersect=intersects[0];if(e.button===2){if(intersect.object!==this.plane){x=(intersect.object.position.x-25)/50;y=(intersect.object.position.y-25)/50;z=(intersect.object.position.z-25)/50;delete this.voxels[z][y][x];if(this.voxels[z][y].filter(function(e){return e!==void 0}).length===0){delete this.voxels[z][y]}if(this.voxels[z].filter(function(e){return e!==void 0}).length===0){delete this.voxels[z]}this.scene.remove(intersect.object);this.objects.splice(this.objects.indexOf(intersect.object),1)}}if(e.button===0){cubeMaterial=new THREE.MeshLambertMaterial({color:new THREE.Color($("#addVoxColor").val()),shading:THREE.FlatShading});cubeMaterial.ambient=cubeMaterial.color;a=parseInt($("#addVoxAlpha").val());if(a===272){a=255}if(a<255){cubeMaterial.transparent=true;cubeMaterial.opacity=a/255}voxel=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),cubeMaterial);voxel.position.copy(intersect.point).add(intersect.face.normal);voxel.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25);x=(voxel.position.x-25)/50;y=(voxel.position.y-25)/50;z=(voxel.position.z-25)/50;if(!(0<=x&&x<this.x&&(0<=y&&y<this.y)&&(0<=z&&z<this.z))){return}if(this.voxels[z]==null){this.voxels[z]=[]}if(this.voxels[z][y]==null){this.voxels[z][y]=[]}this.voxels[z][y][x]={r:parseInt($("#addVoxColor").val().substring(1,3),16),g:parseInt($("#addVoxColor").val().substring(3,5),16),b:parseInt($("#addVoxColor").val().substring(5,7),16),a:a,t:parseInt($("#addVoxType").val()),s:parseInt($("#addVoxSpecular").val())};this.scene.add(voxel);this.objects.push(voxel)}return this.render()}};Renderer.prototype.onDocumentKeyDown=function(e){switch(e.keyCode){case 18:this.controls.enabled=true;return this.editMode=false}};Renderer.prototype.onDocumentKeyUp=function(e){switch(e.keyCode){case 18:this.controls.enabled=false;return this.editMode=true}};Renderer.prototype.onWindowResize=function(){this.width=$("#WebGlContainer").width();this.height=window.innerHeight-55;this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.width,this.height);return this.render()};return Renderer}();if(typeof module==="object"){module.exports=Renderer}else{window.Renderer=Renderer}}).call(this);(function(){var dragFiles,dropFiles,io,renderer;io=null;dragFiles=null;renderer=null;window.onpopstate=function(){return window.location.hash.replace("#","").split("&").some(function(e){var param,value,_ref;_ref=e.split("="),param=_ref[0],value=_ref[1];if(param==="m"){io=new Base64IO(value);if(io.readonly===1){$("#btnExport").hide()}if(io.readonly===0){$("#btnExport").show()}$("#btnExportPng").show();renderer=new Renderer(io);return true}})};window.onpopstate();$('input[type="file"]').change(function(){var f,_i,_len,_results;if($(this).prop("files").length>1){dragFiles=$(this).prop("files");$("#filetabs li:last a").tab("show");$("#tabdrag ul").empty();_results=[];for(_i=0,_len=dragFiles.length;_i<_len;_i++){f=dragFiles[_i];_results.push($("#tabdrag ul").append($("<li>"+f.name+"</li>")))}return _results}});dropFiles=document.getElementById("openModal");dropFiles.addEventListener("dragover",function(e){e.stopPropagation();e.preventDefault();return e.dataTransfer.dropEffect="copy"});dropFiles.addEventListener("drop",function(e){var f,_i,_len,_results;e.stopPropagation();e.preventDefault();dragFiles=e.dataTransfer.files;if(dragFiles.length>0){$("#filetabs li:last a").tab("show");$("#tabdrag ul").empty();_results=[];for(_i=0,_len=dragFiles.length;_i<_len;_i++){f=dragFiles[_i];_results.push($("#tabdrag ul").append($("<li>"+f.name+"</li>")))}return _results}});$("#open").click(function(){var cb,f,files,i,_i,_len;cb=function(){$("#openModal").modal("hide");if(io.readonly==null||io.readonly===0){$("#btnExport").show()}$("#btnExportPng").show();renderer=new Renderer(io);return history.pushState({voxels:io.voxels,x:io.x,y:io.y,z:io.z},"Troxel","#m="+new Base64IO(io)["export"](false))};console.log("##################################################");switch($("#filetabs li.active a").attr("href")){case"#tabdrag":if(dragFiles[0].name.split(".").pop()==="zox"){return io=new ZoxelIO(dragFiles[0],cb)}else if(dragFiles[0].name.split(".").pop()==="vox"){return io=new MagicaIO(dragFiles[0],cb)}else if(dragFiles[0].name.split(".").pop()==="qb"){files={};for(i=_i=0,_len=dragFiles.length;_i<_len;i=++_i){f=dragFiles[i];switch(f.name.substr(-5)){case"_a.qb":if(files.a==null){files.a=f}break;case"_t.qb":if(files.t==null){files.t=f}break;case"_s.qb":if(files.s==null){files.s=f}break;default:if(f.name.substr(-3)===".qb"){files.m=f}}}if(files.m!=null){return io=new QubicleIO(files,cb)}else{return alert("Can't find Qubicle main mesh file!")}}else{return alert("Can't import selected file format.")}break;case"#tabqb":f=$("#fqb").prop("files")[0];if(f&&f.name.split(".").pop()==="qb"){return io=new QubicleIO({m:f,a:f=$("#fqba").prop("files")[0],t:f=$("#fqbt").prop("files")[0],s:f=$("#fqbs").prop("files")[0]},cb)}else{return alert("Please choose at least a valid main mesh Qubicle (.qb) file above!")}break;case"#tabvox":f=$("#fvox").prop("files")[0];if(f&&f.name.split(".").pop()==="vox"){return io=new MagicaIO(f,cb)}else{return alert("Please choose a valid Magica Voxel (.vox) file above!")}break;case"#tabzox":f=$("#fzox").prop("files")[0];if(f&&f.name.split(".").pop()==="zox"){return io=new ZoxelIO(f,cb)}else{return alert("Please choose a valid Zoxel (.zox) file above!")}break;case"#tabjson":io=new JsonIO($("#sjson").val());return cb()}});$("#btnExport").click(function(){$("#exportQb").text("Export as Qubicle (.qb) ...").removeAttr("href");$("#exportQba").hide().removeAttr("href");$("#exportQbt").hide().removeAttr("href");$("#exportQbs").hide().removeAttr("href");$("#exportZox").text("Export as Zoxel (.zox) ...").removeAttr("href");$("#exportVox").text("Export as Magica Voxel (.vox) ...").removeAttr("href");$("#exportBase64Ta").hide();return $("#exportJsonTa").hide()});$("#exportQb").click(function(){var href,hrefa,hrefs,hreft,_ref;if(io.readonly){return}if($(this).attr("href")==null){_ref=new QubicleIO(io)["export"]($("#exportQbComp").prop("checked")),href=_ref[0],hrefa=_ref[1],hreft=_ref[2],hrefs=_ref[3];$(this).text("Download main mash (.qb)").attr("href",href);$("#exportQba").show().attr("href",hrefa);$("#exportQbt").show().attr("href",hreft);return $("#exportQbs").show().attr("href",hrefs)}});$("#exportZox").click(function(){if(io.readonly){return}if($(this).attr("href")==null){return $(this).text("Download as Zoxel (.zox)").attr("href",new ZoxelIO(io)["export"]())}});$("#exportVox").click(function(){if(io.readonly){return}if($(this).attr("href")==null){return $(this).text("Download as Magica Voxel (.vox)").attr("href",new MagicaIO(io)["export"]())}});$("#exportBase64").click(function(){if(io.readonly){return}return $("#exportBase64Ta").val(window.location.origin+"/#m="+new Base64IO(io)["export"]($("#exportBase64Ro").prop("checked"))).fadeIn()});$("#exportJson").click(function(){if(io.readonly){return}return $("#exportJsonTa").val(new JsonIO(io)["export"]($("#exportJsonPret").prop("checked"))).fadeIn()});$("#btnExportPng").click(function(){return renderer.render(true)});$("#ulSavedModels").parent().on("show.bs.dropdown",function(e){var i,key,_i,_ref;if($(e.relatedTarget).data("tag")==="#ulSavedModels"){$("#ulSavedModels li:gt(6)").remove();if(window.localStorage.length===0){$("#ulSavedModels").append('<li class="disabled"><a>No saved models</a></li>')}for(i=_i=0,_ref=window.localStorage.length;_i<_ref;i=_i+=1){key=window.localStorage.key(i);$("#ulSavedModels").append("<li><a class='openSavedModel' data-model='"+window.localStorage.getItem(key)+"'>"+key+"</a></li>")}}return $(".openSavedModel").click(function(){io=new Base64IO($(this).data("model"));if(io.readonly==null||io.readonly===0){$("#btnExport").show()}$("#btnExportPng").show();history.pushState({voxels:io.voxels,x:io.x,y:io.y,z:io.z},"Toxel","#m="+$(this).data("model"));renderer=new Renderer(io);return $("#ulSavedModels li:eq(1) a").text($(this).text())})});$("#saveModelAs").click(function(){if(!($("#saveModelName").val().length>0&&io!=null)){return}window.localStorage.setItem($("#saveModelName").val(),new Base64IO(io)["export"](false));return $("#saveModal").modal("hide")});$("#modeView").click(function(){$(this).parent().addClass("active");$("#modeEdit").parent().removeClass("active");renderer.changeEditMode(false);return $("#addPanel").fadeOut()});$("#modeEdit").click(function(){if(io.readonly){return}$(this).parent().addClass("active");$("#modeView").parent().removeClass("active");renderer.changeEditMode(true);return $("#addPanel").fadeIn()});$(".rotateBtn").click(function(){if(io==null){return}switch($(this).data("rotate")){case"x":io.rotateX(true);break;case"-x":io.rotateX(false);break;case"y":io.rotateY(true);break;case"-y":io.rotateY(false);break;case"z":io.rotateZ(true);break;case"-z":io.rotateZ(false)}renderer=new Renderer(io);return history.pushState({voxels:io.voxels,x:io.x,y:io.y,z:io.z},"Troxel","#m="+new Base64IO(io)["export"](false))});$(".mirrorBtn").click(function(){if(io==null){return}switch($(this).data("mirror")){case"x":io.mirrorX(true);break;case"y":io.mirrorY(true);break;case"z":io.mirrorZ(true)}renderer.reload(io);return history.pushState({voxels:io.voxels,x:io.x,y:io.y,z:io.z},"Troxel","#m="+new Base64IO(io)["export"](false))});$(".panel-heading").click(function(){return $(this).next().toggle()});$("#ambLightColor").change(function(){if(io==null){return}renderer.ambientLight.color=new THREE.Color($(this).val());return renderer.render()})}).call(this)})();