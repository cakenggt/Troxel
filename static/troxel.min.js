(function(){var a;a=function(){function a(b){return b instanceof a||"object"==typeof b&&null!=b.x&&null!=b.y&&null!=b.z&&null!=b.voxels?(this.voxels=b.voxels,this.x=b.x,this.y=b.y,this.z=b.z,!0):void 0}return a.prototype.verify=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==this.x||null==this.y||null==this.z||null==this.voxels)return!1;if(!(this.x>0&&this.y>0&&this.z>0&&Array.isArray(this.voxels)))return!1;if(this.voxels.length>this.z)return!1;for(j=this.voxels,d=0,g=j.length;g>d;d++){if(c=j[d],!Array.isArray(c)||c.length>this.y)return!1;for(e=0,h=c.length;h>e;e++){if(b=c[e],!Array.isArray(b)||b.length>this.x)return!1;for(f=0,i=b.length;i>f;f++){if(a=b[f],"object"!=typeof a)return!1;if(!("number"==typeof a.r&&0<=(k=a.r)&&255>=k))return!1;if(!("number"==typeof a.g&&0<=(l=a.g)&&255>=l))return!1;if(!("number"==typeof a.b&&0<=(m=a.b)&&255>=m))return!1;if("number"!=typeof a.a||250!==(n=a.a)&&16!==n&&48!==n&&80!==n&&112!==n&&144!==n&&176!==n&&208!==n&&240!==n&&255!==n)return!1;if("number"!=typeof a.t||!(0<=(o=a.t)&&4>=o||7===a.t))return!1;if("number"!=typeof a.s||!(0<=(p=a.s)&&3>=p||7===a.s))return!1}}}return!0},a.prototype.rotateX=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=this.voxels.slice(0),this.voxels=[],e=f=0,i=this.z;i>f;e=f+=1)for(d=g=0,j=this.y;j>g;d=g+=1)for(c=h=0,k=this.x;k>h;c=h+=1)null!=(null!=(l=b[a?this.z-e-1:e])&&null!=(m=l[a?d:this.y-d-1])?m[c]:void 0)&&(null==this.voxels[d]&&(this.voxels[d]=[]),null==this.voxels[d][e]&&(this.voxels[d][e]=[]),this.voxels[d][e][c]=b[a?this.z-e-1:e][a?d:this.y-d-1][c]);return n=[this.y,this.z],this.z=n[0],this.y=n[1],n},a.prototype.rotateY=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=this.voxels.slice(0),this.voxels=[],e=f=0,i=this.z;i>f;e=f+=1)for(d=g=0,j=this.y;j>g;d=g+=1)for(c=h=0,k=this.x;k>h;c=h+=1)null!=(null!=(l=b[a?this.z-e-1:e])&&null!=(m=l[d])?m[a?c:this.x-c-1]:void 0)&&(null==this.voxels[c]&&(this.voxels[c]=[]),null==this.voxels[c][d]&&(this.voxels[c][d]=[]),this.voxels[c][d][e]=b[a?this.z-e-1:e][d][a?c:this.x-c-1]);return n=[this.x,this.z],this.z=n[0],this.x=n[1],n},a.prototype.rotateZ=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=this.voxels.slice(0),this.voxels=[],e=f=0,i=this.z;i>f;e=f+=1)for(d=g=0,j=this.y;j>g;d=g+=1)for(c=h=0,k=this.x;k>h;c=h+=1)null!=(null!=(l=b[e])&&null!=(m=l[a?d:this.y-d-1])?m[a?this.x-c-1:c]:void 0)&&(null==this.voxels[e]&&(this.voxels[e]=[]),null==this.voxels[e][c]&&(this.voxels[e][c]=[]),this.voxels[e][c][d]=b[e][a?d:this.y-d-1][a?this.x-c-1:c]);return n=[this.x,this.y],this.y=n[0],this.x=n[1],n},a.prototype.mirrorX=function(){var a,b,c,d,e,f,g;for(a=this.voxels.slice(0),this.voxels=[],g=[],d=e=0,f=this.z;f>e;d=e+=1)g.push(function(){var e,f,g;for(g=[],c=e=0,f=this.y;f>e;c=e+=1)g.push(function(){var e,f,g,h,i;for(i=[],b=e=0,f=this.x;f>e;b=e+=1)null!=(null!=(g=a[d])&&null!=(h=g[c])?h[this.x-b-1]:void 0)&&(null==this.voxels[d]&&(this.voxels[d]=[]),null==this.voxels[d][c]&&(this.voxels[d][c]=[]),i.push(this.voxels[d][c][b]=a[d][c][this.x-b-1]));return i}.call(this));return g}.call(this));return g},a.prototype.mirrorY=function(){var a,b,c,d,e,f,g;for(a=this.voxels.slice(0),this.voxels=[],g=[],d=e=0,f=this.z;f>e;d=e+=1)g.push(function(){var e,f,g;for(g=[],c=e=0,f=this.y;f>e;c=e+=1)g.push(function(){var e,f,g,h,i;for(i=[],b=e=0,f=this.x;f>e;b=e+=1)null!=(null!=(g=a[d])&&null!=(h=g[this.y-c-1])?h[b]:void 0)&&(null==this.voxels[d]&&(this.voxels[d]=[]),null==this.voxels[d][c]&&(this.voxels[d][c]=[]),i.push(this.voxels[d][c][b]=a[d][this.y-c-1][b]));return i}.call(this));return g}.call(this));return g},a.prototype.mirrorZ=function(){var a,b,c,d,e,f,g;for(a=this.voxels.slice(0),this.voxels=[],g=[],d=e=0,f=this.z;f>e;d=e+=1)g.push(function(){var e,f,g;for(g=[],c=e=0,f=this.y;f>e;c=e+=1)g.push(function(){var e,f,g,h,i;for(i=[],b=e=0,f=this.x;f>e;b=e+=1)null!=(null!=(g=a[this.z-d-1])&&null!=(h=g[c])?h[b]:void 0)&&(null==this.voxels[d]&&(this.voxels[d]=[]),null==this.voxels[d][c]&&(this.voxels[d][c]=[]),i.push(this.voxels[d][c][b]=a[this.z-d-1][c][b]));return i}.call(this));return g}.call(this));return g},a.prototype.moveX=function(a){var b,c,d,e,f,g,h;for(h=[],e=f=0,g=this.z;g>f;e=f+=1)null!=this.voxels[e]&&h.push(function(){var f,g,h,i,j,k,l,m;for(m=[],d=f=0,h=this.y;h>f;d=f+=1)if(null!=(null!=(i=this.voxels[e])?i[d]:void 0)){for(c=this.voxels[e][d][a?0:this.x-1],b=g=0,j=this.x-1;j>g;b=g+=1)null!=(null!=(k=this.voxels[e])&&null!=(l=k[d])?l[a?b+1:this.x-2-b]:void 0)?this.voxels[e][d][a?b:this.x-1-b]=this.voxels[e][d][a?b+1:this.x-2-b]:delete this.voxels[e][d][a?b:this.x-1-b];m.push(null!=c?this.voxels[e][d][a?this.x-1:0]=c:delete this.voxels[e][d][a?this.x-1:0])}return m}.call(this));return h},a.prototype.moveY=function(a){var b,c,d,e,f,g,h,i,j;for(j=[],d=e=0,g=this.z;g>e;d=e+=1)if(null!=this.voxels[d]){for(c=this.voxels[d][a?0:this.y-1],b=f=0,h=this.y-1;h>f;b=f+=1)null!=(null!=(i=this.voxels[d])?i[a?b+1:this.y-2-b]:void 0)?this.voxels[d][a?b:this.y-1-b]=this.voxels[d][a?b+1:this.y-2-b]:delete this.voxels[d][a?b:this.y-1-b];j.push(null!=c?this.voxels[d][a?this.y-1:0]=c:delete this.voxels[d][a?this.y-1:0])}return j},a.prototype.moveZ=function(a){var b,c,d,e;for(c=this.voxels[a?0:this.z-1],b=d=0,e=this.z-1;e>d;b=d+=1)null!=this.voxels[a?b+1:this.z-2-b]?this.voxels[a?b:this.z-1-b]=this.voxels[a?b+1:this.z-2-b]:delete this.voxels[a?b:this.z-1-b];return null!=c?this.voxels[a?this.z-1:0]=c:delete this.voxels[a?this.z-1:0]},a.prototype.resize=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(c<this.z)for(f=g=c,m=this.z;m>g;f=g+=1)delete this.voxels[f];if(this.z=c,b<this.y)for(f=h=0,n=this.z;n>h;f=h+=1)if(null!=this.voxels[f])for(e=i=b,o=this.y;o>i;e=i+=1)delete this.voxels[f][e];if(this.y=b,c<this.z)for(f=j=0,p=this.z;p>j;f=j+=1)if(null!=this.voxels[f])for(e=k=0,q=this.y;q>k;e=k+=1)if(null!=this.voxels[f][e])for(d=l=a,r=this.x;r>l;d=l+=1)delete this.voxels[f][e][f];return this.x=a},a}(),"object"==typeof module?module.exports=a:window.IO=a}).call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(a,c){var d;b.__super__.constructor.call(this,a)||(this.voxels=[],this.x=this.y=this.z=-1,this.loadingState=0,d=new FileReader,d.onloadend=function(b){return function(){var e,f,g;return b.readFile(d.result,0),null!=a.a?(e=new FileReader,e.onloadend=function(){return b.readFile(e.result,1),2===b.loadingState++?c():void 0},console.log("reading alpha file with name: "+a.a.name),e.readAsArrayBuffer(a.a)):b.loadingState++,null!=a.t?(g=new FileReader,g.onloadend=function(){return b.readFile(g.result,2),2===b.loadingState++?c():void 0},console.log("reading type file with name: "+a.t.name),g.readAsArrayBuffer(a.t)):b.loadingState++,null!=a.s?(f=new FileReader,f.onloadend=function(){return b.readFile(f.result,3),2===b.loadingState++?c():void 0},console.log("reading specular file with name: "+a.s.name),f.readAsArrayBuffer(a.s)):b.loadingState++,3===b.loadingState?c():void 0}}(this),console.log("reading file with name: "+a.m.name),d.readAsArrayBuffer(a.m))}return c(b,a),b.prototype.readFile=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;if(console.log("file.byteLength: "+a.byteLength),N=new Uint32Array(a.slice(0,24)),z=N[0],d=N[1],E=N[2],e=N[3],A=N[4],v=N[5],console.log("version: "+z+" (expected 257 = 1.1.0.0 = current version)"),257!==z&&console.warn("Expected version 257 but found version: "+z+" (May result in errors)"),console.log("color format: "+d+" (0 for RGBA (recommended) or 1 for BGRA)"),console.log("z-axis oriantation: "+E+" (0 for left (recommended), 1 for right handed)"),console.log("compression: "+e+" (0 for uncompressed, 1 for compressed with run length encoding (RLE))"),console.log("visability mask: "+A+" (should be 0 for encoded in A value, no partially visability)"),0!==A&&console.warn("partially visability not supported and will be ignored / handled as full visibility"),console.log("matrix count:  "+v),v>1&&console.warn("matrices will be merged into one matrix with regard to their offsets"),i=k=m=0,v>1)for(w=24,n=F=1;v>=F;n=F+=1)if(y=new Uint8Array(a.slice(w,w+1))[0],O=new Uint32Array(a.slice(w+1+y,w+13+y)),B=O[0],C=O[1],D=O[2],P=new Int32Array(a.slice(w+13+y,w+25+y)),h=P[0],j=P[1],l=P[2],i=Math.min(i,h),k=Math.min(k,j),m=Math.min(m,l),0===e)w+=25+y+4*B*C*D;else{for(o=0,g=new Uint8Array(a.slice(w+25+y)),s=G=0;D>G;s=G+=1)for(;;){if(o+=4,6===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1])break;2===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1]&&(o+=8)}w+=25+y+o}for(u=24,n=H=1;v>=H;n=H+=1){if(console.log("------------------------ Matrix: "+n+" ------------------------"),y=new Uint8Array(a.slice(u,u+1))[0],x=function(){var b,d,e,f;for(e=new Uint8Array(a.slice(u+1,u+1+y)),f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(String.fromCharCode(c));return f}().join(""),console.log("reading "+n+". matrix with name: "+x),Q=new Uint32Array(a.slice(u+1+y,u+13+y)),B=Q[0],C=Q[1],D=Q[2],console.log("dimensions: width: "+B+" height: "+C+" depth: "+D),C>4294967e3)return this.error=!0;if(R=new Int32Array(a.slice(u+13+y,u+25+y)),h=R[0],j=R[1],l=R[2],console.log("position: dx : "+h+" dy: "+j+" dz: "+l+" (ignored if only 1 matrix)"),1===v&&(h=j=l=0),v>1&&(h-=i,j-=k,l-=m),console.log("position result: dx : "+h+" dy: "+j+" dz: "+l),0===b&&(this.x=Math.max(this.x,B+h),this.y=Math.max(this.y,C+j),this.z=Math.max(this.z,D+l)),0===e){for(g=new Uint8Array(a.slice(u+25+y,u+25+y+4*B*C*D)),s=I=0;D>I;s=I+=1)for(r=J=0;C>J;r=J+=1)for(q=K=0;B>K;q=K+=1)o=4*(s*C*B+r*B+q),g[o+3]>0&&this.addValues(b,q+h,r+j,D,s,l,E,g[o],g[o+1],g[o+2],d);u+=25+y+4*B*C*D}else{for(g=new Uint8Array(a.slice(u+25+y)),o=0,s=L=0;D>L;s=L+=1)for(p=0;;){if(o+=4,6===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1])break;if(2===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1]){if(f=new Uint32Array(new Uint8Array([g[o],g[o+1],g[o+2],g[o+3]]).buffer)[0],f>255&&console.log("high voxel repeat count: "+f),g[o+7]>0)for(t=M=0;f>M;t=M+=1)q=p%B,r=Math.floor(p/B),p++,this.addValues(b,q+h,r+j,D,s,l,E,g[o+4],g[o+5],g[o+6],d);else p+=f;o+=8}else q=p%B,r=Math.floor(p/B),p++,g[o-1]>0&&this.addValues(b,q+h,r+j,D,s,l,E,g[o-4],g[o-3],g[o-2],d)}u+=25+y+o}}return console.log("voxels:"),console.log(this.voxels),u!==a.byteLength?console.warn(console.log("There shouldn't be any bytes left")):void 0},b.prototype.addValues=function(a,b,c,d,e,f,g,h,i,j,k){var l;switch(d=(0===g?e:d-e-1)+f,1===k&&(l=[j,h],h=l[0],j=l[1]),a){case 0:return this.addColorValues(b,c,d,h,i,j);case 1:return this.addAlphaValues(b,c,d,h,i,j);case 2:return this.addTypeValues(b,c,d,h,i,j);case 3:return this.addSpecularValues(b,c,d,h,i,j)}},b.prototype.addColorValues=function(a,b,c,d,e,f){return null==this.voxels[c]&&(this.voxels[c]=[]),null==this.voxels[c][b]&&(this.voxels[c][b]=[]),this.voxels[c][b][a]=d===f&&255===f&&0===e?{r:255,g:0,b:255,a:250,t:7,s:7}:{r:d,g:e,b:f,a:255,t:0,s:0}},b.prototype.addAlphaValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?console.warn("Ignoring alpha voxel because of non existing color voxel at the same position"):d===e&&e===f?16===d||48===d||80===d||112===d||144===d||176===d||208===d||240===d||255===d?this.voxels[c][b][a].a=d:(console.warn("invalid alpha value "+d+": falling back to 122"),this.voxels[c][b][a].a=112):d===f&&255===f&&0===e?this.voxels[c][b][a].a=250:(console.warn("invalid alpha value: r, g and b are not equal, falling back to 112"),this.voxels[c][b][a].a=112)},b.prototype.addTypeValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?console.warn("Ignoring type voxel because of non existing color voxel at the same position"):255===d&&255===e&&255===f?this.voxels[c][b][a].t=0:128===d&&128===e&&128===f?this.voxels[c][b][a].t=1:64===d&&64===e&&64===f?this.voxels[c][b][a].t=2:255===d&&0===e&&0===f?this.voxels[c][b][a].t=3:255===d&&255===e&&0===f?this.voxels[c][b][a].t=4:255===d&&0===e&&255===f?this.voxels[c][b][a].t=7:(console.warn("invalid type value (r: "+d+", g: "+e+", b: "+f+"), falling back to solid"),this.voxels[c][b][a].t=0)},b.prototype.addSpecularValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?console.warn("Ignoring specular voxel because of non existing color voxel at the same position"):128===d&&0===e&&0===f?this.voxels[c][b][a].s=0:0===d&&128===e&&0===f?this.voxels[c][b][a].s=1:0===d&&0===e&&128===f?this.voxels[c][b][a].s=2:128===d&&128===e&&0===f?this.voxels[c][b][a].s=3:255===d&&0===e&&255===f?this.voxels[c][b][a].s=7:((d!==e||e!==f||255!==f)&&console.warn("invalid specular value (r: "+d+", g: "+e+", b: "+f+"), falling back to rough"),this.voxels[c][b][a].s=0)},b.prototype["export"]=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(f=[1,1,0,0,0,0,0,0,0,0,0,0,+a,0,0,0,0,0,0,0,1,0,0,0,5,77,157,144,145,154,this.x,0,0,0,this.y,0,0,0,this.z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=f.slice(0),i=f.slice(0),h=f.slice(0),k=function(a){return null!=a?(f=f.concat([a.r,a.g,a.b,255]),g=g.concat(function(){switch(a.a){case 250:return[255,0,255,255];case 255:return[255,255,255,255];case 240:return[240,240,240,255];case 208:return[208,208,208,255];case 176:return[176,176,176,255];case 144:return[144,144,144,255];case 112:return[112,112,112,255];case 80:return[80,80,80,255];case 48:return[48,48,48,255];case 16:return[16,16,16,255];default:return[112,112,112,255]}}()),i=i.concat(function(){switch(a.t){case 0:return[255,255,255,255];case 1:return[128,128,128,255];case 2:return[64,64,64,255];case 3:return[255,0,0,255];case 4:return[255,255,0,255];case 7:return[255,0,255,255];default:return[255,255,255,255]}}()),h=h.concat(function(){switch(a.s){case 0:return[128,0,0,255];case 1:return[0,128,0,255];case 2:return[0,0,128,255];case 3:return[128,128,0,255];case 7:return[255,0,255,255];default:return[128,0,0,255]}}())):(f=f.concat([0,0,0,0]),g=g.concat([0,0,0,0]),i=i.concat([0,0,0,0]),h=h.concat([0,0,0,0]))},j=function(a,b){var c,d,e,f;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;for(f=["r","g","b","a","t","s"],d=0,e=f.length;e>d;d++)if(c=f[d],a[c]!==b[c])return!1;return!0},a)for(s=t=0,B=this.z;B>t;s=t+=1){if(null!=this.voxels[s]){for(p=[],m=-1,r=u=0,C=this.y;C>u;r=u+=1)for(q=v=0,F=this.x;F>v;q=v+=1)p.push(null!=(G=this.voxels[s][r])?G[q]:void 0),null!=(null!=(H=this.voxels[s][r])?H[q]:void 0)&&(m=p.length-1);for(l=0;m>=l;){for(n=1;m>=l+n&&j(p[l+n-1],p[l+n]);)n++;n>1&&(I=new Uint8Array(new Uint32Array([n]).buffer),b=I[0],c=I[1],d=I[2],e=I[3],f=f.concat([2,0,0,0,b,c,d,e]),g=g.concat([2,0,0,0,b,c,d,e]),i=i.concat([2,0,0,0,b,c,d,e]),h=h.concat([2,0,0,0,b,c,d,e])),k(p[l]),l+=n}}f=f.concat([6,0,0,0]),g=g.concat([6,0,0,0]),i=i.concat([6,0,0,0]),h=h.concat([6,0,0,0])}else for(s=w=0,J=this.z;J>w;s=w+=1)for(r=y=0,K=this.y;K>y;r=y+=1)for(q=z=0,L=this.x;L>z;q=z+=1)k(null!=(M=this.voxels[s])&&null!=(D=M[r])?D[q]:void 0);for(console.log("export Qubicle:"),console.log(f),E=[f,g,i,h],N=[],A=0,x=E.length;x>A;A++)o=E[A],N.push(URL.createObjectURL(new Blob([new Uint8Array(o)],{type:"application/octet-binary"})));return N},b}(IO),"object"==typeof module?module.exports=a:window.QubicleIO=a}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(a,c){var d;b.__super__.constructor.call(this,a)||(d=new FileReader,d.onloadend=function(a){return function(){var b,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(b=d.result,n=function(){var a,c,d,f;for(d=new Uint8Array(b.slice(0,4)),f=[],a=0,c=d.length;c>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log("meta: "+n+" (expected VOX )"),"VOX "!==n)throw new Error("Expected Magica Voxel header not found");if(v=new Uint32Array(b.slice(4,8))[0],console.log("version: "+v+" (expected 150)"),150!==v&&console.warn("Expected version 150 but found version: "+v+" (May result in errors)"),l=function(){var a,c,d,f;for(d=new Uint8Array(b.slice(8,12)),f=[],a=0,c=d.length;c>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log("mainChunkId: "+l+" (expected MAIN)"),"MAIN"!==l)throw new Error("Didn't found main Chunk as expected");for(C=new Uint32Array(b.slice(12,20)),m=C[0],k=C[1],console.log("mainChunkSize: "+m+" (expected 0)"),console.log("mainChunkChildSize: "+k),20+k!==b.byteLength&&console.warn(console.log("There shouldn't be any bytes left")),h=20+m,t=u=x=z=p=q=-1;20+m+k>h;){switch(g=function(){var a,c,d,f;for(d=new Uint8Array(b.slice(h,h+4)),f=[],a=0,c=d.length;c>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log(new Uint8Array(b.slice(h,h+12))),D=new Uint32Array(b.slice(h+4,h+12)),i=D[0],f=D[1],console.log("found child chunk: "+g+" with begin: "+(h+12)+", size: "+i+" and childSize: "+f+" (expected 0)"),g){case"SIZE":12!==i&&console.warn("invalid length of size chunk"),t=h+12,u=t+i;break;case"XYZI":x=h+12,z=x+i;break;case"RGBA":p=h+12,1024!==i&&console.warn("invalid length of palette chunk"),q=i}h+=12+i+f}if(-1===t||-1===u||-1===x||-1===z)throw new Error("missing chunks");if(E=new Uint32Array(b.slice(t,u)),a.x=E[0],a.z=E[1],a.y=E[2],console.log("dimensions: width: "+a.x+" height: "+a.y+" depth: "+a.z),o=[],-1===p||-1===q)o=[{r:255,g:255,b:255,a:255,t:0,s:0},{r:255,g:255,b:204,a:255,t:0,s:0},{r:255,g:255,b:153,a:255,t:0,s:0},{r:255,g:255,b:102,a:255,t:0,s:0},{r:255,g:255,b:51,a:255,t:0,s:0},{r:255,g:255,b:0,a:255,t:0,s:0},{r:255,g:204,b:255,a:255,t:0,s:0},{r:255,g:204,b:204,a:255,t:0,s:0},{r:255,g:204,b:153,a:255,t:0,s:0},{r:255,g:204,b:102,a:255,t:0,s:0},{r:255,g:204,b:51,a:255,t:0,s:0},{r:255,g:204,b:0,a:255,t:0,s:0},{r:255,g:153,b:255,a:255,t:0,s:0},{r:255,g:153,b:204,a:255,t:0,s:0},{r:255,g:153,b:153,a:255,t:0,s:0},{r:255,g:153,b:102,a:255,t:0,s:0},{r:255,g:153,b:51,a:255,t:0,s:0},{r:255,g:153,b:0,a:255,t:0,s:0},{r:255,g:102,b:255,a:255,t:0,s:0},{r:255,g:102,b:204,a:255,t:0,s:0},{r:255,g:102,b:153,a:255,t:0,s:0},{r:255,g:102,b:102,a:255,t:0,s:0},{r:255,g:102,b:51,a:255,t:0,s:0},{r:255,g:102,b:0,a:255,t:0,s:0},{r:255,g:51,b:255,a:255,t:0,s:0},{r:255,g:51,b:204,a:255,t:0,s:0},{r:255,g:51,b:153,a:255,t:0,s:0},{r:255,g:51,b:102,a:255,t:0,s:0},{r:255,g:51,b:51,a:255,t:0,s:0},{r:255,g:51,b:0,a:255,t:0,s:0},{r:255,g:0,b:255,a:255,t:0,s:0},{r:255,g:0,b:204,a:255,t:0,s:0},{r:255,g:0,b:153,a:255,t:0,s:0},{r:255,g:0,b:102,a:255,t:0,s:0},{r:255,g:0,b:51,a:255,t:0,s:0},{r:255,g:0,b:0,a:255,t:0,s:0},{r:204,g:255,b:255,a:255,t:0,s:0},{r:204,g:255,b:204,a:255,t:0,s:0},{r:204,g:255,b:153,a:255,t:0,s:0},{r:204,g:255,b:102,a:255,t:0,s:0},{r:204,g:255,b:51,a:255,t:0,s:0},{r:204,g:255,b:0,a:255,t:0,s:0},{r:204,g:204,b:255,a:255,t:0,s:0},{r:204,g:204,b:204,a:255,t:0,s:0},{r:204,g:204,b:153,a:255,t:0,s:0},{r:204,g:204,b:102,a:255,t:0,s:0},{r:204,g:204,b:51,a:255,t:0,s:0},{r:204,g:204,b:0,a:255,t:0,s:0},{r:204,g:153,b:255,a:255,t:0,s:0},{r:204,g:153,b:204,a:255,t:0,s:0},{r:204,g:153,b:153,a:255,t:0,s:0},{r:204,g:153,b:102,a:255,t:0,s:0},{r:204,g:153,b:51,a:255,t:0,s:0},{r:204,g:153,b:0,a:255,t:0,s:0},{r:204,g:102,b:255,a:255,t:0,s:0},{r:204,g:102,b:204,a:255,t:0,s:0},{r:204,g:102,b:153,a:255,t:0,s:0},{r:204,g:102,b:102,a:255,t:0,s:0},{r:204,g:102,b:51,a:255,t:0,s:0},{r:204,g:102,b:0,a:255,t:0,s:0},{r:204,g:51,b:255,a:255,t:0,s:0},{r:204,g:51,b:204,a:255,t:0,s:0},{r:204,g:51,b:153,a:255,t:0,s:0},{r:204,g:51,b:102,a:255,t:0,s:0},{r:204,g:51,b:51,a:255,t:0,s:0},{r:204,g:51,b:0,a:255,t:0,s:0},{r:204,g:0,b:255,a:255,t:0,s:0},{r:204,g:0,b:204,a:255,t:0,s:0},{r:204,g:0,b:153,a:255,t:0,s:0},{r:204,g:0,b:102,a:255,t:0,s:0},{r:204,g:0,b:51,a:255,t:0,s:0},{r:204,g:0,b:0,a:255,t:0,s:0},{r:153,g:255,b:255,a:255,t:0,s:0},{r:153,g:255,b:204,a:255,t:0,s:0},{r:153,g:255,b:153,a:255,t:0,s:0},{r:153,g:255,b:102,a:255,t:0,s:0},{r:153,g:255,b:51,a:255,t:0,s:0},{r:153,g:255,b:0,a:255,t:0,s:0},{r:153,g:204,b:255,a:255,t:0,s:0},{r:153,g:204,b:204,a:255,t:0,s:0},{r:153,g:204,b:153,a:255,t:0,s:0},{r:153,g:204,b:102,a:255,t:0,s:0},{r:153,g:204,b:51,a:255,t:0,s:0},{r:153,g:204,b:0,a:255,t:0,s:0},{r:153,g:153,b:255,a:255,t:0,s:0},{r:153,g:153,b:204,a:255,t:0,s:0},{r:153,g:153,b:153,a:255,t:0,s:0},{r:153,g:153,b:102,a:255,t:0,s:0},{r:153,g:153,b:51,a:255,t:0,s:0},{r:153,g:153,b:0,a:255,t:0,s:0},{r:153,g:102,b:255,a:255,t:0,s:0},{r:153,g:102,b:204,a:255,t:0,s:0},{r:153,g:102,b:153,a:255,t:0,s:0},{r:153,g:102,b:102,a:255,t:0,s:0},{r:153,g:102,b:51,a:255,t:0,s:0},{r:153,g:102,b:0,a:255,t:0,s:0},{r:153,g:51,b:255,a:255,t:0,s:0},{r:153,g:51,b:204,a:255,t:0,s:0},{r:153,g:51,b:153,a:255,t:0,s:0},{r:153,g:51,b:102,a:255,t:0,s:0},{r:153,g:51,b:51,a:255,t:0,s:0},{r:153,g:51,b:0,a:255,t:0,s:0},{r:153,g:0,b:255,a:255,t:0,s:0},{r:153,g:0,b:204,a:255,t:0,s:0},{r:153,g:0,b:153,a:255,t:0,s:0},{r:153,g:0,b:102,a:255,t:0,s:0},{r:153,g:0,b:51,a:255,t:0,s:0},{r:153,g:0,b:0,a:255,t:0,s:0},{r:102,g:255,b:255,a:255,t:0,s:0},{r:102,g:255,b:204,a:255,t:0,s:0},{r:102,g:255,b:153,a:255,t:0,s:0},{r:102,g:255,b:102,a:255,t:0,s:0},{r:102,g:255,b:51,a:255,t:0,s:0},{r:102,g:255,b:0,a:255,t:0,s:0},{r:102,g:204,b:255,a:255,t:0,s:0},{r:102,g:204,b:204,a:255,t:0,s:0},{r:102,g:204,b:153,a:255,t:0,s:0},{r:102,g:204,b:102,a:255,t:0,s:0},{r:102,g:204,b:51,a:255,t:0,s:0},{r:102,g:204,b:0,a:255,t:0,s:0},{r:102,g:153,b:255,a:255,t:0,s:0},{r:102,g:153,b:204,a:255,t:0,s:0},{r:102,g:153,b:153,a:255,t:0,s:0},{r:102,g:153,b:102,a:255,t:0,s:0},{r:102,g:153,b:51,a:255,t:0,s:0},{r:102,g:153,b:0,a:255,t:0,s:0},{r:102,g:102,b:255,a:255,t:0,s:0},{r:102,g:102,b:204,a:255,t:0,s:0},{r:102,g:102,b:153,a:255,t:0,s:0},{r:102,g:102,b:102,a:255,t:0,s:0},{r:102,g:102,b:51,a:255,t:0,s:0},{r:102,g:102,b:0,a:255,t:0,s:0},{r:102,g:51,b:255,a:255,t:0,s:0},{r:102,g:51,b:204,a:255,t:0,s:0},{r:102,g:51,b:153,a:255,t:0,s:0},{r:102,g:51,b:102,a:255,t:0,s:0},{r:102,g:51,b:51,a:255,t:0,s:0},{r:102,g:51,b:0,a:255,t:0,s:0},{r:102,g:0,b:255,a:255,t:0,s:0},{r:102,g:0,b:204,a:255,t:0,s:0},{r:102,g:0,b:153,a:255,t:0,s:0},{r:102,g:0,b:102,a:255,t:0,s:0},{r:102,g:0,b:51,a:255,t:0,s:0},{r:102,g:0,b:0,a:255,t:0,s:0},{r:51,g:255,b:255,a:255,t:0,s:0},{r:51,g:255,b:204,a:255,t:0,s:0},{r:51,g:255,b:153,a:255,t:0,s:0},{r:51,g:255,b:102,a:255,t:0,s:0},{r:51,g:255,b:51,a:255,t:0,s:0},{r:51,g:255,b:0,a:255,t:0,s:0},{r:51,g:204,b:255,a:255,t:0,s:0},{r:51,g:204,b:204,a:255,t:0,s:0},{r:51,g:204,b:153,a:255,t:0,s:0},{r:51,g:204,b:102,a:255,t:0,s:0},{r:51,g:204,b:51,a:255,t:0,s:0},{r:51,g:204,b:0,a:255,t:0,s:0},{r:51,g:153,b:255,a:255,t:0,s:0},{r:51,g:153,b:204,a:255,t:0,s:0},{r:51,g:153,b:153,a:255,t:0,s:0},{r:51,g:153,b:102,a:255,t:0,s:0},{r:51,g:153,b:51,a:255,t:0,s:0},{r:51,g:153,b:0,a:255,t:0,s:0},{r:51,g:102,b:255,a:255,t:0,s:0},{r:51,g:102,b:204,a:255,t:0,s:0},{r:51,g:102,b:153,a:255,t:0,s:0},{r:51,g:102,b:102,a:255,t:0,s:0},{r:51,g:102,b:51,a:255,t:0,s:0},{r:51,g:102,b:0,a:255,t:0,s:0},{r:51,g:51,b:255,a:255,t:0,s:0},{r:51,g:51,b:204,a:255,t:0,s:0},{r:51,g:51,b:153,a:255,t:0,s:0},{r:51,g:51,b:102,a:255,t:0,s:0},{r:51,g:51,b:51,a:255,t:0,s:0},{r:51,g:51,b:0,a:255,t:0,s:0},{r:51,g:0,b:255,a:255,t:0,s:0},{r:51,g:0,b:204,a:255,t:0,s:0},{r:51,g:0,b:153,a:255,t:0,s:0},{r:51,g:0,b:102,a:255,t:0,s:0},{r:51,g:0,b:51,a:255,t:0,s:0},{r:51,g:0,b:0,a:255,t:0,s:0},{r:0,g:255,b:255,a:255,t:0,s:0},{r:0,g:255,b:204,a:255,t:0,s:0},{r:0,g:255,b:153,a:255,t:0,s:0},{r:0,g:255,b:102,a:255,t:0,s:0},{r:0,g:255,b:51,a:255,t:0,s:0},{r:0,g:255,b:0,a:255,t:0,s:0},{r:0,g:204,b:255,a:255,t:0,s:0},{r:0,g:204,b:204,a:255,t:0,s:0},{r:0,g:204,b:153,a:255,t:0,s:0},{r:0,g:204,b:102,a:255,t:0,s:0},{r:0,g:204,b:51,a:255,t:0,s:0},{r:0,g:204,b:0,a:255,t:0,s:0},{r:0,g:153,b:255,a:255,t:0,s:0},{r:0,g:153,b:204,a:255,t:0,s:0},{r:0,g:153,b:153,a:255,t:0,s:0},{r:0,g:153,b:102,a:255,t:0,s:0},{r:0,g:153,b:51,a:255,t:0,s:0},{r:0,g:153,b:0,a:255,t:0,s:0},{r:0,g:102,b:255,a:255,t:0,s:0},{r:0,g:102,b:204,a:255,t:0,s:0},{r:0,g:102,b:153,a:255,t:0,s:0},{r:0,g:102,b:102,a:255,t:0,s:0},{r:0,g:102,b:51,a:255,t:0,s:0},{r:0,g:102,b:0,a:255,t:0,s:0},{r:0,g:51,b:255,a:255,t:0,s:0},{r:0,g:51,b:204,a:255,t:0,s:0},{r:0,g:51,b:153,a:255,t:0,s:0},{r:0,g:51,b:102,a:255,t:0,s:0},{r:0,g:51,b:51,a:255,t:0,s:0},{r:0,g:51,b:0,a:255,t:0,s:0},{r:0,g:0,b:255,a:255,t:0,s:0},{r:0,g:0,b:204,a:255,t:0,s:0},{r:0,g:0,b:153,a:255,t:0,s:0},{r:0,g:0,b:102,a:255,t:0,s:0},{r:0,g:0,b:51,a:255,t:0,s:0},{r:238,g:0,b:0,a:255,t:0,s:0},{r:221,g:0,b:0,a:255,t:0,s:0},{r:187,g:0,b:0,a:255,t:0,s:0},{r:170,g:0,b:0,a:255,t:0,s:0},{r:136,g:0,b:0,a:255,t:0,s:0},{r:119,g:0,b:0,a:255,t:0,s:0},{r:85,g:0,b:0,a:255,t:0,s:0},{r:68,g:0,b:0,a:255,t:0,s:0},{r:34,g:0,b:0,a:255,t:0,s:0},{r:17,g:0,b:0,a:255,t:0,s:0},{r:0,g:238,b:0,a:255,t:0,s:0},{r:0,g:221,b:0,a:255,t:0,s:0},{r:0,g:187,b:0,a:255,t:0,s:0},{r:0,g:170,b:0,a:255,t:0,s:0},{r:0,g:136,b:0,a:255,t:0,s:0},{r:0,g:119,b:0,a:255,t:0,s:0},{r:0,g:85,b:0,a:255,t:0,s:0},{r:0,g:68,b:0,a:255,t:0,s:0},{r:0,g:34,b:0,a:255,t:0,s:0},{r:0,g:17,b:0,a:255,t:0,s:0},{r:0,g:0,b:238,a:255,t:0,s:0},{r:0,g:0,b:221,a:255,t:0,s:0},{r:0,g:0,b:187,a:255,t:0,s:0},{r:0,g:0,b:170,a:255,t:0,s:0},{r:0,g:0,b:136,a:255,t:0,s:0},{r:0,g:0,b:119,a:255,t:0,s:0},{r:0,g:0,b:85,a:255,t:0,s:0},{r:0,g:0,b:68,a:255,t:0,s:0},{r:0,g:0,b:34,a:255,t:0,s:0},{r:0,g:0,b:17,a:255,t:0,s:0},{r:238,g:238,b:238,a:255,t:0,s:0},{r:221,g:221,b:221,a:255,t:0,s:0},{r:187,g:187,b:187,a:255,t:0,s:0},{r:170,g:170,b:170,a:255,t:0,s:0},{r:136,g:136,b:136,a:255,t:0,s:0},{r:119,g:119,b:119,a:255,t:0,s:0},{r:85,g:85,b:85,a:255,t:0,s:0},{r:68,g:68,b:68,a:255,t:0,s:0},{r:34,g:34,b:34,a:255,t:0,s:0},{r:17,g:17,b:17,a:255,t:0,s:0}],console.log("default palette");else{for(r=new Uint8Array(b.slice(p,p+q)),j=A=0;q>A;j=A+=4)o.push({r:r[j],g:r[j+1],b:r[j+2],a:255,t:0,s:0});console.log("palette:"),console.log(o)}for(a.voxels=[],y=new Uint32Array(b.slice(x,x+4))[0],console.log("voxel count: "+y),x+4+4*y!==z&&console.warn("invalid length of voxel chunk"),s=new Uint8Array(b.slice(x+4,x+4+4*y)),j=B=0,F=4*y;F>B;j=B+=4)null==a.voxels[s[j+1]]&&(a.voxels[s[j+1]]=[]),null==a.voxels[s[j+1]][s[j+2]]&&(a.voxels[s[j+1]][s[j+2]]=[]),w=o[s[j+3]-1],a.voxels[s[j+1]][s[j+2]][s[j]]={r:w.r,g:w.g,b:w.b,a:w.a,s:w.s,t:w.t};return console.log("voxels:"),console.log(a.voxels),c()}}(this),console.log("reading file with name: "+a.name),d.readAsArrayBuffer(a))}return c(b,a),b.prototype["export"]=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;for(e=[86,79,88,32,150,0,0,0,77,65,73,78,0,0,0,0],H=new Uint8Array(new Uint32Array([this.x]).buffer),q=H[0],r=H[1],s=H[2],t=H[3],I=new Uint8Array(new Uint32Array([this.z]).buffer),v=I[0],w=I[1],x=I[2],y=I[3],K=new Uint8Array(new Uint32Array([this.y]).buffer),A=K[0],B=K[1],C=K[2],D=K[3],n=[83,73,90,69,12,0,0,0,0,0,0,0,q,r,s,t,v,w,x,y,A,B,C,D],o=[],h=[82,71,66,65,0,4,0,0,0,0,0,0],f={},z=E=0,L=this.z;L>E;z=E+=1)for(u=F=0,M=this.y;M>F;u=F+=1)for(p=G=0,N=this.x;N>G;p=G+=1)if(null!=(null!=(O=this.voxels[z])&&null!=(P=O[u])?P[p]:void 0)){if(i=(this.voxels[z][u][p].r<<24|this.voxels[z][u][p].g<<16|this.voxels[z][u][p].b<<8|255)>>>0,g=f[i],null==g){if(!(h.length<1036))throw new Error("To many colors for Magica Voxel palette");h=h.concat([this.voxels[z][u][p].r,this.voxels[z][u][p].g,this.voxels[z][u][p].b,255]),g=h.length/4-3,f[i]=g}o=o.concat([p,z,u,g])}for(;h.length<1036;)h=h.concat([255,255,255,255]);return Q=new Uint8Array(new Uint32Array([1076+o.length]).buffer),j=Q[0],k=Q[1],l=Q[2],m=Q[3],e=e.concat([j,k,l,m]),e=e.concat(n),R=new Uint8Array(new Uint32Array([o.length+4]).buffer),j=R[0],k=R[1],l=R[2],m=R[3],J=new Uint8Array(new Uint32Array([o.length/4]).buffer),a=J[0],b=J[1],c=J[2],d=J[3],e=e.concat([88,89,90,73,j,k,l,m,0,0,0,0,a,b,c,d]),e=e.concat(o),e=e.concat(h),console.log("export Magica:"),console.log(e),URL.createObjectURL(new Blob([new Uint8Array(e)],{type:"application/octet-binary"}))},b}(IO),"object"==typeof module?module.exports=a:window.MagicaIO=a}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(a,c){var d;b.__super__.constructor.call(this,a)||(this.voxels=[],d=new FileReader,d.onloadend=function(a){return function(){var b,e,f,g,h,i,j,k,l,m,n,o,p;for(e=JSON.parse(d.result),b=e.creator,a.x=e.width,a.y=e.height,a.z=e.depth,h=e.version,g=e.frames,console.log("creator: "+i),console.log("version: "+h+" (expected 1)"),console.log("frames: "+g+" (expected 1)"),console.log("dimensions: width : "+a.x+" height: "+a.y+" depth: "+a.z),console.log("frame data:"),f=l=1;g>=l;f=l+=1)for(console.log(e["frame"+f]),o=e["frame"+f],m=0,n=o.length;n>m;m++)p=o[m],i=p[0],j=p[1],k=p[2],b=p[3],null==a.voxels[k]&&(a.voxels[k]=[]),null==a.voxels[k][j]&&(a.voxels[k][j]=[]),a.voxels[k][j][i]={r:(4278190080&b)>>>24,g:(16711680&b)>>>16,b:(65280&b)>>>8,a:255,t:0,s:0};return console.log("voxels:"),console.log(a.voxels),c()}}(this),console.log("reading file with name: "+a.name),d.readAsText(a))}return c(b,a),b.prototype["export"]=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(a=[],o=this.voxels,d=i=0,l=o.length;l>i;d=++i)if(h=o[d],null!=h)for(c=j=0,m=h.length;m>j;c=++j)if(g=h[c],null!=g)for(b=k=0,n=g.length;n>k;b=++k)f=g[b],null!=f&&a.push([b,c,d,(f.r<<24|f.g<<16|f.b<<8|255)>>>0]);return e={creator:"Troxel",width:this.x,height:this.y,depth:this.z,version:1,frames:1,frame1:a},console.log("Zoxel export:"),console.log(e),"data:application/octet-binary;base64,"+btoa(JSON.stringify(e))},b}(IO),"object"==typeof module?module.exports=a:window.ZoxelIO=a}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},e=[].slice;a=function(a){function b(a){var c,d,f,g,h,i,j,k,l,m,n,o,p,q;if(!b.__super__.constructor.call(this,a)){for(this.voxels=[],n=atob(a).split("").map(function(a){return a.charCodeAt(0)}),this.x=n[0],this.y=n[1],this.z=n[2],this.readonly=n[3],c=5<=n.length?e.call(n,4):[],d=f=0,g={},j=k=0,o=this.z;o>k;j=k+=1)for(i=l=0,p=this.y;p>l;i=l+=1)for(h=m=0,q=this.x;q>m;h=m+=1){if(0===f){if(c[d]>127?(f=c[d]-127,d++):f=1,c[d]>127)throw new Error("Base64 parsing error");c[d]<64?(g={r:c[d+1],g:c[d+2],b:c[d+3],a:c[d+4],s:c[d]%8,t:c[d]>>3},d+=5):(g=null,d++)}null!=g&&(null==this.voxels[j]&&(this.voxels[j]=[]),null==this.voxels[j][i]&&(this.voxels[j][i]=[]),this.voxels[j][i][h]={r:g.r,g:g.g,b:g.b,a:g.a,s:g.s,t:g.t}),f--}d!==c.length&&console.warn("There shouldn't be any bytes left"),this.readonly||console.log("voxels:"),this.readonly||console.log(this.voxels)}}return d(b,a),b.prototype["export"]=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(c=function(a,b,c){var d,e,g,h;if(!(c<f.length))return!1;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;for(h=["r","g","b","a","t","s"],e=0,g=h.length;g>e;e++)if(d=h[e],a[d]!==b[d])return!1;return!0},b=[this.x,this.y,this.z,a?1:0],f=[],i=j=0,m=this.z;m>j;i=j+=1)for(h=k=0,n=this.y;n>k;h=k+=1)for(g=l=0,o=this.x;o>l;g=l+=1)f.push(null!=(p=this.voxels[i])&&null!=(q=p[h])?q[g]:void 0);for(d=0;d<f.length;){for(e=1;128>e&&c(f[d+e-1],f[d+e],d+e);)e++;e>1&&b.push(127+e),null!=f[d]?b=b.concat([8*f[d].t+f[d].s,f[d].r,f[d].g,f[d].b,f[d].a]):b.push(64),d+=e}return console.log("export base64:"),console.log(b),btoa(String.fromCharCode.apply(null,b))},b}(IO),b=function(a){function b(a){var c;b.__super__.constructor.call(this,a)||(c=JSON.parse(a),this.x=c.x,this.y=c.y,this.z=c.z,this.voxels=c.voxels)}return d(b,a),b.prototype["export"]=function(a){return JSON.stringify({x:this.x,y:this.y,z:this.z,voxels:this.voxels},null,a?"    ":"")},b}(IO),("undefined"!=typeof exports&&null!==exports?exports:window).Base64IO=a,("undefined"!=typeof exports&&null!==exports?exports:window).JsonIO=b}.call(this),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;
return-1};a=function(){function a(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(this.embedded=null!=b?b:!1,this.domContainer=null!=c?c:$("#WebGlContainer"),this.width=this.domContainer.width(),this.height=this.domContainer.height()-(this.embedded?0:5),this.scene=new THREE.Scene,this.objects=[],this.reload(a,!0),g=new THREE.BoxGeometry(50,50,50),h=new THREE.MeshBasicMaterial({color:16711680,opacity:.5,transparent:!0}),this.rollOverMesh=new THREE.Mesh(g,h),this.scene.add(this.rollOverMesh),this.vector=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.planes=[],d=new THREE.PlaneBufferGeometry(50*this.x,50*this.y),d.applyMatrix((new THREE.Matrix4).makeRotationY(-Math.PI/2)),f=new THREE.Mesh(d),f.position.x=50*this.z,f.position.y=25*this.y,f.position.z=25*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),d=new THREE.PlaneBufferGeometry(50*this.z,50*this.x),d.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),f=new THREE.Mesh(d),f.position.x=25*this.z,f.position.z=25*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),d=new THREE.PlaneBufferGeometry(50*this.y,50*this.z),d.applyMatrix((new THREE.Matrix4).makeRotationZ(-Math.PI/2)),f=new THREE.Mesh(d),f.position.x=25*this.z,f.position.y=25*this.y,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),d=new THREE.Geometry,j=m=0,p=this.x;p>=m;j=m+=1)d.vertices.push(new THREE.Vector3(0,0,50*j)),d.vertices.push(new THREE.Vector3(50*this.z,0,50*j)),d.vertices.push(new THREE.Vector3(50*this.z,0,50*j)),d.vertices.push(new THREE.Vector3(50*this.z,50*this.y,50*j));for(k=n=0,q=this.y;q>=n;k=n+=1)d.vertices.push(new THREE.Vector3(0,50*k,0)),d.vertices.push(new THREE.Vector3(50*this.z,50*k,0)),d.vertices.push(new THREE.Vector3(50*this.z,50*k,0)),d.vertices.push(new THREE.Vector3(50*this.z,50*k,50*this.x));for(l=o=0,r=this.z;r>=o;l=o+=1)d.vertices.push(new THREE.Vector3(50*l,0,0)),d.vertices.push(new THREE.Vector3(50*l,0,50*this.x)),d.vertices.push(new THREE.Vector3(50*l,0,0)),d.vertices.push(new THREE.Vector3(50*l,50*this.y,0));e=new THREE.LineBasicMaterial({color:0,opacity:.2,transparent:!0}),this.grid=new THREE.Line(d,e,THREE.LinePieces),this.scene.add(this.grid),this.ambientLight=new THREE.AmbientLight(6316128),this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(16777215,.3),this.directionalLight.position.set(-.5,-.5,1).normalize(),this.scene.add(this.directionalLight),this.spotLight=new THREE.SpotLight(16777215,.7,1e4),i=new THREE.Object3D,i.position.x=25*this.z,i.position.y=25*this.y,i.position.z=25*this.x,this.scene.add(i),this.spotLight.target=i,this.scene.add(this.spotLight),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(8947848),this.renderer.setSize(this.width,this.height),this.domContainer.empty().append(this.renderer.domElement),this.embedded||(this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.domContainer.append(this.stats.domElement)),this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e4),this.camera.position.x=-50*this.y-20*this.x-10*this.z,this.camera.position.y=50*this.y,this.camera.position.z=25*this.x,this.controls=new THREE.OrbitControls(this.camera,this.domContainer[0]),this.controls.target=new THREE.Vector3(25*this.z,25*this.y,25*this.x),this.controls.addEventListener("change",function(a){return function(){return a.render()}}(this)),this.controls.enabled=!1,this.changeEditMode($("#modeEdit").parent().hasClass("active")),this.domContainer.on("mousedown",function(a){return function(b){return a.onDocumentMouseDown(b)}}(this)),this.domContainer.on("mousemove",function(a){return function(b){return a.onDocumentMouseMove(b)}}(this)),document.addEventListener("keydown",function(a){return function(b){return a.onDocumentKeyDown(b)}}(this)),document.addEventListener("keyup",function(a){return function(b){return a.onDocumentKeyUp(b)}}(this)),window.addEventListener("resize",function(a){return function(b){return a.onWindowResize(b)}}(this)),this.animate()}return a.prototype.reload=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(null==c&&(c=!1),this.voxels=a.voxels,this.x=a.x,this.y=a.y,this.z=a.z,!c){for(o=this.objects,j=0,n=o.length;n>j;j++)e=o[j],b.call(this.planes,e)<0&&this.scene.remove(e);this.objects=this.planes.slice(0)}for(i=k=0,p=this.z;p>k;i=k+=1)if(null!=this.voxels[i])for(h=l=0,q=this.y;q>l;h=l+=1)if(null!=(null!=(r=this.voxels[i])?r[h]:void 0))for(g=m=0,s=this.x;s>m;g=m+=1)null!=(null!=(t=this.voxels[i])&&null!=(u=t[h])?u[g]:void 0)&&(d=new THREE.Color("rgb("+this.voxels[i][h][g].r+","+this.voxels[i][h][g].g+","+this.voxels[i][h][g].b+")"),f=this.getVoxel(d,this.voxels[i][h][g].a,this.voxels[i][h][g].t,this.voxels[i][h][g].s),f.position.x=50*i+25,f.position.y=50*h+25,f.position.z=50*g+25,this.scene.add(f),this.objects.push(f));return c?void 0:this.render()},a.prototype.getVoxel=function(a,b,c,d){var e;return e=new THREE.MeshPhongMaterial({color:a,ambient:a}),(3===c||4===c)&&(e.emissive=e.color.multiplyScalar(.5)),1===d&&(e.specular=e.color.multiplyScalar(.5)),(1===c||2===c||4===c)&&(e.transparent=!0,e.opacity=b/255),new THREE.Mesh(new THREE.BoxGeometry(50,50,50),e)},a.prototype.changeEditMode=function(a){return this.editMode=a,this.editMode?(this.grid.visible=!0,this.rollOverMesh.visible=!0,this.controls.enabled=!1):(this.grid.visible=!1,this.rollOverMesh.visible=!1,this.controls.enabled=!0),this.render()},a.prototype.animate=function(){return requestAnimationFrame(function(a){return function(){return a.animate()}}(this)),this.controls.update(),this.embedded?void 0:this.stats.update()},a.prototype.render=function(a){return this.spotLight.position.copy(this.camera.position),this.renderer.render(this.scene,this.camera),a?window.open(this.renderer.domElement.toDataURL("image/png"),"Exported png"):void 0},a.prototype.onDocumentMouseMove=function(a){var b,c;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display"))return a.preventDefault(),this.vector.set(a.clientX/this.width*2-1,2*-((a.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),c=this.raycaster.intersectObjects(this.objects),c.length>0&&(b=c[0],this.rollOverMesh.position.copy(b.point).add(b.face.normal),this.rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)),this.render()},a.prototype.onDocumentMouseDown=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display")&&(g=function(a,b,c){return b>0&&a.multiplyScalar(2*Math.random()*b+1-b),c>0&&(a.r=a.r*(2*Math.random()*c+1-c),a.g=a.g*(2*Math.random()*c+1-c),a.b=a.b*(2*Math.random()*c+1-c)),a.r>1&&(a.r=1),a.g>1&&(a.g=1),a.b>1&&(a.b=1),a},this.vector.set(a.clientX/this.width*2-1,2*-((a.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),i=this.raycaster.intersectObjects(this.objects),i.length>0)){switch(h=i[0],a.button){case 0:switch($(".active .editTool").data("edittool")){case 0:if(e=g(new THREE.Color($("#addVoxColor").val()),parseFloat($("#editVoxNoiseBright").val(),parseFloat($("#editVoxNoiseRgb").val()))),c=parseInt($("#addVoxAlpha").val()),n=parseInt($("#addVoxType").val()),m=parseInt($("#addVoxSpecular").val()),(0===n||3===n)&&(c=255),"#ff00ff"===$("#addVoxColor").val()&&(c=250,n=m=7),p=this.getVoxel(e,c,n,m),p.position.copy(h.point).add(h.face.normal),p.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25),q=(p.position.z-25)/50,r=(p.position.y-25)/50,s=(p.position.x-25)/50,!(q>=0&&q<this.x&&r>=0&&r<this.y&&s>=0&&s<this.z))return;null==this.voxels[s]&&(this.voxels[s]=[]),null==this.voxels[s][r]&&(this.voxels[s][r]=[]),this.voxels[s][r][q]={r:Math.floor(255*e.r),g:Math.floor(255*e.g),b:Math.floor(255*e.b),a:c,t:n,s:m},this.scene.add(p),this.objects.push(p);break;case 1:if(w=h.object,b.call(this.planes,w)>=0)return;q=(h.object.position.z-25)/50,r=(h.object.position.y-25)/50,s=(h.object.position.x-25)/50,e=g(new THREE.Color($("#addVoxColor").val()),parseFloat($("#editVoxNoiseBright").val(),parseFloat($("#editVoxNoiseRgb").val()))),c=parseInt($("#addVoxAlpha").val()),n=parseInt($("#addVoxType").val()),m=parseInt($("#addVoxSpecular").val()),(0===n||3===n)&&(c=255),1===e.r&&0===e.g&&1===e.b&&(c=250,n=m=7),h.object.material.color=h.object.material.ambient=e,h.object.material.emissive=3===n||4===n?h.object.material.color.multiplyScalar(.5):new THREE.Color(0),h.object.material.specular=1===m?h.object.material.color:new THREE.Color(1118481),h.object.material.transparent=1===n||2===n||4===n,h.object.material.opacity=1===n||2===n||4===n?c/255:1,this.voxels[s][r][q].r=Math.floor(255*e.r),this.voxels[s][r][q].g=Math.floor(255*e.g),this.voxels[s][r][q].b=Math.floor(255*e.b),this.voxels[s][r][q].a=c,this.voxels[s][r][q].t=n,this.voxels[s][r][q].s=m}break;case 2:if(x=h.object,b.call(this.planes,x)>=0)return;switch(q=(h.object.position.z-25)/50,r=(h.object.position.y-25)/50,s=(h.object.position.x-25)/50,$(".active .editTool").data("edittool")){case 0:delete this.voxels[s][r][q],0===this.voxels[s][r].filter(function(a){return void 0!==a}).length&&delete this.voxels[s][r],0===this.voxels[s].filter(function(a){return void 0!==a}).length&&delete this.voxels[s],this.scene.remove(h.object),this.objects.splice(this.objects.indexOf(h.object),1);break;case 1:for(f=function(a,b,h,i){var j,o;return j=function(a,b,c){var d,e;return null!=(null!=(d=this.voxels[c])&&null!=(e=d[b])?e[a]:void 0)&&!this.voxels[c][b][a].filled&&(!i||o.r===this.voxels[c][b][a].r&&o.g===this.voxels[c][b][a].g&&o.b===this.voxels[c][b][a].b&&o.a===this.voxels[c][b][a].a&&o.t===this.voxels[c][b][a].t&&o.s===this.voxels[c][b][a].s)},o={r:this.voxels[h][b][a].r,g:this.voxels[h][b][a].g,b:this.voxels[h][b][a].b,a:this.voxels[h][b][a].a,t:this.voxels[h][b][a].t,s:this.voxels[h][b][a].s},e=g(new THREE.Color(d),k,l),this.voxels[h][b][a].r=Math.floor(255*e.r),this.voxels[h][b][a].g=Math.floor(255*e.g),this.voxels[h][b][a].b=Math.floor(255*e.b),c=parseInt($("#addVoxAlpha").val()),n=parseInt($("#addVoxType").val()),m=parseInt($("#addVoxSpecular").val()),(0===n||3===n)&&(c=255),1===e.r&&0===e.g&&1===e.b&&(c=250,n=m=7),this.voxels[h][b][a].a=c,this.voxels[h][b][a].t=n,this.voxels[h][b][a].s=m,this.voxels[h][b][a].filled=!0,j.call(this,a+1,b,h)&&f.call(this,a+1,b,h,i),j.call(this,a-1,b,h)&&f.call(this,a-1,b,h,i),j.call(this,a,b+1,h)&&f.call(this,a,b+1,h,i),j.call(this,a,b-1,h)&&f.call(this,a,b-1,h,i),j.call(this,a,b,h+1)&&f.call(this,a,b,h+1,i),j.call(this,a,b,h-1)?f.call(this,a,b,h-1,i):void 0},d=$("#addVoxColor").val(),k=parseFloat($("#editVoxNoiseBright").val()),l=parseFloat($("#editVoxNoiseRgb").val()),f.call(this,q,r,s,$("#fillSameColor").prop("checked")),s=t=0,y=this.z;y>t;s=t+=1)if(null!=this.voxels[s])for(r=u=0,z=this.y;z>u;r=u+=1)if(null!=(null!=(A=this.voxels[s])?A[r]:void 0))for(q=v=0,B=this.x;B>v;q=v+=1)null!=(null!=(C=this.voxels[s])&&null!=(D=C[r])?D[q]:void 0)&&this.voxels[s][r][q].filled&&delete this.voxels[s][r][q].filled;return j={voxels:this.voxels,x:this.x,y:this.y,z:this.z},this.reload(j),history.pushState(j,"Troxel","#m="+new Base64IO(j)["export"](!1))}break;case 1:if(E=h.object,b.call(this.planes,E)>=0)return;return q=(h.object.position.z-25)/50,r=(h.object.position.y-25)/50,s=(h.object.position.x-25)/50,o=this.voxels[s][r][q],$("#addVoxColor").val("#"+new THREE.Color("rgb("+o.r+","+o.g+","+o.b+")").getHexString()),o.r===(F=o.b)&&255===F&&0===o.g?$("#addVoxColor").change():($("#addVoxAlpha").val(o.a),$("#addVoxType").val(o.t),$("#addVoxSpecular").val(o.s),$("#addVoxColor").change())}return j={voxels:this.voxels,x:this.x,y:this.y,z:this.z},history.pushState(j,"Troxel","#m="+new Base64IO(j)["export"](!1)),this.render()}},a.prototype.onDocumentKeyDown=function(a){switch(a.keyCode){case 87:return this.controls.rotateUp(-.05);case 65:return this.controls.rotateLeft(-.05);case 83:return this.controls.rotateUp(.05);case 68:return this.controls.rotateLeft(.05);case 81:return this.controls.dollyIn();case 69:return this.controls.dollyOut()}if(1!==$(".active #modeView").length)switch(a.keyCode){case 18:return this.controls.enabled=!0,this.editMode=!1}},a.prototype.onDocumentKeyUp=function(a){if(1!==$(".active #modeView").length)switch(a.keyCode){case 18:return this.controls.enabled=!1,this.editMode=!0}},a.prototype.onWindowResize=function(){return this.width=this.domContainer.width(),this.height=this.domContainer.height()-(this.embedded?0:5),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.render()},a}(),"object"==typeof module?module.exports=a:window.Renderer=a}.call(this),function(){var a,b,c,d;b=null,a=null,c=null,window.applicationCache.status!==window.applicationCache.UNCACHED&&(window.applicationCache.addEventListener("updateready",function(){return window.applicationCache.status===window.applicationCache.UPDATEREADY&&confirm("A new version of Troxel is available! Do you want to reload this page now to update? (You can reload this page at any time later to update to the new version.)")?location.reload():void 0}),d=setInterval(function(){return window.applicationCache.update()},6e5)),window.onpopstate=function(a){var d,e,f,g,h,i,j,k;if(null!=(null!=a?a.state:void 0))return f=null!=b&&b.x===a.state.x&&b.y===a.state.y&&b.z===a.state.z,b=new IO(a.state),null==b.readonly||0===b.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),f?c.reload(b):c=new Renderer(b);for(b=null,j=decodeURI(window.location.hash).replace("#","").split("&"),h=0,i=j.length;i>h;h++){if(d=j[h],k=d.split("="),e=k[0],g=k[1],"m"===e){b=new Base64IO(g),1===b.readonly&&$("#btnExport").hide(),0===b.readonly&&$("#btnExport").show(),$("#btnExportPng").show(),c=new Renderer(b);break}if("b"===e){$.getJSON("static/Trove.json",function(a){var d;return d=a[g],null!=d?(b=new Base64IO(d),$("#btnExport").hide(),$("#btnExportPng").show(),c=new Renderer(b)):void 0});break}}return null==b?$("#WebGlContainer").empty():void 0},window.onpopstate(),$('input[type="file"]').change(function(){var b,c,d,e;if($(this).prop("files").length>1){for(a=$(this).prop("files"),$("#filetabs li:last a").tab("show"),$("#tabdrag ul").empty(),e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push($("#tabdrag ul").append($("<li>"+b.name+"</li>")));return e}}),document.addEventListener("dragover",function(a){return a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}),document.addEventListener("drop",function(b){var c,d,e,f;if(b.stopPropagation(),b.preventDefault(),a=b.dataTransfer.files,a.length>0){for($("#openModal").modal("show"),$("#dragTab").click(),$("#tabdrag ul").empty(),f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push($("#tabdrag ul").append($("<li>"+c.name+"</li>")));return f}}),$("#open").click(function(){var d,e,f,g,h,i,j,k,l,m,n,o,p;switch(g=function(){return $("#openModal").modal("hide"),$("#modeEdit").parent().hasClass("active")&&$("#modeView").click(),null==b.readonly||0===b.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),c=new Renderer(b),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Troxel","#m="+new Base64IO(b)["export"](!1))},console.log("##################################################"),$("#filetabs li.active a").attr("href")){case"#tabdrag":if("zox"===a[0].name.split(".").pop())b=new ZoxelIO(a[0],g);else if("vox"===a[0].name.split(".").pop())b=new MagicaIO(a[0],g);else if("qb"===a[0].name.split(".").pop()){for(i={},j=o=0,p=a.length;p>o;j=++o)switch(h=a[j],h.name.substr(-5)){case"_a.qb":null==i.a&&(i.a=h);break;case"_t.qb":null==i.t&&(i.t=h);break;case"_s.qb":null==i.s&&(i.s=h);break;default:".qb"===h.name.substr(-3)&&(i.m=h)}null!=i.m?b=new QubicleIO(i,g):alert("Can't find Qubicle main mesh file!")}else alert("Can't import selected file format.");break;case"#tabqb":h=$("#fqb").prop("files")[0],h&&"qb"===h.name.split(".").pop()?b=new QubicleIO({m:h,a:h=$("#fqba").prop("files")[0],t:h=$("#fqbt").prop("files")[0],s:h=$("#fqbs").prop("files")[0]},g):alert("Please choose at least a valid main mesh Qubicle (.qb) file above!");break;case"#tabvox":h=$("#fvox").prop("files")[0],h&&"vox"===h.name.split(".").pop()?b=new MagicaIO(h,g):alert("Please choose a valid Magica Voxel (.vox) file above!");break;case"#tabzox":h=$("#fzox").prop("files")[0],h&&"zox"===h.name.split(".").pop()?b=new ZoxelIO(h,g):alert("Please choose a valid Zoxel (.zox) file above!");break;case"#tabjson":b=new JsonIO($("#sjson").val()),g();break;case"#tabtrove":$.getJSON("static/Trove.json",function(a){var d;return d=a[$("#sbtrove").val()],null!=d?(b=new Base64IO(d),$("#openModal").modal("hide"),$("#btnExport").hide(),$("#btnExportPng").show(),c=new Renderer(b),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Troxel","#b="+$("#sbtrove").val())):void 0});break;case"#tabnew":l=parseInt($("#snewX").val()),m=parseInt($("#snewY").val()),n=parseInt($("#snewZ").val()),k=[],$("#cbnewAp").prop("checked")&&(d=parseInt($("#snewApX").val()),e=parseInt($("#snewApY").val()),f=parseInt($("#snewApZ").val()),l>d&&m>e&&n>f&&(k[f]=[],k[f][e]=[],k[f][e][d]={r:255,g:0,b:255,a:250,t:7,s:7})),b=new IO({x:l,y:m,z:n,voxels:k}),g(),$("#modeEdit").click()}}),$("#openTroveTab").click(function(){var a,b;return b=0,a=new Bloodhound({datumTokenizer:function(a){return a.value.split(/[\[,\],_]/i)},queryTokenizer:function(a){return a.split(/[\s,_]/i)},limit:1e4,prefetch:{url:"static/Trove.json",cacheKey:"TroveBlueprintCache",filter:function(a){return $.map(a,function(a,b){return{value:b}})}}}),a.initialize(),$("#sbtrove").typeahead({highlight:!0,minLength:2,hint:!1},{name:"troveBlueprints",source:a.ttAdapter()})}),$(".snewApPos").prop("disabled",!0),$("#cbnewAp").prop("checked",!1).change(function(){return $(".snewApPos").prop("disabled",!$(this).prop("checked"))}),$("#btnExport").click(function(){return $("#exportQb").text("Export as Qubicle (.qb) ...").removeAttr("href"),$("#exportQba").hide().removeAttr("href"),$("#exportQbt").hide().removeAttr("href"),$("#exportQbs").hide().removeAttr("href"),$("#exportZox").text("Export as Zoxel (.zox) ...").removeAttr("href"),$("#exportVox").text("Export as Magica Voxel (.vox) ...").removeAttr("href"),$("#exportBase64Ta").hide(),$("#exportJsonTa").hide()}),$("#exportQb").click(function(){var a,c,d,e,f,g;if(!b.readonly)return null==$(this).attr("href")?(g=new QubicleIO(b)["export"]($("#exportQbComp").prop("checked")),c=g[0],d=g[1],f=g[2],e=g[3],a=$("#exportFilenameQb").val()||"Model",$(this).text("Download main mash (.qb)").attr("download",""+a+".qb").attr("href",c),$("#exportQba").show().attr("download",""+a+"_a.qb").attr("href",d),$("#exportQbt").show().attr("download",""+a+"_t.qb").attr("href",f),$("#exportQbs").show().attr("download",""+a+"_s.qb").attr("href",e)):void 0}),$("#exportZox").click(function(){var a;if(!b.readonly)return a=$("#exportFilenameZox").val()||"Model",null==$(this).attr("href")?$(this).text("Download as Zoxel (.zox)").attr("download",""+a+".zox").attr("href",new ZoxelIO(b)["export"]()):void 0}),$("#exportVox").click(function(){var a;if(!b.readonly)return a=$("#exportFilenameVox").val()||"Model",null==$(this).attr("href")?$(this).text("Download as Magica Voxel (.vox)").attr("download",""+a+".vox").attr("href",new MagicaIO(b)["export"]()):void 0}),$("#exportBase64").click(function(){return b.readonly?void 0:$("#exportBase64Ta").val(window.location.toString().split("#")[0]+"#m="+new Base64IO(b)["export"]($("#exportBase64Ro").prop("checked"))).fadeIn()}),$("#exportJson").click(function(){return b.readonly?void 0:$("#exportJsonTa").val(new JsonIO(b)["export"]($("#exportJsonPret").prop("checked"))).fadeIn()}),$("#btnExportPng").click(function(){return c.render(!0)}),$("#ulSavedModels").parent().on("show.bs.dropdown",function(a){var d,e,f,g;if("#ulSavedModels"===$(a.relatedTarget).data("tag")){for(null==b||1===b.readonly?$(this).find("a[data-target=#saveModal]").prop("disabled",!0).parent().addClass("disabled"):$(this).find("a[data-target=#saveModal]").prop("disabled",!1).parent().removeClass("disabled"),$("#ulSavedModels li:gt(6)").remove(),d=f=0,g=window.localStorage.length;g>f;d=f+=1)e=window.localStorage.key(d),0!==e.indexOf("__")&&$("#ulSavedModels").append("<li><a class='openSavedModel' data-model='"+window.localStorage.getItem(e)+"'>"+e+"</a></li>");0===$(".openSavedModel").length&&$("#ulSavedModels").append('<li class="disabled"><a>No saved models</a></li>')}return $(".openSavedModel").click(function(){return b=new Base64IO($(this).data("model")),(null==b.readonly||0===b.readonly)&&$("#btnExport").show(),$("#btnExportPng").show(),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Toxel","#m="+$(this).data("model")),c=new Renderer(b),$("#ulSavedModels li:eq(1) a").text($(this).text())})}),$("#saveModelAs").click(function(){return 0===$("#saveModelName").val().length||null==b||b.readonly?void 0:(window.localStorage.setItem($("#saveModelName").val(),new Base64IO(b)["export"](b.readonly)),$("#saveModal").modal("hide"))}),$("#modeView").click(function(){return $(this).parent().addClass("active"),$("#modeEdit").parent().removeClass("active"),c.changeEditMode(!1),$("#addPanel").fadeOut()}),$("#modeEdit").click(function(){return null==b||b.readonly?void 0:($(this).parent().addClass("active"),$("#modeView").parent().removeClass("active"),c.changeEditMode(!0),$("#addPanel").fadeIn())}),$(".rotateBtn").click(function(){if(null!=b){switch($(this).data("rotate")){case"x":b.rotateX(!0);break;case"-x":b.rotateX(!1);break;case"y":b.rotateY(!0);break;case"-y":b.rotateY(!1);break;case"z":b.rotateZ(!0);break;case"-z":b.rotateZ(!1)}return c=new Renderer(b),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Troxel","#m="+new Base64IO(b)["export"](!1))}}),$(".moveBtn").click(function(){if(null!=b){switch($(this).data("move")){case"x":b.moveX(!0,!0);break;case"-x":b.moveX(!1,!0);break;case"y":b.moveY(!0,!0);break;case"-y":b.moveY(!1,!0);break;case"z":b.moveZ(!0,!0);break;case"-z":b.moveZ(!1,!0)}return c.reload(b),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Troxel","#m="+new Base64IO(b)["export"](!1))}}),$(".mirrorBtn").click(function(){if(null!=b){switch($(this).data("mirror")){case"x":b.mirrorX(!0);break;case"y":b.mirrorY(!0);break;case"z":b.mirrorZ(!0)}return c.reload(b),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Troxel","#m="+new Base64IO(b)["export"](!1))}}),$(".panel-heading").click(function(){var a;return a=$(this).find("button span"),a.hasClass("glyphicon-minus")?a.removeClass("glyphicon-minus").addClass("glyphicon-plus"):a.removeClass("glyphicon-plus").addClass("glyphicon-minus"),$(this).next().toggle()}),$("#ambLightColor").val("#606060").change(function(){return null!=b?(c.ambientLight.color=new THREE.Color($(this).val()),c.render()):void 0}),$("#dirLightColor").val("#ffffff").change(function(){return null!=b?(c.directionalLight.color=new THREE.Color($(this).val()),c.render()):void 0}),$("#dirLightIntensity").val(.3).change(function(){return null!=b?(c.directionalLight.intensity=$(this).val(),c.render()):void 0}),$("#spotLightColor").val("#ffffff").change(function(){return null!=b?(c.spotLight.color=new THREE.Color($(this).val()),c.render()):void 0}),$("#spotLightIntensity").val(.7).change(function(){return null!=b?(c.spotLight.intensity=$(this).val(),c.render()):void 0}),$("#dirLightX").val("-0.5"),$("#dirLightY").val("-0.5"),$("#dirLightZ").val("1"),$("#dirLightVector").click(function(){return null!=b?(c.directionalLight.position.set(parseFloat($("#dirLightX").val()),parseFloat($("#dirLightY").val()),parseFloat($("#dirLightZ").val())).normalize(),c.render()):void 0}),$("#addVoxAP").click(function(){return $("#addVoxColor").val("#ff00ff"),$("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0)}),$("#addVoxColor").change(function(){switch($(this).val()){case"#ff00ff":return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0);default:return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!1),$("#addVoxType").change()}}),$("#addVoxType").change(function(){switch(parseInt($(this).val())){case 1:case 2:case 4:return $("#addVoxAlpha").prop("disabled",!1);case 0:case 3:return $("#addVoxAlpha").prop("disabled",!0)}}),$("#addVoxAlpha").val(112),$("#editVoxNoiseBright").val(0),$("#editVoxNoiseRgb").val(0),$("#openResizeModal").click(function(){return null!=b?($("#resizeX").val(b.x),$("#resizeY").val(b.y),$("#resizeZ").val(b.z)):void 0}),$("#resizeBtn").click(function(){return null==b||b.readonly?void 0:($("#resizeModal").modal("hide"),b.resize(parseInt($("#resizeX").val()),parseInt($("#resizeY").val()),parseInt($("#resizeZ").val())),c=new Renderer(b),history.pushState({voxels:b.voxels,x:b.x,y:b.y,z:b.z},"Troxel","#m="+new Base64IO(b)["export"](!1)))}),$($(".editTool")[0]).parent().button("toggle"),$("#fillSameColor").prop("checked",!0),$(".editTool").change(function(){switch($(this).data("edittool")){case 1:return $("#fillSameColorDiv").show();default:return $("#fillSameColorDiv").hide()}}),$('[data-toggle="tooltip"]').tooltip()}.call(this);