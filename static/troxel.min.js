!function(){(function(){var t;t=function(){function t(e){return e instanceof t||"object"==typeof e&&null!=e.x&&null!=e.y&&null!=e.z&&null!=e.voxels?(this.voxels=e.voxels,this.x=e.x,this.y=e.y,this.z=e.z,!0):void 0}return t.prototype.verify=function(){var t,e,r,o,s,n,i,a,l,h,c,u,d,p,g,b;if(null==this.x||null==this.y||null==this.z||null==this.voxels)return!1;if(!(this.x>0&&this.y>0&&this.z>0&&Array.isArray(this.voxels)))return!1;if(this.voxels.length>this.z)return!1;for(h=this.voxels,o=0,i=h.length;i>o;o++){if(r=h[o],!Array.isArray(r)||r.length>this.y)return!1;for(s=0,a=r.length;a>s;s++){if(e=r[s],!Array.isArray(e)||e.length>this.x)return!1;for(n=0,l=e.length;l>n;n++){if(t=e[n],"object"!=typeof t)return!1;if(!("number"==typeof t.r&&0<=(c=t.r)&&255>=c))return!1;if(!("number"==typeof t.g&&0<=(u=t.g)&&255>=u))return!1;if(!("number"==typeof t.b&&0<=(d=t.b)&&255>=d))return!1;if("number"!=typeof t.a||250!==(p=t.a)&&16!==p&&48!==p&&80!==p&&112!==p&&144!==p&&176!==p&&208!==p&&240!==p&&255!==p)return!1;if("number"!=typeof t.t||!(0<=(g=t.t)&&4>=g||7===t.t))return!1;if("number"!=typeof t.s||!(0<=(b=t.s)&&3>=b||7===t.s))return!1}}}return!0},t.prototype.rotateX=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,p;for(e=this.voxels.slice(0),this.voxels=[],s=n=0,l=this.z;l>n;s=n+=1)for(o=i=0,h=this.y;h>i;o=i+=1)for(r=a=0,c=this.x;c>a;r=a+=1)null!=(null!=(u=e[t?this.z-s-1:s])&&null!=(d=u[t?o:this.y-o-1])?d[r]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][s]&&(this.voxels[o][s]=[]),this.voxels[o][s][r]=e[t?this.z-s-1:s][t?o:this.y-o-1][r]);return p=[this.y,this.z],this.z=p[0],this.y=p[1],p},t.prototype.rotateY=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,p;for(e=this.voxels.slice(0),this.voxels=[],s=n=0,l=this.z;l>n;s=n+=1)for(o=i=0,h=this.y;h>i;o=i+=1)for(r=a=0,c=this.x;c>a;r=a+=1)null!=(null!=(u=e[t?this.z-s-1:s])&&null!=(d=u[o])?d[t?r:this.x-r-1]:void 0)&&(null==this.voxels[r]&&(this.voxels[r]=[]),null==this.voxels[r][o]&&(this.voxels[r][o]=[]),this.voxels[r][o][s]=e[t?this.z-s-1:s][o][t?r:this.x-r-1]);return p=[this.x,this.z],this.z=p[0],this.x=p[1],p},t.prototype.rotateZ=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,p;for(e=this.voxels.slice(0),this.voxels=[],s=n=0,l=this.z;l>n;s=n+=1)for(o=i=0,h=this.y;h>i;o=i+=1)for(r=a=0,c=this.x;c>a;r=a+=1)null!=(null!=(u=e[s])&&null!=(d=u[t?o:this.y-o-1])?d[t?this.x-r-1:r]:void 0)&&(null==this.voxels[s]&&(this.voxels[s]=[]),null==this.voxels[s][r]&&(this.voxels[s][r]=[]),this.voxels[s][r][o]=e[s][t?o:this.y-o-1][t?this.x-r-1:r]);return p=[this.x,this.y],this.y=p[0],this.x=p[1],p},t.prototype.mirrorX=function(){var t,e,r,o,s,n,i;for(t=this.voxels.slice(0),this.voxels=[],i=[],o=s=0,n=this.z;n>s;o=s+=1)i.push(function(){var s,n,i;for(i=[],r=s=0,n=this.y;n>s;r=s+=1)i.push(function(){var s,n,i,a,l;for(l=[],e=s=0,n=this.x;n>s;e=s+=1)null!=(null!=(i=t[o])&&null!=(a=i[r])?a[this.x-e-1]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][r]&&(this.voxels[o][r]=[]),l.push(this.voxels[o][r][e]=t[o][r][this.x-e-1]));return l}.call(this));return i}.call(this));return i},t.prototype.mirrorY=function(){var t,e,r,o,s,n,i;for(t=this.voxels.slice(0),this.voxels=[],i=[],o=s=0,n=this.z;n>s;o=s+=1)i.push(function(){var s,n,i;for(i=[],r=s=0,n=this.y;n>s;r=s+=1)i.push(function(){var s,n,i,a,l;for(l=[],e=s=0,n=this.x;n>s;e=s+=1)null!=(null!=(i=t[o])&&null!=(a=i[this.y-r-1])?a[e]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][r]&&(this.voxels[o][r]=[]),l.push(this.voxels[o][r][e]=t[o][this.y-r-1][e]));return l}.call(this));return i}.call(this));return i},t.prototype.mirrorZ=function(){var t,e,r,o,s,n,i;for(t=this.voxels.slice(0),this.voxels=[],i=[],o=s=0,n=this.z;n>s;o=s+=1)i.push(function(){var s,n,i;for(i=[],r=s=0,n=this.y;n>s;r=s+=1)i.push(function(){var s,n,i,a,l;for(l=[],e=s=0,n=this.x;n>s;e=s+=1)null!=(null!=(i=t[this.z-o-1])&&null!=(a=i[r])?a[e]:void 0)&&(null==this.voxels[o]&&(this.voxels[o]=[]),null==this.voxels[o][r]&&(this.voxels[o][r]=[]),l.push(this.voxels[o][r][e]=t[this.z-o-1][r][e]));return l}.call(this));return i}.call(this));return i},t}(),"object"==typeof module?module.exports=t:window.IO=t}).call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};t=function(t){function e(t,r){var o;e.__super__.constructor.call(this,t)||(this.voxels=[],this.x=this.y=this.z=-1,this.loadingState=0,o=new FileReader,o.onloadend=function(e){return function(){var s,n,i;return e.readFile(o.result,0),null!=t.a?(s=new FileReader,s.onloadend=function(){return e.readFile(s.result,1),2===e.loadingState++?r():void 0},console.log("reading alpha file with name: "+t.a.name),s.readAsArrayBuffer(t.a)):e.loadingState++,null!=t.t?(i=new FileReader,i.onloadend=function(){return e.readFile(i.result,2),2===e.loadingState++?r():void 0},console.log("reading type file with name: "+t.t.name),i.readAsArrayBuffer(t.t)):e.loadingState++,null!=t.s?(n=new FileReader,n.onloadend=function(){return e.readFile(n.result,3),2===e.loadingState++?r():void 0},console.log("reading specular file with name: "+t.s.name),n.readAsArrayBuffer(t.s)):e.loadingState++,3===e.loadingState?r():void 0}}(this),console.log("reading file with name: "+t.m.name),o.readAsArrayBuffer(t.m))}return r(e,t),e.prototype.readFile=function(t,e){var r,o,s,n,i,a,l,h,c,u,d,p,g,b,f,v,x,y,w,m,$,E,z,A,M,T,R,k,C,V,I,S,O,H,U,j,L,_,B,P,D,Z;if(console.log("file.byteLength: "+t.byteLength),_=new Uint32Array(t.slice(0,24)),A=_[0],o=_[1],C=_[2],s=_[3],M=_[4],m=_[5],console.log("version: "+A+" (expected 257 = 1.1.0.0 = current version)"),257!==A&&console.warn("Expected version 257 but found version: "+A+" (May result in errors)"),console.log("color format: "+o+" (0 for RGBA (recommended) or 1 for BGRA)"),console.log("z-axis oriantation: "+C+" (0 for left (recommended), 1 for right handed)"),console.log("compression: "+s+" (0 for uncompressed, 1 for compressed with run length encoding (RLE))"),console.log("visability mask: "+M+" (should be 0 for encoded in A value, no partially visability)"),0!==M&&console.warn("partially visability not supported and will be ignored / handled as full visibility"),console.log("matrix count:  "+m),m>1&&console.warn("matrices will be merged into one matrix with regard to their offsets"),l=c=d=0,m>1)for($=24,p=V=1;m>=V;p=V+=1)if(z=new Uint8Array(t.slice($,$+1))[0],B=new Uint32Array(t.slice($+1+z,$+13+z)),T=B[0],R=B[1],k=B[2],P=new Int32Array(t.slice($+13+z,$+25+z)),a=P[0],h=P[1],u=P[2],l=Math.min(l,a),c=Math.min(c,h),d=Math.min(d,u),0===s)$+=25+z+4*T*R*k;else{for(g=0,i=new Uint8Array(t.slice($+25+z)),x=I=0;k>I;x=I+=1)for(;;){if(g+=4,6===i[g-4]&&0===i[g-3]&&0===i[g-2]&&0===i[g-1])break;2===i[g-4]&&0===i[g-3]&&0===i[g-2]&&0===i[g-1]&&(g+=8)}$+=25+z+g}for(w=24,p=S=1;m>=S;p=S+=1){if(console.log("------------------------ Matrix: "+p+" ------------------------"),z=new Uint8Array(t.slice(w,w+1))[0],E=function(){var e,o,s,n;for(s=new Uint8Array(t.slice(w+1,w+1+z)),n=[],e=0,o=s.length;o>e;e++)r=s[e],n.push(String.fromCharCode(r));return n}().join(""),console.log("reading "+p+". matrix with name: "+E),D=new Uint32Array(t.slice(w+1+z,w+13+z)),T=D[0],R=D[1],k=D[2],console.log("dimensions: width: "+T+" height: "+R+" depth: "+k),R>4294967e3)return this.error=!0;if(Z=new Int32Array(t.slice(w+13+z,w+25+z)),a=Z[0],h=Z[1],u=Z[2],console.log("position: dx : "+a+" dy: "+h+" dz: "+u+" (ignored if only 1 matrix)"),1===m&&(a=h=u=0),m>1&&(a-=l,h-=c,u-=d),console.log("position result: dx : "+a+" dy: "+h+" dz: "+u),0===e&&(this.x=Math.max(this.x,T+a),this.y=Math.max(this.y,R+h),this.z=Math.max(this.z,k+u)),0===s){for(i=new Uint8Array(t.slice(w+25+z,w+25+z+4*T*R*k)),x=O=0;k>O;x=O+=1)for(v=H=0;R>H;v=H+=1)for(f=U=0;T>U;f=U+=1)g=4*(x*R*T+v*T+f),i[g+3]>0&&this.addValues(e,f+a,v+h,k,x,u,C,i[g],i[g+1],i[g+2],o);w+=25+z+4*T*R*k}else{for(i=new Uint8Array(t.slice(w+25+z)),g=0,x=j=0;k>j;x=j+=1)for(b=0;;){if(g+=4,6===i[g-4]&&0===i[g-3]&&0===i[g-2]&&0===i[g-1])break;if(2===i[g-4]&&0===i[g-3]&&0===i[g-2]&&0===i[g-1]){if(n=new Uint32Array(new Uint8Array([i[g],i[g+1],i[g+2],i[g+3]]).buffer)[0],n>255&&console.log("high voxel repeat count: "+n),i[g+7]>0)for(y=L=0;n>L;y=L+=1)f=b%T,v=Math.floor(b/T),b++,this.addValues(e,f+a,v+h,k,x,u,C,i[g+4],i[g+5],i[g+6],o);else b+=n;g+=8}else f=b%T,v=Math.floor(b/T),b++,i[g-1]>0&&this.addValues(e,f+a,v+h,k,x,u,C,i[g-4],i[g-3],i[g-2],o)}w+=25+z+g}}return console.log("voxels:"),console.log(this.voxels),w!==t.byteLength?console.warn(console.log("There shouldn't be any bytes left")):void 0},e.prototype.addValues=function(t,e,r,o,s,n,i,a,l,h,c){var u;switch(o=(0===i?s:o-s-1)+n,1===c&&(u=[h,a],a=u[0],h=u[1]),t){case 0:return this.addColorValues(e,r,o,a,l,h);case 1:return this.addAlphaValues(e,r,o,a,l,h);case 2:return this.addTypeValues(e,r,o,a,l,h);case 3:return this.addSpecularValues(e,r,o,a,l,h)}},e.prototype.addColorValues=function(t,e,r,o,s,n){return null==this.voxels[r]&&(this.voxels[r]=[]),null==this.voxels[r][e]&&(this.voxels[r][e]=[]),this.voxels[r][e][t]={r:o,g:s,b:n,a:255,t:0,s:0}},e.prototype.addAlphaValues=function(t,e,r,o,s,n){var i,a;return null==(null!=(i=this.voxels[r])&&null!=(a=i[e])?a[t]:void 0)?console.warn("Ignoring alpha voxel because of non existing color voxel at the same position"):o===s&&s===n?16===o||48===o||80===o||112===o||144===o||176===o||208===o||240===o||255===o?this.voxels[r][e][t].a=o:(console.warn("invalid alpha value "+o+": falling back to 122"),this.voxels[r][e][t].a=112):o===n&&255===n&&0===s?this.voxels[r][e][t].a=250:(console.warn("invalid alpha value: r, g and b are not equal, falling back to 112"),this.voxels[r][e][t].a=112)},e.prototype.addTypeValues=function(t,e,r,o,s,n){var i,a;return null==(null!=(i=this.voxels[r])&&null!=(a=i[e])?a[t]:void 0)?console.warn("Ignoring type voxel because of non existing color voxel at the same position"):255===o&&255===s&&255===n?this.voxels[r][e][t].t=0:128===o&&128===s&&128===n?this.voxels[r][e][t].t=1:64===o&&64===s&&64===n?this.voxels[r][e][t].t=2:255===o&&0===s&&0===n?this.voxels[r][e][t].t=3:255===o&&255===s&&0===n?this.voxels[r][e][t].t=4:255===o&&0===s&&255===n?this.voxels[r][e][t].t=7:(console.warn("invalid type value (r: "+o+", g: "+s+", b: "+n+"), falling back to solid"),this.voxels[r][e][t].t=0)},e.prototype.addSpecularValues=function(t,e,r,o,s,n){var i,a;return null==(null!=(i=this.voxels[r])&&null!=(a=i[e])?a[t]:void 0)?console.warn("Ignoring specular voxel because of non existing color voxel at the same position"):128===o&&0===s&&0===n?this.voxels[r][e][t].s=0:0===o&&128===s&&0===n?this.voxels[r][e][t].s=1:0===o&&0===s&&128===n?this.voxels[r][e][t].s=2:128===o&&128===s&&0===n?this.voxels[r][e][t].s=3:255===o&&0===s&&255===n?this.voxels[r][e][t].s=7:(console.warn("invalid specular value (r: "+o+", g: "+s+", b: "+n+"), falling back to rough"),this.voxels[r][e][t].s=0)},e.prototype.export=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,p,g,b,f,v,x,y,w,m,$,E,z,A,M,T,R,k,C,V,I,S,O,H,U,j,L,_;if(n=[1,1,0,0,0,0,0,0,0,0,0,0,+t,0,0,0,0,0,0,0,1,0,0,0,5,77,157,144,145,154,this.x,0,0,0,this.y,0,0,0,this.z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=n.slice(0),l=n.slice(0),a=n.slice(0),c=function(t){return null!=t?(n=n.concat([t.r,t.g,t.b,255]),i=i.concat(function(){switch(t.a){case 250:return[255,0,255,255];case 255:return[255,255,255,255];case 240:return[240,240,240,255];case 208:return[208,208,208,255];case 176:return[176,176,176,255];case 144:return[144,144,144,255];case 112:return[112,112,112,255];case 80:return[80,80,80,255];case 48:return[48,48,48,255];case 16:return[16,16,16,255];default:return[112,112,112,255]}}()),l=l.concat(function(){switch(t.t){case 0:return[255,255,255,255];case 1:return[128,128,128,255];case 2:return[64,64,64,255];case 3:return[255,0,0,255];case 4:return[255,255,0,255];case 7:return[255,0,255,255];default:return[255,255,255,255]}}()),a=a.concat(function(){switch(t.s){case 0:return[128,0,0,255];case 1:return[0,128,0,255];case 2:return[0,0,128,255];case 3:return[128,128,0,255];case 7:return[255,0,255,255];default:return[128,0,0,255]}}())):(n=n.concat([0,0,0,0]),i=i.concat([0,0,0,0]),l=l.concat([0,0,0,0]),a=a.concat([0,0,0,0]))},h=function(t,e){var r,o,s,n;if(null==t&&null==e)return!0;if(null==t||null==e)return!1;for(n=["r","g","b","a","t","s"],o=0,s=n.length;s>o;o++)if(r=n[o],t[r]!==e[r])return!1;return!0},t)for(x=y=0,T=this.z;T>y;x=y+=1){if(null!=this.voxels[x]){for(b=[],d=-1,v=w=0,R=this.y;R>w;v=w+=1)for(f=m=0,V=this.x;V>m;f=m+=1)b.push(null!=(I=this.voxels[x][v])?I[f]:void 0),null!=(null!=(S=this.voxels[x][v])?S[f]:void 0)&&(d=b.length-1);for(u=0;d>=u;){for(p=1;d>=u+p&&h(b[u+p-1],b[u+p]);)p++;p>1&&(O=new Uint8Array(new Uint32Array([p]).buffer),e=O[0],r=O[1],o=O[2],s=O[3],n=n.concat([2,0,0,0,e,r,o,s]),i=i.concat([2,0,0,0,e,r,o,s]),l=l.concat([2,0,0,0,e,r,o,s]),a=a.concat([2,0,0,0,e,r,o,s])),c(b[u]),u+=p}}n=n.concat([6,0,0,0]),i=i.concat([6,0,0,0]),l=l.concat([6,0,0,0]),a=a.concat([6,0,0,0])}else for(x=$=0,H=this.z;H>$;x=$+=1)for(v=z=0,U=this.y;U>z;v=z+=1)for(f=A=0,j=this.x;j>A;f=A+=1)c(null!=(L=this.voxels[x])&&null!=(k=L[v])?k[f]:void 0);for(console.log("export Qubicle:"),console.log(n),C=[n,i,l,a],_=[],M=0,E=C.length;E>M;M++)g=C[M],_.push(URL.createObjectURL(new Blob([new Uint8Array(g)],{type:"application/octet-binary"})));return _},e}(IO),"object"==typeof module?module.exports=t:window.QubicleIO=t}.call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};t=function(t){function e(t,r){var o;e.__super__.constructor.call(this,t)||(o=new FileReader,o.onloadend=function(t){return function(){var e,s,n,i,a,l,h,c,u,d,p,g,b,f,v,x,y,w,m,$,E,z,A,M,T,R,k,C;if(e=o.result,p=function(){var t,r,o,n;for(o=new Uint8Array(e.slice(0,4)),n=[],t=0,r=o.length;r>t;t++)s=o[t],n.push(String.fromCharCode(s));return n}().join(""),console.log("meta: "+p+" (expected VOX )"),"VOX "!==p)throw new Error("Expected Magica Voxel header not found");if(m=new Uint32Array(e.slice(4,8))[0],console.log("version: "+m+" (expected 150)"),150!==m&&console.warn("Expected version 150 but found version: "+m+" (May result in errors)"),u=function(){var t,r,o,n;for(o=new Uint8Array(e.slice(8,12)),n=[],t=0,r=o.length;r>t;t++)s=o[t],n.push(String.fromCharCode(s));return n}().join(""),console.log("mainChunkId: "+u+" (expected MAIN)"),"MAIN"!==u)throw new Error("Didn't found main Chunk as expected");for(T=new Uint32Array(e.slice(12,20)),d=T[0],c=T[1],console.log("mainChunkSize: "+d+" (expected 0)"),console.log("mainChunkChildSize: "+c),20+c!==e.byteLength&&console.warn(console.log("There shouldn't be any bytes left")),a=20+d,y=w=$=z=b=f=-1;20+d+c>a;){switch(i=function(){var t,r,o,n;for(o=new Uint8Array(e.slice(a,a+4)),n=[],t=0,r=o.length;r>t;t++)s=o[t],n.push(String.fromCharCode(s));return n}().join(""),console.log(new Uint8Array(e.slice(a,a+12))),R=new Uint32Array(e.slice(a+4,a+12)),l=R[0],n=R[1],console.log("found child chunk: "+i+" with begin: "+(a+12)+", size: "+l+" and childSize: "+n+" (expected 0)"),i){case"SIZE":12!==l&&console.warn("invalid length of size chunk"),y=a+12,w=y+l;break;case"XYZI":$=a+12,z=$+l;break;case"RGBA":b=a+12,1024!==l&&console.warn("invalid length of palette chunk"),f=l}a+=12+l+n}if(-1===y||-1===w||-1===$||-1===z)throw new Error("missing chunks");if(k=new Uint32Array(e.slice(y,w)),t.z=k[0],t.x=k[1],t.y=k[2],console.log("dimensions: width: "+t.x+" height: "+t.y+" depth: "+t.z),g=[],-1===b||-1===f)g=[{r:255,g:255,b:255,a:255,t:0,s:0},{r:255,g:255,b:204,a:255,t:0,s:0},{r:255,g:255,b:153,a:255,t:0,s:0},{r:255,g:255,b:102,a:255,t:0,s:0},{r:255,g:255,b:51,a:255,t:0,s:0},{r:255,g:255,b:0,a:255,t:0,s:0},{r:255,g:204,b:255,a:255,t:0,s:0},{r:255,g:204,b:204,a:255,t:0,s:0},{r:255,g:204,b:153,a:255,t:0,s:0},{r:255,g:204,b:102,a:255,t:0,s:0},{r:255,g:204,b:51,a:255,t:0,s:0},{r:255,g:204,b:0,a:255,t:0,s:0},{r:255,g:153,b:255,a:255,t:0,s:0},{r:255,g:153,b:204,a:255,t:0,s:0},{r:255,g:153,b:153,a:255,t:0,s:0},{r:255,g:153,b:102,a:255,t:0,s:0},{r:255,g:153,b:51,a:255,t:0,s:0},{r:255,g:153,b:0,a:255,t:0,s:0},{r:255,g:102,b:255,a:255,t:0,s:0},{r:255,g:102,b:204,a:255,t:0,s:0},{r:255,g:102,b:153,a:255,t:0,s:0},{r:255,g:102,b:102,a:255,t:0,s:0},{r:255,g:102,b:51,a:255,t:0,s:0},{r:255,g:102,b:0,a:255,t:0,s:0},{r:255,g:51,b:255,a:255,t:0,s:0},{r:255,g:51,b:204,a:255,t:0,s:0},{r:255,g:51,b:153,a:255,t:0,s:0},{r:255,g:51,b:102,a:255,t:0,s:0},{r:255,g:51,b:51,a:255,t:0,s:0},{r:255,g:51,b:0,a:255,t:0,s:0},{r:255,g:0,b:255,a:255,t:0,s:0},{r:255,g:0,b:204,a:255,t:0,s:0},{r:255,g:0,b:153,a:255,t:0,s:0},{r:255,g:0,b:102,a:255,t:0,s:0},{r:255,g:0,b:51,a:255,t:0,s:0},{r:255,g:0,b:0,a:255,t:0,s:0},{r:204,g:255,b:255,a:255,t:0,s:0},{r:204,g:255,b:204,a:255,t:0,s:0},{r:204,g:255,b:153,a:255,t:0,s:0},{r:204,g:255,b:102,a:255,t:0,s:0},{r:204,g:255,b:51,a:255,t:0,s:0},{r:204,g:255,b:0,a:255,t:0,s:0},{r:204,g:204,b:255,a:255,t:0,s:0},{r:204,g:204,b:204,a:255,t:0,s:0},{r:204,g:204,b:153,a:255,t:0,s:0},{r:204,g:204,b:102,a:255,t:0,s:0},{r:204,g:204,b:51,a:255,t:0,s:0},{r:204,g:204,b:0,a:255,t:0,s:0},{r:204,g:153,b:255,a:255,t:0,s:0},{r:204,g:153,b:204,a:255,t:0,s:0},{r:204,g:153,b:153,a:255,t:0,s:0},{r:204,g:153,b:102,a:255,t:0,s:0},{r:204,g:153,b:51,a:255,t:0,s:0},{r:204,g:153,b:0,a:255,t:0,s:0},{r:204,g:102,b:255,a:255,t:0,s:0},{r:204,g:102,b:204,a:255,t:0,s:0},{r:204,g:102,b:153,a:255,t:0,s:0},{r:204,g:102,b:102,a:255,t:0,s:0},{r:204,g:102,b:51,a:255,t:0,s:0},{r:204,g:102,b:0,a:255,t:0,s:0},{r:204,g:51,b:255,a:255,t:0,s:0},{r:204,g:51,b:204,a:255,t:0,s:0},{r:204,g:51,b:153,a:255,t:0,s:0},{r:204,g:51,b:102,a:255,t:0,s:0},{r:204,g:51,b:51,a:255,t:0,s:0},{r:204,g:51,b:0,a:255,t:0,s:0},{r:204,g:0,b:255,a:255,t:0,s:0},{r:204,g:0,b:204,a:255,t:0,s:0},{r:204,g:0,b:153,a:255,t:0,s:0},{r:204,g:0,b:102,a:255,t:0,s:0},{r:204,g:0,b:51,a:255,t:0,s:0},{r:204,g:0,b:0,a:255,t:0,s:0},{r:153,g:255,b:255,a:255,t:0,s:0},{r:153,g:255,b:204,a:255,t:0,s:0},{r:153,g:255,b:153,a:255,t:0,s:0},{r:153,g:255,b:102,a:255,t:0,s:0},{r:153,g:255,b:51,a:255,t:0,s:0},{r:153,g:255,b:0,a:255,t:0,s:0},{r:153,g:204,b:255,a:255,t:0,s:0},{r:153,g:204,b:204,a:255,t:0,s:0},{r:153,g:204,b:153,a:255,t:0,s:0},{r:153,g:204,b:102,a:255,t:0,s:0},{r:153,g:204,b:51,a:255,t:0,s:0},{r:153,g:204,b:0,a:255,t:0,s:0},{r:153,g:153,b:255,a:255,t:0,s:0},{r:153,g:153,b:204,a:255,t:0,s:0},{r:153,g:153,b:153,a:255,t:0,s:0},{r:153,g:153,b:102,a:255,t:0,s:0},{r:153,g:153,b:51,a:255,t:0,s:0},{r:153,g:153,b:0,a:255,t:0,s:0},{r:153,g:102,b:255,a:255,t:0,s:0},{r:153,g:102,b:204,a:255,t:0,s:0},{r:153,g:102,b:153,a:255,t:0,s:0},{r:153,g:102,b:102,a:255,t:0,s:0},{r:153,g:102,b:51,a:255,t:0,s:0},{r:153,g:102,b:0,a:255,t:0,s:0},{r:153,g:51,b:255,a:255,t:0,s:0},{r:153,g:51,b:204,a:255,t:0,s:0},{r:153,g:51,b:153,a:255,t:0,s:0},{r:153,g:51,b:102,a:255,t:0,s:0},{r:153,g:51,b:51,a:255,t:0,s:0},{r:153,g:51,b:0,a:255,t:0,s:0},{r:153,g:0,b:255,a:255,t:0,s:0},{r:153,g:0,b:204,a:255,t:0,s:0},{r:153,g:0,b:153,a:255,t:0,s:0},{r:153,g:0,b:102,a:255,t:0,s:0},{r:153,g:0,b:51,a:255,t:0,s:0},{r:153,g:0,b:0,a:255,t:0,s:0},{r:102,g:255,b:255,a:255,t:0,s:0},{r:102,g:255,b:204,a:255,t:0,s:0},{r:102,g:255,b:153,a:255,t:0,s:0},{r:102,g:255,b:102,a:255,t:0,s:0},{r:102,g:255,b:51,a:255,t:0,s:0},{r:102,g:255,b:0,a:255,t:0,s:0},{r:102,g:204,b:255,a:255,t:0,s:0},{r:102,g:204,b:204,a:255,t:0,s:0},{r:102,g:204,b:153,a:255,t:0,s:0},{r:102,g:204,b:102,a:255,t:0,s:0},{r:102,g:204,b:51,a:255,t:0,s:0},{r:102,g:204,b:0,a:255,t:0,s:0},{r:102,g:153,b:255,a:255,t:0,s:0},{r:102,g:153,b:204,a:255,t:0,s:0},{r:102,g:153,b:153,a:255,t:0,s:0},{r:102,g:153,b:102,a:255,t:0,s:0},{r:102,g:153,b:51,a:255,t:0,s:0},{r:102,g:153,b:0,a:255,t:0,s:0},{r:102,g:102,b:255,a:255,t:0,s:0},{r:102,g:102,b:204,a:255,t:0,s:0},{r:102,g:102,b:153,a:255,t:0,s:0},{r:102,g:102,b:102,a:255,t:0,s:0},{r:102,g:102,b:51,a:255,t:0,s:0},{r:102,g:102,b:0,a:255,t:0,s:0},{r:102,g:51,b:255,a:255,t:0,s:0},{r:102,g:51,b:204,a:255,t:0,s:0},{r:102,g:51,b:153,a:255,t:0,s:0},{r:102,g:51,b:102,a:255,t:0,s:0},{r:102,g:51,b:51,a:255,t:0,s:0},{r:102,g:51,b:0,a:255,t:0,s:0},{r:102,g:0,b:255,a:255,t:0,s:0},{r:102,g:0,b:204,a:255,t:0,s:0},{r:102,g:0,b:153,a:255,t:0,s:0},{r:102,g:0,b:102,a:255,t:0,s:0},{r:102,g:0,b:51,a:255,t:0,s:0},{r:102,g:0,b:0,a:255,t:0,s:0},{r:51,g:255,b:255,a:255,t:0,s:0},{r:51,g:255,b:204,a:255,t:0,s:0},{r:51,g:255,b:153,a:255,t:0,s:0},{r:51,g:255,b:102,a:255,t:0,s:0},{r:51,g:255,b:51,a:255,t:0,s:0},{r:51,g:255,b:0,a:255,t:0,s:0},{r:51,g:204,b:255,a:255,t:0,s:0},{r:51,g:204,b:204,a:255,t:0,s:0},{r:51,g:204,b:153,a:255,t:0,s:0},{r:51,g:204,b:102,a:255,t:0,s:0},{r:51,g:204,b:51,a:255,t:0,s:0},{r:51,g:204,b:0,a:255,t:0,s:0},{r:51,g:153,b:255,a:255,t:0,s:0},{r:51,g:153,b:204,a:255,t:0,s:0},{r:51,g:153,b:153,a:255,t:0,s:0},{r:51,g:153,b:102,a:255,t:0,s:0},{r:51,g:153,b:51,a:255,t:0,s:0},{r:51,g:153,b:0,a:255,t:0,s:0},{r:51,g:102,b:255,a:255,t:0,s:0},{r:51,g:102,b:204,a:255,t:0,s:0},{r:51,g:102,b:153,a:255,t:0,s:0},{r:51,g:102,b:102,a:255,t:0,s:0},{r:51,g:102,b:51,a:255,t:0,s:0},{r:51,g:102,b:0,a:255,t:0,s:0},{r:51,g:51,b:255,a:255,t:0,s:0},{r:51,g:51,b:204,a:255,t:0,s:0},{r:51,g:51,b:153,a:255,t:0,s:0},{r:51,g:51,b:102,a:255,t:0,s:0},{r:51,g:51,b:51,a:255,t:0,s:0},{r:51,g:51,b:0,a:255,t:0,s:0},{r:51,g:0,b:255,a:255,t:0,s:0},{r:51,g:0,b:204,a:255,t:0,s:0},{r:51,g:0,b:153,a:255,t:0,s:0},{r:51,g:0,b:102,a:255,t:0,s:0},{r:51,g:0,b:51,a:255,t:0,s:0},{r:51,g:0,b:0,a:255,t:0,s:0},{r:0,g:255,b:255,a:255,t:0,s:0},{r:0,g:255,b:204,a:255,t:0,s:0},{r:0,g:255,b:153,a:255,t:0,s:0},{r:0,g:255,b:102,a:255,t:0,s:0},{r:0,g:255,b:51,a:255,t:0,s:0},{r:0,g:255,b:0,a:255,t:0,s:0},{r:0,g:204,b:255,a:255,t:0,s:0},{r:0,g:204,b:204,a:255,t:0,s:0},{r:0,g:204,b:153,a:255,t:0,s:0},{r:0,g:204,b:102,a:255,t:0,s:0},{r:0,g:204,b:51,a:255,t:0,s:0},{r:0,g:204,b:0,a:255,t:0,s:0},{r:0,g:153,b:255,a:255,t:0,s:0},{r:0,g:153,b:204,a:255,t:0,s:0},{r:0,g:153,b:153,a:255,t:0,s:0},{r:0,g:153,b:102,a:255,t:0,s:0},{r:0,g:153,b:51,a:255,t:0,s:0},{r:0,g:153,b:0,a:255,t:0,s:0},{r:0,g:102,b:255,a:255,t:0,s:0},{r:0,g:102,b:204,a:255,t:0,s:0},{r:0,g:102,b:153,a:255,t:0,s:0},{r:0,g:102,b:102,a:255,t:0,s:0},{r:0,g:102,b:51,a:255,t:0,s:0},{r:0,g:102,b:0,a:255,t:0,s:0},{r:0,g:51,b:255,a:255,t:0,s:0},{r:0,g:51,b:204,a:255,t:0,s:0},{r:0,g:51,b:153,a:255,t:0,s:0},{r:0,g:51,b:102,a:255,t:0,s:0},{r:0,g:51,b:51,a:255,t:0,s:0},{r:0,g:51,b:0,a:255,t:0,s:0},{r:0,g:0,b:255,a:255,t:0,s:0},{r:0,g:0,b:204,a:255,t:0,s:0},{r:0,g:0,b:153,a:255,t:0,s:0},{r:0,g:0,b:102,a:255,t:0,s:0},{r:0,g:0,b:51,a:255,t:0,s:0},{r:238,g:0,b:0,a:255,t:0,s:0},{r:221,g:0,b:0,a:255,t:0,s:0},{r:187,g:0,b:0,a:255,t:0,s:0},{r:170,g:0,b:0,a:255,t:0,s:0},{r:136,g:0,b:0,a:255,t:0,s:0},{r:119,g:0,b:0,a:255,t:0,s:0},{r:85,g:0,b:0,a:255,t:0,s:0},{r:68,g:0,b:0,a:255,t:0,s:0},{r:34,g:0,b:0,a:255,t:0,s:0},{r:17,g:0,b:0,a:255,t:0,s:0},{r:0,g:238,b:0,a:255,t:0,s:0},{r:0,g:221,b:0,a:255,t:0,s:0},{r:0,g:187,b:0,a:255,t:0,s:0},{r:0,g:170,b:0,a:255,t:0,s:0},{r:0,g:136,b:0,a:255,t:0,s:0},{r:0,g:119,b:0,a:255,t:0,s:0},{r:0,g:85,b:0,a:255,t:0,s:0},{r:0,g:68,b:0,a:255,t:0,s:0},{r:0,g:34,b:0,a:255,t:0,s:0},{r:0,g:17,b:0,a:255,t:0,s:0},{r:0,g:0,b:238,a:255,t:0,s:0},{r:0,g:0,b:221,a:255,t:0,s:0},{r:0,g:0,b:187,a:255,t:0,s:0},{r:0,g:0,b:170,a:255,t:0,s:0},{r:0,g:0,b:136,a:255,t:0,s:0},{r:0,g:0,b:119,a:255,t:0,s:0},{r:0,g:0,b:85,a:255,t:0,s:0},{r:0,g:0,b:68,a:255,t:0,s:0},{r:0,g:0,b:34,a:255,t:0,s:0},{r:0,g:0,b:17,a:255,t:0,s:0},{r:238,g:238,b:238,a:255,t:0,s:0},{r:221,g:221,b:221,a:255,t:0,s:0},{r:187,g:187,b:187,a:255,t:0,s:0},{r:170,g:170,b:170,a:255,t:0,s:0},{r:136,g:136,b:136,a:255,t:0,s:0},{r:119,g:119,b:119,a:255,t:0,s:0},{r:85,g:85,b:85,a:255,t:0,s:0},{r:68,g:68,b:68,a:255,t:0,s:0},{r:34,g:34,b:34,a:255,t:0,s:0},{r:17,g:17,b:17,a:255,t:0,s:0}],console.log("default palette");else{for(v=new Uint8Array(e.slice(b,b+f)),h=A=0;f>A;h=A+=4)g.push({r:v[h],g:v[h+1],b:v[h+2],a:255,t:0,s:0});console.log("palette:"),console.log(g)}for(t.voxels=[],E=new Uint32Array(e.slice($,$+4))[0],console.log("voxel count: "+E),$+4+4*E!==z&&console.warn("invalid length of voxel chunk"),x=new Uint8Array(e.slice($+4,$+4+4*E)),h=M=0,C=4*E;C>M;h=M+=4)null==t.voxels[x[h]]&&(t.voxels[x[h]]=[]),null==t.voxels[x[h]][x[h+2]]&&(t.voxels[x[h]][x[h+2]]=[]),t.voxels[x[h]][x[h+2]][x[h+1]]=g[x[h+3]-1];return console.log("voxels:"),console.log(t.voxels),r()}}(this),console.log("reading file with name: "+t.name),o.readAsArrayBuffer(t))}return r(e,t),e.prototype.export=function(){var t,e,r,o,s,n,i,a,l,h,c,u,d,p,g,b,f,v,x,y,w,m,$,E,z,A,M,T,R,k,C,V,I,S,O,H,U,j,L,_,B,P,D,Z;for(s=[86,79,88,32,150,0,0,0,77,65,73,78,0,0,0,0],S=new Uint8Array(new Uint32Array([this.x]).buffer),f=S[0],v=S[1],x=S[2],y=S[3],O=new Uint8Array(new Uint32Array([this.y]).buffer),m=O[0],$=O[1],E=O[2],z=O[3],U=new Uint8Array(new Uint32Array([this.z]).buffer),M=U[0],T=U[1],R=U[2],k=U[3],p=[83,73,90,69,12,0,0,0,0,0,0,0,f,v,x,y,m,$,E,z,M,T,R,k],g=[],a=[82,71,66,65,0,4,0,0,0,0,0,0],n={},A=C=0,j=this.z;j>C;A=C+=1)for(w=V=0,L=this.y;L>V;w=V+=1)for(b=I=0,_=this.x;_>I;b=I+=1)if(null!=(null!=(B=this.voxels[A])&&null!=(P=B[w])?P[b]:void 0)){if(l=(this.voxels[A][w][b].r<<24|this.voxels[A][w][b].g<<16|this.voxels[A][w][b].b<<8|255)>>>0,i=n[l],null==i){if(!(a.length<1036))throw new Error("To many colors for Magica Voxel palette");a=a.concat([this.voxels[A][w][b].r,this.voxels[A][w][b].g,this.voxels[A][w][b].b,255]),i=a.length/4-3,n[l]=i}g=g.concat([A,b,w,i])}for(;a.length<1036;)a=a.concat([255,255,255,255]);return D=new Uint8Array(new Uint32Array([1076+g.length]).buffer),h=D[0],c=D[1],u=D[2],d=D[3],s=s.concat([h,c,u,d]),s=s.concat(p),Z=new Uint8Array(new Uint32Array([g.length+4]).buffer),h=Z[0],c=Z[1],u=Z[2],d=Z[3],H=new Uint8Array(new Uint32Array([g.length/4]).buffer),t=H[0],e=H[1],r=H[2],o=H[3],s=s.concat([88,89,90,73,h,c,u,d,0,0,0,0,t,e,r,o]),s=s.concat(g),s=s.concat(a),console.log("export Magica:"),console.log(s),URL.createObjectURL(new Blob([new Uint8Array(s)],{type:"application/octet-binary"}))},e}(IO),"object"==typeof module?module.exports=t:window.MagicaIO=t}.call(this),function(){var t,e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};t=function(t){function e(t,r){var o;e.__super__.constructor.call(this,t)||(this.voxels=[],o=new FileReader,o.onloadend=function(t){return function(){var e,s,n,i,a,l,h,c,u,d,p,g,b;for(s=JSON.parse(o.result),e=s.creator,t.x=s.width,t.y=s.height,t.z=s.depth,a=s.version,i=s.frames,console.log("creator: "+l),console.log("version: "+a+" (expected 1)"),console.log("frames: "+i+" (expected 1)"),console.log("dimensions: width : "+t.x+" height: "+t.y+" depth: "+t.z),console.log("frame data:"),n=u=1;i>=u;n=u+=1)for(console.log(s["frame"+n]),g=s["frame"+n],d=0,p=g.length;p>d;d++)b=g[d],l=b[0],h=b[1],c=b[2],e=b[3],null==t.voxels[c]&&(t.voxels[c]=[]),null==t.voxels[c][h]&&(t.voxels[c][h]=[]),t.voxels[c][h][l]={r:(4278190080&e)>>>24,g:(16711680&e)>>>16,b:(65280&e)>>>8,a:255,t:0,s:0};return console.log("voxels:"),console.log(t.voxels),r()}}(this),console.log("reading file with name: "+t.name),o.readAsText(t))}return r(e,t),e.prototype.export=function(){var t,e,r,o,s,n,i,a,l,h,c,u,d,p,g;for(t=[],g=this.voxels,o=l=0,u=g.length;u>l;o=++l)if(a=g[o],null!=a)for(r=h=0,d=a.length;d>h;r=++h)if(i=a[r],null!=i)for(e=c=0,p=i.length;p>c;e=++c)n=i[e],null!=n&&t.push([e,r,o,(n.r<<24|n.g<<16|n.b<<8|255)>>>0]);return s={creator:"Troxel",width:this.x,height:this.y,depth:this.z,version:1,frames:1,frame1:t},console.log("Zoxel export:"),console.log(s),"data:application/octet-binary;base64,"+btoa(JSON.stringify(s))},e}(IO),"object"==typeof module?module.exports=t:window.ZoxelIO=t}.call(this),function(){var t,e,r={}.hasOwnProperty,o=function(t,e){function o(){this.constructor=t}for(var s in e)r.call(e,s)&&(t[s]=e[s]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},s=[].slice;t=function(t){function e(t){var r,o,n,i,a,l,h,c,u,d,p,g,b,f;if(!e.__super__.constructor.call(this,t)){for(this.voxels=[],p=atob(t).split("").map(function(t){return t.charCodeAt(0)}),this.x=p[0],this.y=p[1],this.z=p[2],this.readonly=p[3],r=5<=p.length?s.call(p,4):[],o=n=0,i={},h=c=0,g=this.z;g>c;h=c+=1)for(l=u=0,b=this.y;b>u;l=u+=1)for(a=d=0,f=this.x;f>d;a=d+=1){if(0===n){if(r[o]>127?(n=r[o]-127,o++):n=1,r[o]>127)throw new Error("Base64 parsing error");r[o]<64?(i={r:r[o+1],g:r[o+2],b:r[o+3],a:r[o+4],s:r[o]%8,t:r[o]>>3},o+=5):(i=null,o++)}null!=i&&(null==this.voxels[h]&&(this.voxels[h]=[]),null==this.voxels[h][l]&&(this.voxels[h][l]=[]),this.voxels[h][l][a]=i),n--}o!==r.length&&console.warn("There shouldn't be any bytes left"),this.readonly||console.log("voxels:"),this.readonly||console.log(this.voxels)}}return o(e,t),e.prototype.export=function(t){var e,r,o,s,n,i,a,l,h,c,u,d,p,g,b,f;for(r=function(t,e,r){var o,s,i,a;if(!(r<n.length))return!1;if(null==t&&null==e)return!0;if(null==t||null==e)return!1;for(a=["r","g","b","a","t","s"],s=0,i=a.length;i>s;s++)if(o=a[s],t[o]!==e[o])return!1;return!0},e=[this.x,this.y,this.z,t?1:0],n=[],l=h=0,d=this.z;d>h;l=h+=1)for(a=c=0,p=this.y;p>c;a=c+=1)for(i=u=0,g=this.x;g>u;i=u+=1)n.push(null!=(b=this.voxels[l])&&null!=(f=b[a])?f[i]:void 0);for(o=0;o<n.length;){for(s=1;128>s&&r(n[o+s-1],n[o+s],o+s);)s++;s>1&&e.push(127+s),null!=n[o]?e=e.concat([8*n[o].t+n[o].s,n[o].r,n[o].g,n[o].b,n[o].a]):e.push(64),o+=s}return console.log("export base64:"),console.log(e),btoa(String.fromCharCode.apply(null,e))},e}(IO),e=function(t){function e(t){var r;e.__super__.constructor.call(this,t)||(r=JSON.parse(t),this.x=r.x,this.y=r.y,this.z=r.z,this.voxels=r.voxels)}return o(e,t),e.prototype.export=function(t){return JSON.stringify({x:this.x,y:this.y,z:this.z,voxels:this.voxels},null,t?"    ":"")},e}(IO),("undefined"!=typeof exports&&null!==exports?exports:window).Base64IO=t,("undefined"!=typeof exports&&null!==exports?exports:window).JsonIO=e}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};t=function(){function t(t,e,r){var o,s,n,i,a,l,h,c,u,d,p,g,b,f,v,x,y,w,m,E,z,A,M,T;for(this.embedded=null!=e?e:!1,this.domContainer=null!=r?r:$("#WebGlContainer"),this.voxels=t.voxels,this.x=t.x,this.y=t.y,this.z=t.z,this.objects=[],this.width=this.domContainer.width(),this.height=this.domContainer.height()-5,this.scene=new THREE.Scene,i=new THREE.BoxGeometry(50,50,50),a=new THREE.MeshBasicMaterial({color:16711680,opacity:.5,transparent:!0}),this.rollOverMesh=new THREE.Mesh(i,a),this.scene.add(this.rollOverMesh),o=new THREE.Geometry,u=d=0,x=this.z;x>=d;u=d+=1)o.vertices.push(new THREE.Vector3(0,0,50*u)),o.vertices.push(new THREE.Vector3(50*this.x,0,50*u)),o.vertices.push(new THREE.Vector3(50*this.x,0,50*u)),o.vertices.push(new THREE.Vector3(50*this.x,50*this.y,50*u));for(h=p=0,y=this.x;y>=p;h=p+=1)o.vertices.push(new THREE.Vector3(50*h,0,0)),o.vertices.push(new THREE.Vector3(50*h,0,50*this.z)),o.vertices.push(new THREE.Vector3(50*h,0,0)),o.vertices.push(new THREE.Vector3(50*h,50*this.y,0));for(c=g=0,w=this.y;w>=g;c=g+=1)o.vertices.push(new THREE.Vector3(0,50*c,0)),o.vertices.push(new THREE.Vector3(50*this.x,50*c,0)),o.vertices.push(new THREE.Vector3(50*this.x,50*c,0)),o.vertices.push(new THREE.Vector3(50*this.x,50*c,50*this.z));for(s=new THREE.LineBasicMaterial({color:0,opacity:.2,transparent:!0}),this.grid=new THREE.Line(o,s,THREE.LinePieces),this.scene.add(this.grid),this.planes=[],o=new THREE.PlaneBufferGeometry(50*this.z,50*this.y),o.applyMatrix((new THREE.Matrix4).makeRotationY(-Math.PI/2)),n=new THREE.Mesh(o),n.position.x=50*this.x,n.position.y=25*this.y,n.position.z=25*this.z,n.visible=!1,this.scene.add(n),this.objects.push(n),this.planes.push(n),o=new THREE.PlaneBufferGeometry(50*this.x,50*this.z),o.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),n=new THREE.Mesh(o),n.position.x=25*this.x,n.position.z=25*this.z,n.visible=!1,this.scene.add(n),this.objects.push(n),this.planes.push(n),o=new THREE.PlaneBufferGeometry(50*this.y,50*this.x),o.applyMatrix((new THREE.Matrix4).makeRotationZ(-Math.PI/2)),n=new THREE.Mesh(o),n.position.x=25*this.x,n.position.y=25*this.y,n.visible=!1,this.scene.add(n),this.objects.push(n),this.planes.push(n),this.vector=new THREE.Vector3,this.raycaster=new THREE.Raycaster,u=b=0,m=this.z;m>b;u=b+=1)for(c=f=0,E=this.y;E>f;c=f+=1)for(h=v=0,z=this.x;z>v;h=v+=1)null!=(null!=(A=this.voxels[u])&&null!=(M=A[c])?M[h]:void 0)&&(s=new THREE.MeshLambertMaterial({color:new THREE.Color("rgb("+this.voxels[u][c][h].r+","+this.voxels[u][c][h].g+","+this.voxels[u][c][h].b+")"),shading:THREE.FlatShading}),s.ambient=s.color,(1===(T=this.voxels[u][c][h].t)||2===T||4===T)&&(s.transparent=!0,s.opacity=this.voxels[u][c][h].a/255),l=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),s),l.position.x=50*h+25,l.position.y=50*c+25,l.position.z=50*u+25,this.scene.add(l),this.objects.push(l));
this.ambientLight=new THREE.AmbientLight(6316128),this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(16777215),this.directionalLight.position.set(1,.75,.5).normalize(),this.scene.add(this.directionalLight),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(8947848),this.renderer.setSize(this.width,this.height),this.domContainer.empty().append(this.renderer.domElement),this.domContainer.on("mousedown",function(t){return function(e){return t.onDocumentMouseDown(e)}}(this)),this.domContainer.on("mousemove",function(t){return function(e){return t.onDocumentMouseMove(e)}}(this)),document.addEventListener("keydown",function(t){return function(e){return t.onDocumentKeyDown(e)}}(this)),document.addEventListener("keyup",function(t){return function(e){return t.onDocumentKeyUp(e)}}(this)),window.addEventListener("resize",function(t){return function(e){return t.onWindowResize(e)}}(this)),this.embedded||(this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.domContainer.append(this.stats.domElement)),this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e4),this.camera.position.x=-50*this.y-20*this.z-10*this.x,this.camera.position.y=50*this.y,this.camera.position.z=25*this.z,this.controls=new THREE.OrbitControls(this.camera,this.domContainer[0]),this.controls.target=new THREE.Vector3(25*this.x,25*this.y,25*this.z),this.controls.addEventListener("change",function(t){return function(){return t.render()}}(this)),this.controls.enabled=!1,this.changeEditMode($("#modeEdit").parent().hasClass("active")),this.animate(),this.render()}return t.prototype.reload=function(t){var r,o,s,n,i,a,l,h,c,u,d,p,g,b,f,v,x,y;for(this.voxels=t.voxels,this.x=t.x,this.y=t.y,this.z=t.z,p=this.objects,l=0,d=p.length;d>l;l++)o=p[l],e.call(this.planes,o)<0&&this.scene.remove(o);for(this.objects=this.planes.slice(0),a=h=0,g=this.z;g>h;a=h+=1)for(i=c=0,b=this.y;b>c;i=c+=1)for(n=u=0,f=this.x;f>u;n=u+=1)null!=(null!=(v=this.voxels[a])&&null!=(x=v[i])?x[n]:void 0)&&(r=new THREE.MeshLambertMaterial({color:new THREE.Color("rgb("+this.voxels[a][i][n].r+","+this.voxels[a][i][n].g+","+this.voxels[a][i][n].b+")"),shading:THREE.FlatShading}),r.ambient=r.color,(1===(y=this.voxels[a][i][n].t)||2===y||4===y)&&(r.transparent=!0,r.opacity=this.voxels[a][i][n].a/255),s=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),r),s.position.x=50*n+25,s.position.y=50*i+25,s.position.z=50*a+25,this.scene.add(s),this.objects.push(s));return this.render()},t.prototype.changeEditMode=function(t){return this.editMode=t,this.editMode?(this.grid.visible=!0,this.rollOverMesh.visible=!0,this.controls.enabled=!1):(this.grid.visible=!1,this.rollOverMesh.visible=!1,this.controls.enabled=!0),this.render()},t.prototype.animate=function(){return requestAnimationFrame(function(t){return function(){return t.animate()}}(this)),this.controls.update(),this.embedded?void 0:this.stats.update()},t.prototype.render=function(t){return this.renderer.render(this.scene,this.camera),t?window.open(this.renderer.domElement.toDataURL("image/png"),"Exported png"):void 0},t.prototype.onDocumentMouseMove=function(t){var e,r;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display"))return t.preventDefault(),this.vector.set(t.clientX/this.width*2-1,2*-((t.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),r=this.raycaster.intersectObjects(this.objects),r.length>0&&(e=r[0],this.rollOverMesh.position.copy(e.point).add(e.face.normal),this.rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)),this.render()},t.prototype.onDocumentMouseDown=function(t){var r,o,s,n,i,a,l,h,c,u,d,p,g;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display")&&(this.vector.set(t.clientX/this.width*2-1,2*-((t.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),n=this.raycaster.intersectObjects(this.objects),n.length>0)){if(s=n[0],2===t.button&&(d=s.object,e.call(this.planes,d)<0&&(h=(s.object.position.x-25)/50,c=(s.object.position.y-25)/50,u=(s.object.position.z-25)/50,delete this.voxels[u][c][h],0===this.voxels[u][c].filter(function(t){return void 0!==t}).length&&delete this.voxels[u][c],0===this.voxels[u].filter(function(t){return void 0!==t}).length&&delete this.voxels[u],this.scene.remove(s.object),this.objects.splice(this.objects.indexOf(s.object),1))),0===t.button){if(o=new THREE.MeshLambertMaterial({color:new THREE.Color($("#addVoxColor").val()),shading:THREE.FlatShading}),o.ambient=o.color,r=parseInt($("#addVoxAlpha").val()),i=parseInt($("#addVoxType").val()),(0===i||3===i)&&(r=255),1!==i&&2!==i&&4!==i||"#ff00ff"===$("#addVoxColor").val()||(o.transparent=!0,o.opacity=r/255),l=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),o),l.position.copy(s.point).add(s.face.normal),l.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25),h=(l.position.x-25)/50,c=(l.position.y-25)/50,u=(l.position.z-25)/50,!(h>=0&&h<this.x&&c>=0&&c<this.y&&u>=0&&u<this.z))return;null==this.voxels[u]&&(this.voxels[u]=[]),null==this.voxels[u][c]&&(this.voxels[u][c]=[]),this.voxels[u][c][h]=function(){switch($("#addVoxColor").val()){case"#ff00ff":return{r:255,g:0,b:255,a:250,t:7,s:7};default:return{r:parseInt($("#addVoxColor").val().substring(1,3),16),g:parseInt($("#addVoxColor").val().substring(3,5),16),b:parseInt($("#addVoxColor").val().substring(5,7),16),a:r,t:i,s:parseInt($("#addVoxSpecular").val())}}}(),this.scene.add(l),this.objects.push(l)}if(1===t.button){if(p=s.object,e.call(this.planes,p)>=0)return;return h=(s.object.position.x-25)/50,c=(s.object.position.y-25)/50,u=(s.object.position.z-25)/50,a=this.voxels[u][c][h],$("#addVoxColor").val("#"+new THREE.Color("rgb("+a.r+","+a.g+","+a.b+")").getHexString()),a.r===(g=a.b)&&255===g&&0===a.g?$("#addVoxColor").change():($("#addVoxAlpha").val(a.a),$("#addVoxType").val(a.t),$("#addVoxSpecular").val(a.s),$("#addVoxColor").change())}return this.render()}},t.prototype.onDocumentKeyDown=function(t){if(1!==$(".active #modeView").length)switch(t.keyCode){case 18:return this.controls.enabled=!0,this.editMode=!1}},t.prototype.onDocumentKeyUp=function(t){if(1!==$(".active #modeView").length)switch(t.keyCode){case 18:return this.controls.enabled=!1,this.editMode=!0}},t.prototype.onWindowResize=function(){return this.width=this.domContainer.width(),this.height=this.domContainer.height()-5,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.render()},t}(),"object"==typeof module?module.exports=t:window.Renderer=t}.call(this),function(){var t,e,r,o,s;r=null,t=null,o=null,window.applicationCache.status!==window.applicationCache.UNCACHED&&(window.applicationCache.addEventListener("updateready",function(){return window.applicationCache.status===window.applicationCache.UPDATEREADY&&confirm("A new version of Troxel is available! Do you want to reload this page now to update? (You can reload this page at any time later to update to the new version.)")?location.reload():void 0}),s=setInterval(function(){return window.applicationCache.update()},6e5)),window.onpopstate=function(){var t,e,s,n,i,a,l,h;for(a=decodeURI(window.location.hash).replace("#","").split("&"),h=[],n=0,i=a.length;i>n;n++){if(t=a[n],l=t.split("="),e=l[0],s=l[1],"m"===e){r=new Base64IO(s),1===r.readonly&&$("#btnExport").hide(),0===r.readonly&&$("#btnExport").show(),$("#btnExportPng").show(),o=new Renderer(r);break}if("b"===e){$.getJSON("static/Trove.json",function(t){var e;return e=t[s],null!=e?(r=new Base64IO(e),$("#btnExport").hide(),$("#btnExportPng").show(),o=new Renderer(r)):void 0});break}h.push(void 0)}return h},window.onpopstate(),$('input[type="file"]').change(function(){var e,r,o,s;if($(this).prop("files").length>1){for(t=$(this).prop("files"),$("#filetabs li:last a").tab("show"),$("#tabdrag ul").empty(),s=[],r=0,o=t.length;o>r;r++)e=t[r],s.push($("#tabdrag ul").append($("<li>"+e.name+"</li>")));return s}}),e=document.getElementById("openModal"),e.addEventListener("dragover",function(t){return t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),e.addEventListener("drop",function(e){var r,o,s,n;if(e.stopPropagation(),e.preventDefault(),t=e.dataTransfer.files,t.length>0){for($("#dragTab").click(),$("#tabdrag ul").empty(),n=[],o=0,s=t.length;s>o;o++)r=t[o],n.push($("#tabdrag ul").append($("<li>"+r.name+"</li>")));return n}}),$("#open").click(function(){var e,s,n,i,a,l,h,c,u,d,p,g,b;switch(i=function(){return $("#openModal").modal("hide"),$("#modeEdit").parent().hasClass("active")&&$("#modeView").click(),null==r.readonly||0===r.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),o=new Renderer(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#m="+new Base64IO(r).export(!1))},console.log("##################################################"),$("#filetabs li.active a").attr("href")){case"#tabdrag":if("zox"===t[0].name.split(".").pop())r=new ZoxelIO(t[0],i);else if("vox"===t[0].name.split(".").pop())r=new MagicaIO(t[0],i);else if("qb"===t[0].name.split(".").pop()){for(l={},h=g=0,b=t.length;b>g;h=++g)switch(a=t[h],a.name.substr(-5)){case"_a.qb":null==l.a&&(l.a=a);break;case"_t.qb":null==l.t&&(l.t=a);break;case"_s.qb":null==l.s&&(l.s=a);break;default:".qb"===a.name.substr(-3)&&(l.m=a)}null!=l.m?r=new QubicleIO(l,i):alert("Can't find Qubicle main mesh file!")}else alert("Can't import selected file format.");break;case"#tabqb":a=$("#fqb").prop("files")[0],a&&"qb"===a.name.split(".").pop()?r=new QubicleIO({m:a,a:a=$("#fqba").prop("files")[0],t:a=$("#fqbt").prop("files")[0],s:a=$("#fqbs").prop("files")[0]},i):alert("Please choose at least a valid main mesh Qubicle (.qb) file above!");break;case"#tabvox":a=$("#fvox").prop("files")[0],a&&"vox"===a.name.split(".").pop()?r=new MagicaIO(a,i):alert("Please choose a valid Magica Voxel (.vox) file above!");break;case"#tabzox":a=$("#fzox").prop("files")[0],a&&"zox"===a.name.split(".").pop()?r=new ZoxelIO(a,i):alert("Please choose a valid Zoxel (.zox) file above!");break;case"#tabjson":r=new JsonIO($("#sjson").val()),i();break;case"#tabtrove":$.getJSON("static/Trove.json",function(t){var e;return e=t[$("#sbtrove").val()],null!=e?(r=new Base64IO(e),$("#openModal").modal("hide"),$("#btnExport").hide(),$("#btnExportPng").show(),o=new Renderer(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#b="+$("#sbtrove").val())):void 0});break;case"#tabnew":u=parseInt($("#snewX").val()),d=parseInt($("#snewY").val()),p=parseInt($("#snewZ").val()),c={},$("#cbnewAp").prop("checked")&&(e=parseInt($("#snewApX").val()),s=parseInt($("#snewApY").val()),n=parseInt($("#snewApZ").val()),u>e&&d>s&&p>n&&(c[n]={},c[n][s]={},c[n][s][e]={r:255,g:0,b:255,a:250,t:7,s:7})),r=new IO({x:u,y:d,z:p,voxels:c}),i(),$("#modeEdit").click()}}),$("#openTroveTab").click(function(){var t,e;return e=0,t=new Bloodhound({datumTokenizer:function(t){return t.value.split(/[\[,\],_]/i)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:1e4,prefetch:{url:"static/Trove.json",cacheKey:"TroveBlueprintCache",filter:function(t){return $.map(t,function(t,e){return{value:e}})}}}),t.initialize(),$("#sbtrove").typeahead({highlight:!0,minLength:2,hint:!1},{name:"troveBlueprints",source:t.ttAdapter()})}),$(".snewApPos").prop("disabled",!0),$("#cbnewAp").prop("checked",!1).change(function(){return $(".snewApPos").prop("disabled",!$(this).prop("checked"))}),$("#btnExport").click(function(){return $("#exportQb").text("Export as Qubicle (.qb) ...").removeAttr("href"),$("#exportQba").hide().removeAttr("href"),$("#exportQbt").hide().removeAttr("href"),$("#exportQbs").hide().removeAttr("href"),$("#exportZox").text("Export as Zoxel (.zox) ...").removeAttr("href"),$("#exportVox").text("Export as Magica Voxel (.vox) ...").removeAttr("href"),$("#exportBase64Ta").hide(),$("#exportJsonTa").hide()}),$("#exportQb").click(function(){var t,e,o,s,n;if(!r.readonly)return null==$(this).attr("href")?(n=new QubicleIO(r).export($("#exportQbComp").prop("checked")),t=n[0],e=n[1],s=n[2],o=n[3],$(this).text("Download main mash (.qb)").attr("href",t),$("#exportQba").show().attr("href",e),$("#exportQbt").show().attr("href",s),$("#exportQbs").show().attr("href",o)):void 0}),$("#exportZox").click(function(){return r.readonly?void 0:null==$(this).attr("href")?$(this).text("Download as Zoxel (.zox)").attr("href",new ZoxelIO(r).export()):void 0}),$("#exportVox").click(function(){return r.readonly?void 0:null==$(this).attr("href")?$(this).text("Download as Magica Voxel (.vox)").attr("href",new MagicaIO(r).export()):void 0}),$("#exportBase64").click(function(){return r.readonly?void 0:$("#exportBase64Ta").val(window.location.toString().split("#")[0]+"/#m="+new Base64IO(r).export($("#exportBase64Ro").prop("checked"))).fadeIn()}),$("#exportJson").click(function(){return r.readonly?void 0:$("#exportJsonTa").val(new JsonIO(r).export($("#exportJsonPret").prop("checked"))).fadeIn()}),$("#btnExportPng").click(function(){return o.render(!0)}),$("#ulSavedModels").parent().on("show.bs.dropdown",function(t){var e,s,n,i;if("#ulSavedModels"===$(t.relatedTarget).data("tag")){for(null==r||1===r.readonly?$(this).find("a[data-target=#saveModal]").prop("disabled",!0).parent().addClass("disabled"):$(this).find("a[data-target=#saveModal]").prop("disabled",!1).parent().removeClass("disabled"),$("#ulSavedModels li:gt(6)").remove(),e=n=0,i=window.localStorage.length;i>n;e=n+=1)s=window.localStorage.key(e),0!==s.indexOf("__")&&$("#ulSavedModels").append("<li><a class='openSavedModel' data-model='"+window.localStorage.getItem(s)+"'>"+s+"</a></li>");0===$(".openSavedModel").length&&$("#ulSavedModels").append('<li class="disabled"><a>No saved models</a></li>')}return $(".openSavedModel").click(function(){return r=new Base64IO($(this).data("model")),(null==r.readonly||0===r.readonly)&&$("#btnExport").show(),$("#btnExportPng").show(),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Toxel","#m="+$(this).data("model")),o=new Renderer(r),$("#ulSavedModels li:eq(1) a").text($(this).text())})}),$("#saveModelAs").click(function(){return 0===$("#saveModelName").val().length||null==r||r.readonly?void 0:(window.localStorage.setItem($("#saveModelName").val(),new Base64IO(r).export(r.readonly)),$("#saveModal").modal("hide"))}),$("#modeView").click(function(){return $(this).parent().addClass("active"),$("#modeEdit").parent().removeClass("active"),o.changeEditMode(!1),$("#addPanel").fadeOut()}),$("#modeEdit").click(function(){return r.readonly?void 0:($(this).parent().addClass("active"),$("#modeView").parent().removeClass("active"),o.changeEditMode(!0),$("#addPanel").fadeIn())}),$(".rotateBtn").click(function(){if(null!=r){switch($(this).data("rotate")){case"x":r.rotateX(!0);break;case"-x":r.rotateX(!1);break;case"y":r.rotateY(!0);break;case"-y":r.rotateY(!1);break;case"z":r.rotateZ(!0);break;case"-z":r.rotateZ(!1)}return o=new Renderer(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#m="+new Base64IO(r).export(!1))}}),$(".mirrorBtn").click(function(){if(null!=r){switch($(this).data("mirror")){case"x":r.mirrorX(!0);break;case"y":r.mirrorY(!0);break;case"z":r.mirrorZ(!0)}return o.reload(r),history.pushState({voxels:r.voxels,x:r.x,y:r.y,z:r.z},"Troxel","#m="+new Base64IO(r).export(!1))}}),$(".panel-heading").click(function(){return $(this).next().toggle()}),$("#ambLightColor").val("#606060").change(function(){return null!=r?(o.ambientLight.color=new THREE.Color($(this).val()),o.render()):void 0}),$("#dirLightColor").val("#ffffff").change(function(){return null!=r?(o.directionalLight.color=new THREE.Color($(this).val()),o.render()):void 0}),$("#dirLightIntensity").val(1).change(function(){return null!=r?(o.directionalLight.intensity=$(this).val(),o.render()):void 0}),$("#dirLightX").val("1"),$("#dirLightY").val("0.75"),$("#dirLightZ").val("0.5"),$("#dirLightVector").click(function(){return null!=r?(o.directionalLight.position.set(parseFloat($("#dirLightX").val()),parseFloat($("#dirLightY").val()),parseFloat($("#dirLightZ").val())).normalize(),o.render()):void 0}),$("#addVoxAP").click(function(){return $("#addVoxColor").val("#ff00ff"),$("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0)}),$("#addVoxColor").change(function(){switch($(this).val()){case"#ff00ff":return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0);default:return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!1),$("#addVoxType").change()}}),$("#addVoxType").change(function(){switch(parseInt($(this).val())){case 1:case 2:case 4:return $("#addVoxAlpha").prop("disabled",!1);case 0:case 3:return $("#addVoxAlpha").prop("disabled",!0)}})}.call(this)}();