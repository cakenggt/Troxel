(function(){"use strict";var a;a=function(){function a(b){return b instanceof a||"object"==typeof b&&null!=b.x&&null!=b.y&&null!=b.z&&null!=b.voxels?(this.voxels=b.voxels,this.x=b.x,this.y=b.y,this.z=b.z,!0):void 0}return a.prototype.verify=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==this.x||null==this.y||null==this.z||null==this.voxels)return!1;if(!(this.x>0&&this.y>0&&this.z>0&&Array.isArray(this.voxels)))return!1;if(this.voxels.length>this.z)return!1;for(g=this.voxels,a=0,d=g.length;d>a;a++){if(p=g[a],!Array.isArray(p)||p.length>this.y)return!1;for(b=0,e=p.length;e>b;b++){if(o=p[b],!Array.isArray(o)||o.length>this.x)return!1;for(c=0,f=o.length;f>c;c++){if(n=o[c],"object"!=typeof n)return!1;if(!("number"==typeof n.r&&0<=(h=n.r)&&255>=h))return!1;if(!("number"==typeof n.g&&0<=(i=n.g)&&255>=i))return!1;if(!("number"==typeof n.b&&0<=(j=n.b)&&255>=j))return!1;if(255===n.r&&0===n.g&&(n.b=255)){if("number"!=typeof n.a||250!==n.a)return!1;if("number"!=typeof n.t||7!==n.t)return!1;if("number"!=typeof n.s||7!==n.s)return!1}else{if("number"!=typeof n.a||16!==(k=n.a)&&48!==k&&80!==k&&112!==k&&144!==k&&176!==k&&208!==k&&240!==k&&255!==k)return!1;if(!("number"==typeof n.t&&0<=(l=n.t)&&4>=l))return!1;if(!("number"==typeof n.s&&0<=(m=n.s)&&3>=m))return!1}}}}return!0},a.prototype.rotateX=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.voxels.slice(0),this.voxels=[],n=b=0,e=this.z;e>b;n=b+=1)for(m=c=0,f=this.y;f>c;m=c+=1)for(l=d=0,g=this.x;g>d;l=d+=1)null!=(null!=(h=k[a?this.z-n-1:n])&&null!=(i=h[a?m:this.y-m-1])?i[l]:void 0)&&(null==this.voxels[m]&&(this.voxels[m]=[]),null==this.voxels[m][n]&&(this.voxels[m][n]=[]),this.voxels[m][n][l]=k[a?this.z-n-1:n][a?m:this.y-m-1][l]);return j=[this.y,this.z],this.z=j[0],this.y=j[1],j},a.prototype.rotateY=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.voxels.slice(0),this.voxels=[],n=b=0,e=this.z;e>b;n=b+=1)for(m=c=0,f=this.y;f>c;m=c+=1)for(l=d=0,g=this.x;g>d;l=d+=1)null!=(null!=(h=k[a?this.z-n-1:n])&&null!=(i=h[m])?i[a?l:this.x-l-1]:void 0)&&(null==this.voxels[l]&&(this.voxels[l]=[]),null==this.voxels[l][m]&&(this.voxels[l][m]=[]),this.voxels[l][m][n]=k[a?this.z-n-1:n][m][a?l:this.x-l-1]);return j=[this.x,this.z],this.z=j[0],this.x=j[1],j},a.prototype.rotateZ=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.voxels.slice(0),this.voxels=[],n=b=0,e=this.z;e>b;n=b+=1)for(m=c=0,f=this.y;f>c;m=c+=1)for(l=d=0,g=this.x;g>d;l=d+=1)null!=(null!=(h=k[n])&&null!=(i=h[a?m:this.y-m-1])?i[a?this.x-l-1:l]:void 0)&&(null==this.voxels[n]&&(this.voxels[n]=[]),null==this.voxels[n][l]&&(this.voxels[n][l]=[]),this.voxels[n][l][m]=k[n][a?m:this.y-m-1][a?this.x-l-1:l]);return j=[this.x,this.y],this.y=j[0],this.x=j[1],j},a.prototype.mirrorX=function(){var a,b,c,d,e,f,g;for(d=this.voxels.slice(0),this.voxels=[],c=[],g=a=0,b=this.z;b>a;g=a+=1)c.push(function(){var a,b,c;for(c=[],f=a=0,b=this.y;b>a;f=a+=1)c.push(function(){var a,b,c,h,i;for(i=[],e=a=0,b=this.x;b>a;e=a+=1)null!=(null!=(c=d[g])&&null!=(h=c[f])?h[this.x-e-1]:void 0)&&(null==this.voxels[g]&&(this.voxels[g]=[]),null==this.voxels[g][f]&&(this.voxels[g][f]=[]),i.push(this.voxels[g][f][e]=d[g][f][this.x-e-1]));return i}.call(this));return c}.call(this));return c},a.prototype.mirrorY=function(){var a,b,c,d,e,f,g;for(d=this.voxels.slice(0),this.voxels=[],c=[],g=a=0,b=this.z;b>a;g=a+=1)c.push(function(){var a,b,c;for(c=[],f=a=0,b=this.y;b>a;f=a+=1)c.push(function(){var a,b,c,h,i;for(i=[],e=a=0,b=this.x;b>a;e=a+=1)null!=(null!=(c=d[g])&&null!=(h=c[this.y-f-1])?h[e]:void 0)&&(null==this.voxels[g]&&(this.voxels[g]=[]),null==this.voxels[g][f]&&(this.voxels[g][f]=[]),i.push(this.voxels[g][f][e]=d[g][this.y-f-1][e]));return i}.call(this));return c}.call(this));return c},a.prototype.mirrorZ=function(){var a,b,c,d,e,f,g;for(d=this.voxels.slice(0),this.voxels=[],c=[],g=a=0,b=this.z;b>a;g=a+=1)c.push(function(){var a,b,c;for(c=[],f=a=0,b=this.y;b>a;f=a+=1)c.push(function(){var a,b,c,h,i;for(i=[],e=a=0,b=this.x;b>a;e=a+=1)null!=(null!=(c=d[this.z-g-1])&&null!=(h=c[f])?h[e]:void 0)&&(null==this.voxels[g]&&(this.voxels[g]=[]),null==this.voxels[g][f]&&(this.voxels[g][f]=[]),i.push(this.voxels[g][f][e]=d[this.z-g-1][f][e]));return i}.call(this));return c}.call(this));return c},a.prototype.moveX=function(a){var b,c,d,e,f,g,h;for(d=[],h=b=0,c=this.z;c>b;h=b+=1)null!=this.voxels[h]&&d.push(function(){var b,c,d,i,j,k,l,m;for(m=[],g=b=0,d=this.y;d>b;g=b+=1)if(null!=(null!=(i=this.voxels[h])?i[g]:void 0)){for(f=this.voxels[h][g][a?0:this.x-1],e=c=0,j=this.x-1;j>c;e=c+=1)null!=(null!=(k=this.voxels[h])&&null!=(l=k[g])?l[a?e+1:this.x-2-e]:void 0)?this.voxels[h][g][a?e:this.x-1-e]=this.voxels[h][g][a?e+1:this.x-2-e]:delete this.voxels[h][g][a?e:this.x-1-e];m.push(null!=f?this.voxels[h][g][a?this.x-1:0]=f:delete this.voxels[h][g][a?this.x-1:0])}return m}.call(this));return d},a.prototype.moveY=function(a){var b,c,d,e,f,g,h,i,j;for(g=[],j=b=0,d=this.z;d>b;j=b+=1)if(null!=this.voxels[j]){for(i=this.voxels[j][a?0:this.y-1],h=c=0,e=this.y-1;e>c;h=c+=1)null!=(null!=(f=this.voxels[j])?f[a?h+1:this.y-2-h]:void 0)?this.voxels[j][a?h:this.y-1-h]=this.voxels[j][a?h+1:this.y-2-h]:delete this.voxels[j][a?h:this.y-1-h];g.push(null!=i?this.voxels[j][a?this.y-1:0]=i:delete this.voxels[j][a?this.y-1:0])}return g},a.prototype.moveZ=function(a){var b,c,d,e;for(e=this.voxels[a?0:this.z-1],d=b=0,c=this.z-1;c>b;d=b+=1)null!=this.voxels[a?d+1:this.z-2-d]?this.voxels[a?d:this.z-1-d]=this.voxels[a?d+1:this.z-2-d]:delete this.voxels[a?d:this.z-1-d];return null!=e?this.voxels[a?this.z-1:0]=e:delete this.voxels[a?this.z-1:0]},a.prototype.resize=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(c<this.z)for(g=d=m=c,n=this.z;n>d;g=d+=1)delete this.voxels[g];if(this.z=c,b<this.y)for(g=h=0,o=this.z;o>h;g=h+=1)if(null!=this.voxels[g])for(f=i=p=b,q=this.y;q>i;f=i+=1)delete this.voxels[g][f];if(this.y=b,c<this.z)for(g=j=0,r=this.z;r>j;g=j+=1)if(null!=this.voxels[g])for(f=k=0,s=this.y;s>k;f=k+=1)if(null!=this.voxels[g][f])for(e=l=t=a,u=this.x;u>l;e=l+=1)delete this.voxels[g][f][g];return this.x=a},a}(),"object"==typeof module?module.exports=a:window.IO=a}).call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a,b){var d;c.__super__.constructor.call(this,a)||(this.voxels=[],this.x=this.y=this.z=-1,this.loadingState=0,d=new FileReader,d.onloadend=function(c){return function(){var e,f,g;return c.readFile(d.result,0),null!=a.a?(e=new FileReader,e.onloadend=function(){return c.readFile(e.result,1),2===c.loadingState++?b():void 0},console.log("reading alpha file with name: "+a.a.name),e.readAsArrayBuffer(a.a)):c.loadingState++,null!=a.t?(g=new FileReader,g.onloadend=function(){return c.readFile(g.result,2),2===c.loadingState++?b():void 0},console.log("reading type file with name: "+a.t.name),g.readAsArrayBuffer(a.t)):c.loadingState++,null!=a.s?(f=new FileReader,f.onloadend=function(){return c.readFile(f.result,3),2===c.loadingState++?b():void 0},console.log("reading specular file with name: "+a.s.name),f.readAsArrayBuffer(a.s)):c.loadingState++,3===c.loadingState?b():void 0}}(this),console.log("reading file with name: "+a.m.name),d.readAsArrayBuffer(a.m))}return b(c,a),c.prototype.readFile=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;if(console.log("file.byteLength: "+a.byteLength),G=new Uint32Array(a.slice(0,24)),U=G[0],d=G[1],Z=G[2],e=G[3],V=G[4],y=G[5],console.log("version: "+U+" (expected 257 = 1.1.0.0 = current version)"),257!==U&&console.warn("Expected version 257 but found version: "+U+" (May result in errors)"),console.log("color format: "+d+" (0 for RGBA (recommended) or 1 for BGRA)"),console.log("z-axis oriantation: "+Z+" (0 for left (recommended), 1 for right handed)"),console.log("compression: "+e+" (0 for uncompressed, 1 for compressed with run length encoding (RLE))"),console.log("visability mask: "+V+" (should be 0 for encoded in A value, no partially visability)"),0!==V&&console.warn("partially visability not supported and will be ignored / handled as full visibility"),console.log("matrix count:  "+y),y>1&&console.warn("matrices will be merged into one matrix with regard to their offsets"),i=k=m=0,y>1)for(z=24,n=u=1,H=y;H>=u;n=u+=1)if(C=new Uint8Array(a.slice(z,z+1))[0],L=new Uint32Array(a.slice(z+1+C,z+13+C)),W=L[0],X=L[1],Y=L[2],M=new Int32Array(a.slice(z+13+C,z+25+C)),h=M[0],j=M[1],l=M[2],i=Math.min(i,h),k=Math.min(k,j),m=Math.min(m,l),0===e)z+=25+C+4*W*X*Y;else{for(o=0,g=new Uint8Array(a.slice(z+25+C)),s=v=0,N=Y;N>v;s=v+=1)for(;;){if(o+=4,6===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1])break;2===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1]&&(o+=8)}z+=25+C+o}for(x=24,n=w=1,O=y;O>=w;n=w+=1){if(console.log("------------------------ Matrix: "+n+" ------------------------"),C=new Uint8Array(a.slice(x,x+1))[0],B=function(){var b,d,e,f;for(e=new Uint8Array(a.slice(x+1,x+1+C)),f=[],d=0,b=e.length;b>d;d++)c=e[d],f.push(String.fromCharCode(c));return f}().join(""),console.log("reading "+n+". matrix with name: "+B),P=new Uint32Array(a.slice(x+1+C,x+13+C)),W=P[0],X=P[1],Y=P[2],console.log("dimensions: width: "+W+" height: "+X+" depth: "+Y),X>4294967e3)return this.error=!0;if(Q=new Int32Array(a.slice(x+13+C,x+25+C)),h=Q[0],j=Q[1],l=Q[2],console.log("position: dx : "+h+" dy: "+j+" dz: "+l+" (ignored if only 1 matrix)"),1===y&&(h=j=l=0),y>1&&(h-=i,j-=k,l-=m),console.log("position result: dx : "+h+" dy: "+j+" dz: "+l),0===b&&(this.x=Math.max(this.x,W+h),this.y=Math.max(this.y,X+j),this.z=Math.max(this.z,Y+l)),0===e){for(g=new Uint8Array(a.slice(x+25+C,x+25+C+4*W*X*Y)),s=A=0,R=Y;R>A;s=A+=1)for(r=D=0,S=X;S>D;r=D+=1)for(q=E=0,I=W;I>E;q=E+=1)o=4*(s*X*W+r*W+q),g[o+3]>0&&this.addValues(b,q+h,r+j,Y,s,l,Z,g[o],g[o+1],g[o+2],d);x+=25+C+4*W*X*Y}else{for(g=new Uint8Array(a.slice(x+25+C)),o=0,s=F=0,J=Y;J>F;s=F+=1)for(p=0;;){if(o+=4,6===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1])break;if(2===g[o-4]&&0===g[o-3]&&0===g[o-2]&&0===g[o-1]){if(f=g[o]+(g[o+1]<<8)+(g[o+2]<<16)+(g[o+3]<<24),g[o+7]>0)for(t=T=0,K=f;K>T;t=T+=1)q=p%W,r=Math.floor(p/W),p++,this.addValues(b,q+h,r+j,Y,s,l,Z,g[o+4],g[o+5],g[o+6],d);else p+=f;o+=8}else q=p%W,r=Math.floor(p/W),p++,g[o-1]>0&&this.addValues(b,q+h,r+j,Y,s,l,Z,g[o-4],g[o-3],g[o-2],d)}x+=25+C+o}}return console.log("voxels:"),console.log(this.voxels),x!==a.byteLength?console.warn(console.log("There shouldn't be any bytes left")):void 0},c.prototype.addValues=function(a,b,c,d,e,f,g,h,i,j,k){var l;switch(d=(0===g?e:d-e-1)+f,1===k&&(l=[j,h],h=l[0],j=l[1]),a){case 0:return this.addColorValues(b,c,d,h,i,j);case 1:return this.addAlphaValues(b,c,d,h,i,j);case 2:return this.addTypeValues(b,c,d,h,i,j);case 3:return this.addSpecularValues(b,c,d,h,i,j)}},c.prototype.addColorValues=function(a,b,c,d,e,f){return null==this.voxels[c]&&(this.voxels[c]=[]),null==this.voxels[c][b]&&(this.voxels[c][b]=[]),this.voxels[c][b][a]=d===f&&255===f&&0===e?{r:255,g:0,b:255,a:250,t:7,s:7}:{r:d,g:e,b:f,a:255,t:0,s:0}},c.prototype.addAlphaValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?console.warn("Ignoring alpha voxel because of non existing color voxel at the same position"):d===e&&e===f?16===d||48===d||80===d||112===d||144===d||176===d||208===d||240===d||255===d?this.voxels[c][b][a].a=d:(console.warn("invalid alpha value "+d+": falling back to 122"),this.voxels[c][b][a].a=112):d===f&&255===f&&0===e?this.voxels[c][b][a].a=250:(console.warn("invalid alpha value: r, g and b are not equal, falling back to 112"),this.voxels[c][b][a].a=112)},c.prototype.addTypeValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?console.warn("Ignoring type voxel because of non existing color voxel at the same position"):255===d&&255===e&&255===f?this.voxels[c][b][a].t=0:128===d&&128===e&&128===f?this.voxels[c][b][a].t=1:64===d&&64===e&&64===f?this.voxels[c][b][a].t=2:255===d&&0===e&&0===f?this.voxels[c][b][a].t=3:255===d&&255===e&&0===f?this.voxels[c][b][a].t=4:255===d&&0===e&&255===f?this.voxels[c][b][a].t=7:(console.warn("invalid type value (r: "+d+", g: "+e+", b: "+f+"), falling back to solid"),this.voxels[c][b][a].t=0)},c.prototype.addSpecularValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?console.warn("Ignoring specular voxel because of non existing color voxel at the same position"):128===d&&0===e&&0===f?this.voxels[c][b][a].s=0:0===d&&128===e&&0===f?this.voxels[c][b][a].s=1:0===d&&0===e&&128===f?this.voxels[c][b][a].s=2:128===d&&128===e&&0===f?this.voxels[c][b][a].s=3:255===d&&0===e&&255===f?this.voxels[c][b][a].s=7:((d!==e||e!==f||255!==f)&&console.warn("invalid specular value (r: "+d+", g: "+e+", b: "+f+"), falling back to rough"),this.voxels[c][b][a].s=0)},c.prototype.export=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(f=[1,1,0,0,0,0,0,0,0,0,0,0,+a,0,0,0,0,0,0,0,1,0,0,0,5,77,157,144,145,154,this.x,0,0,0,this.y,0,0,0,this.z,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=f.slice(0),i=f.slice(0),h=f.slice(0),k=function(a){if(null==a)return f.push(0,0,0,0),g.push(0,0,0,0),i.push(0,0,0,0),h.push(0,0,0,0);switch(f.push(a.r,a.g,a.b,255),a.a){case 250:g.push(255,0,255,255);break;case 255:g.push(255,255,255,255);break;case 240:g.push(240,240,240,255);break;case 208:g.push(208,208,208,255);break;case 176:g.push(176,176,176,255);break;case 144:g.push(144,144,144,255);break;case 112:g.push(112,112,112,255);break;case 80:g.push(80,80,80,255);break;case 48:g.push(48,48,48,255);break;case 16:g.push(16,16,16,255);break;default:g.push(112,112,112,255)}switch(a.t){case 0:i.push(255,255,255,255);break;case 1:i.push(128,128,128,255);break;case 2:i.push(64,64,64,255);break;case 3:i.push(255,0,0,255);break;case 4:i.push(255,255,0,255);break;case 7:i.push(255,0,255,255);break;default:i.push(255,255,255,255)}switch(a.s){case 0:return h.push(128,0,0,255);case 1:return h.push(0,128,0,255);case 2:return h.push(0,0,128,255);case 3:return h.push(128,128,0,255);case 7:return h.push(255,0,255,255);default:return h.push(128,0,0,255)}},j=function(a,b){var c,d,e,f;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;for(f=["r","g","b","a","t","s"],d=0,e=f.length;e>d;d++)if(c=f[d],a[c]!==b[c])return!1;return!0},a)for(N=m=0,w=this.z;w>m;N=m+=1){if(null!=this.voxels[N]){for(K=[],o=-1,M=n=0,x=this.y;x>n;M=n+=1)for(L=q=0,A=this.x;A>q;L=q+=1)K.push(null!=(B=this.voxels[N][M])?B[L]:void 0),null!=(null!=(C=this.voxels[N][M])?C[L]:void 0)&&(o=K.length-1);for(l=0;o>=l;){for(v=1;o>=l+v&&j(K[l+v-1],K[l+v]);)v++;v>1&&(D=new Uint8Array(new Uint32Array([v]).buffer),b=D[0],c=D[1],d=D[2],e=D[3],f.push(2,0,0,0,b,c,d,e),g.push(2,0,0,0,b,c,d,e),i.push(2,0,0,0,b,c,d,e),h.push(2,0,0,0,b,c,d,e)),k(K[l]),l+=v}}f.push(6,0,0,0),g.push(6,0,0,0),i.push(6,0,0,0),h.push(6,0,0,0)}else for(N=r=0,E=this.z;E>r;N=r+=1)for(M=s=0,F=this.y;F>s;M=s+=1)for(L=t=0,G=this.x;G>t;L=t+=1)k(null!=(H=this.voxels[N])&&null!=(y=H[M])?y[L]:void 0);for(console.log("export Qubicle:"),console.log(f),z=[f,g,i,h],I=[],u=0,p=z.length;p>u;u++)J=z[u],I.push(URL.createObjectURL(new Blob([new Uint8Array(J)],{type:"application/octet-binary"})));return I},c}(IO),"object"==typeof module?module.exports=a:window.QubicleIO=a}.call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a,b){var d;c.__super__.constructor.call(this,a)||(d=new FileReader,d.onloadend=function(a){return function(){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;if(c=d.result,p=function(){var a,b,d,f;for(d=new Uint8Array(c.slice(0,4)),f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log("meta: "+p+" (expected VOX )"),"VOX "!==p)throw new Error("Expected Magica Voxel header not found");if(C=new Uint32Array(c.slice(4,8))[0],console.log("version: "+C+" (expected 150)"),150!==C&&console.warn("Expected version 150 but found version: "+C+" (May result in errors)"),n=function(){var a,b,d,f;for(d=new Uint8Array(c.slice(8,12)),f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log("mainChunkId: "+n+" (expected MAIN)"),"MAIN"!==n)throw new Error("Didn't found main Chunk as expected");for(v=new Uint32Array(c.slice(12,20)),o=v[0],m=v[1],console.log("mainChunkSize: "+o+" (expected 0)"),console.log("mainChunkChildSize: "+m),20+m!==c.byteLength&&console.warn(console.log("There shouldn't be any bytes left")),h=20+o,A=B=E=G=r=s=-1;20+o+m>h;){switch(g=function(){var a,b,d,f;for(d=new Uint8Array(c.slice(h,h+4)),f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),w=new Uint32Array(c.slice(h+4,h+12)),i=w[0],f=w[1],console.log("found child chunk: "+g+" with begin: "+(h+12)+", size: "+i+" and childSize: "+f+" (expected 0)"),g){case"SIZE":12!==i&&console.warn("invalid length of size chunk"),A=h+12,B=A+i;break;case"XYZI":E=h+12,G=E+i;break;case"RGBA":r=h+12,1024!==i&&console.warn("invalid length of palette chunk"),s=i}h+=12+i+f}if(-1===A||-1===B||-1===E||-1===G)throw new Error("missing chunks");if(x=new Uint32Array(c.slice(A,B)),a.x=x[0],a.z=x[1],a.y=x[2],console.log("dimensions: width: "+a.x+" height: "+a.y+" depth: "+a.z),q=[],-1===r||-1===s)q=[{r:255,g:255,b:255,a:255,t:0,s:0},{r:255,g:255,b:204,a:255,t:0,s:0},{r:255,g:255,b:153,a:255,t:0,s:0},{r:255,g:255,b:102,a:255,t:0,s:0},{r:255,g:255,b:51,a:255,t:0,s:0},{r:255,g:255,b:0,a:255,t:0,s:0},{r:255,g:204,b:255,a:255,t:0,s:0},{r:255,g:204,b:204,a:255,t:0,s:0},{r:255,g:204,b:153,a:255,t:0,s:0},{r:255,g:204,b:102,a:255,t:0,s:0},{r:255,g:204,b:51,a:255,t:0,s:0},{r:255,g:204,b:0,a:255,t:0,s:0},{r:255,g:153,b:255,a:255,t:0,s:0},{r:255,g:153,b:204,a:255,t:0,s:0},{r:255,g:153,b:153,a:255,t:0,s:0},{r:255,g:153,b:102,a:255,t:0,s:0},{r:255,g:153,b:51,a:255,t:0,s:0},{r:255,g:153,b:0,a:255,t:0,s:0},{r:255,g:102,b:255,a:255,t:0,s:0},{r:255,g:102,b:204,a:255,t:0,s:0},{r:255,g:102,b:153,a:255,t:0,s:0},{r:255,g:102,b:102,a:255,t:0,s:0},{r:255,g:102,b:51,a:255,t:0,s:0},{r:255,g:102,b:0,a:255,t:0,s:0},{r:255,g:51,b:255,a:255,t:0,s:0},{r:255,g:51,b:204,a:255,t:0,s:0},{r:255,g:51,b:153,a:255,t:0,s:0},{r:255,g:51,b:102,a:255,t:0,s:0},{r:255,g:51,b:51,a:255,t:0,s:0},{r:255,g:51,b:0,a:255,t:0,s:0},{r:255,g:0,b:255,a:250,t:7,s:7},{r:255,g:0,b:204,a:255,t:0,s:0},{r:255,g:0,b:153,a:255,t:0,s:0},{r:255,g:0,b:102,a:255,t:0,s:0},{r:255,g:0,b:51,a:255,t:0,s:0},{r:255,g:0,b:0,a:255,t:0,s:0},{r:204,g:255,b:255,a:255,t:0,s:0},{r:204,g:255,b:204,a:255,t:0,s:0},{r:204,g:255,b:153,a:255,t:0,s:0},{r:204,g:255,b:102,a:255,t:0,s:0},{r:204,g:255,b:51,a:255,t:0,s:0},{r:204,g:255,b:0,a:255,t:0,s:0},{r:204,g:204,b:255,a:255,t:0,s:0},{r:204,g:204,b:204,a:255,t:0,s:0},{r:204,g:204,b:153,a:255,t:0,s:0},{r:204,g:204,b:102,a:255,t:0,s:0},{r:204,g:204,b:51,a:255,t:0,s:0},{r:204,g:204,b:0,a:255,t:0,s:0},{r:204,g:153,b:255,a:255,t:0,s:0},{r:204,g:153,b:204,a:255,t:0,s:0},{r:204,g:153,b:153,a:255,t:0,s:0},{r:204,g:153,b:102,a:255,t:0,s:0},{r:204,g:153,b:51,a:255,t:0,s:0},{r:204,g:153,b:0,a:255,t:0,s:0},{r:204,g:102,b:255,a:255,t:0,s:0},{r:204,g:102,b:204,a:255,t:0,s:0},{r:204,g:102,b:153,a:255,t:0,s:0},{r:204,g:102,b:102,a:255,t:0,s:0},{r:204,g:102,b:51,a:255,t:0,s:0},{r:204,g:102,b:0,a:255,t:0,s:0},{r:204,g:51,b:255,a:255,t:0,s:0},{r:204,g:51,b:204,a:255,t:0,s:0},{r:204,g:51,b:153,a:255,t:0,s:0},{r:204,g:51,b:102,a:255,t:0,s:0},{r:204,g:51,b:51,a:255,t:0,s:0},{r:204,g:51,b:0,a:255,t:0,s:0},{r:204,g:0,b:255,a:255,t:0,s:0},{r:204,g:0,b:204,a:255,t:0,s:0},{r:204,g:0,b:153,a:255,t:0,s:0},{r:204,g:0,b:102,a:255,t:0,s:0},{r:204,g:0,b:51,a:255,t:0,s:0},{r:204,g:0,b:0,a:255,t:0,s:0},{r:153,g:255,b:255,a:255,t:0,s:0},{r:153,g:255,b:204,a:255,t:0,s:0},{r:153,g:255,b:153,a:255,t:0,s:0},{r:153,g:255,b:102,a:255,t:0,s:0},{r:153,g:255,b:51,a:255,t:0,s:0},{r:153,g:255,b:0,a:255,t:0,s:0},{r:153,g:204,b:255,a:255,t:0,s:0},{r:153,g:204,b:204,a:255,t:0,s:0},{r:153,g:204,b:153,a:255,t:0,s:0},{r:153,g:204,b:102,a:255,t:0,s:0},{r:153,g:204,b:51,a:255,t:0,s:0},{r:153,g:204,b:0,a:255,t:0,s:0},{r:153,g:153,b:255,a:255,t:0,s:0},{r:153,g:153,b:204,a:255,t:0,s:0},{r:153,g:153,b:153,a:255,t:0,s:0},{r:153,g:153,b:102,a:255,t:0,s:0},{r:153,g:153,b:51,a:255,t:0,s:0},{r:153,g:153,b:0,a:255,t:0,s:0},{r:153,g:102,b:255,a:255,t:0,s:0},{r:153,g:102,b:204,a:255,t:0,s:0},{r:153,g:102,b:153,a:255,t:0,s:0},{r:153,g:102,b:102,a:255,t:0,s:0},{r:153,g:102,b:51,a:255,t:0,s:0},{r:153,g:102,b:0,a:255,t:0,s:0},{r:153,g:51,b:255,a:255,t:0,s:0},{r:153,g:51,b:204,a:255,t:0,s:0},{r:153,g:51,b:153,a:255,t:0,s:0},{r:153,g:51,b:102,a:255,t:0,s:0},{r:153,g:51,b:51,a:255,t:0,s:0},{r:153,g:51,b:0,a:255,t:0,s:0},{r:153,g:0,b:255,a:255,t:0,s:0},{r:153,g:0,b:204,a:255,t:0,s:0},{r:153,g:0,b:153,a:255,t:0,s:0},{r:153,g:0,b:102,a:255,t:0,s:0},{r:153,g:0,b:51,a:255,t:0,s:0},{r:153,g:0,b:0,a:255,t:0,s:0},{r:102,g:255,b:255,a:255,t:0,s:0},{r:102,g:255,b:204,a:255,t:0,s:0},{r:102,g:255,b:153,a:255,t:0,s:0},{r:102,g:255,b:102,a:255,t:0,s:0},{r:102,g:255,b:51,a:255,t:0,s:0},{r:102,g:255,b:0,a:255,t:0,s:0},{r:102,g:204,b:255,a:255,t:0,s:0},{r:102,g:204,b:204,a:255,t:0,s:0},{r:102,g:204,b:153,a:255,t:0,s:0},{r:102,g:204,b:102,a:255,t:0,s:0},{r:102,g:204,b:51,a:255,t:0,s:0},{r:102,g:204,b:0,a:255,t:0,s:0},{r:102,g:153,b:255,a:255,t:0,s:0},{r:102,g:153,b:204,a:255,t:0,s:0},{r:102,g:153,b:153,a:255,t:0,s:0},{r:102,g:153,b:102,a:255,t:0,s:0},{r:102,g:153,b:51,a:255,t:0,s:0},{r:102,g:153,b:0,a:255,t:0,s:0},{r:102,g:102,b:255,a:255,t:0,s:0},{r:102,g:102,b:204,a:255,t:0,s:0},{r:102,g:102,b:153,a:255,t:0,s:0},{r:102,g:102,b:102,a:255,t:0,s:0},{r:102,g:102,b:51,a:255,t:0,s:0},{r:102,g:102,b:0,a:255,t:0,s:0},{r:102,g:51,b:255,a:255,t:0,s:0},{r:102,g:51,b:204,a:255,t:0,s:0},{r:102,g:51,b:153,a:255,t:0,s:0},{r:102,g:51,b:102,a:255,t:0,s:0},{r:102,g:51,b:51,a:255,t:0,s:0},{r:102,g:51,b:0,a:255,t:0,s:0},{r:102,g:0,b:255,a:255,t:0,s:0},{r:102,g:0,b:204,a:255,t:0,s:0},{r:102,g:0,b:153,a:255,t:0,s:0},{r:102,g:0,b:102,a:255,t:0,s:0},{r:102,g:0,b:51,a:255,t:0,s:0},{r:102,g:0,b:0,a:255,t:0,s:0},{r:51,g:255,b:255,a:255,t:0,s:0},{r:51,g:255,b:204,a:255,t:0,s:0},{r:51,g:255,b:153,a:255,t:0,s:0},{r:51,g:255,b:102,a:255,t:0,s:0},{r:51,g:255,b:51,a:255,t:0,s:0},{r:51,g:255,b:0,a:255,t:0,s:0},{r:51,g:204,b:255,a:255,t:0,s:0},{r:51,g:204,b:204,a:255,t:0,s:0},{r:51,g:204,b:153,a:255,t:0,s:0},{r:51,g:204,b:102,a:255,t:0,s:0},{r:51,g:204,b:51,a:255,t:0,s:0},{r:51,g:204,b:0,a:255,t:0,s:0},{r:51,g:153,b:255,a:255,t:0,s:0},{r:51,g:153,b:204,a:255,t:0,s:0},{r:51,g:153,b:153,a:255,t:0,s:0},{r:51,g:153,b:102,a:255,t:0,s:0},{r:51,g:153,b:51,a:255,t:0,s:0},{r:51,g:153,b:0,a:255,t:0,s:0},{r:51,g:102,b:255,a:255,t:0,s:0},{r:51,g:102,b:204,a:255,t:0,s:0},{r:51,g:102,b:153,a:255,t:0,s:0},{r:51,g:102,b:102,a:255,t:0,s:0},{r:51,g:102,b:51,a:255,t:0,s:0},{r:51,g:102,b:0,a:255,t:0,s:0},{r:51,g:51,b:255,a:255,t:0,s:0},{r:51,g:51,b:204,a:255,t:0,s:0},{r:51,g:51,b:153,a:255,t:0,s:0},{r:51,g:51,b:102,a:255,t:0,s:0},{r:51,g:51,b:51,a:255,t:0,s:0},{r:51,g:51,b:0,a:255,t:0,s:0},{r:51,g:0,b:255,a:255,t:0,s:0},{r:51,g:0,b:204,a:255,t:0,s:0},{r:51,g:0,b:153,a:255,t:0,s:0},{r:51,g:0,b:102,a:255,t:0,s:0},{r:51,g:0,b:51,a:255,t:0,s:0},{r:51,g:0,b:0,a:255,t:0,s:0},{r:0,g:255,b:255,a:255,t:0,s:0},{r:0,g:255,b:204,a:255,t:0,s:0},{r:0,g:255,b:153,a:255,t:0,s:0},{r:0,g:255,b:102,a:255,t:0,s:0},{r:0,g:255,b:51,a:255,t:0,s:0},{r:0,g:255,b:0,a:255,t:0,s:0},{r:0,g:204,b:255,a:255,t:0,s:0},{r:0,g:204,b:204,a:255,t:0,s:0},{r:0,g:204,b:153,a:255,t:0,s:0},{r:0,g:204,b:102,a:255,t:0,s:0},{r:0,g:204,b:51,a:255,t:0,s:0},{r:0,g:204,b:0,a:255,t:0,s:0},{r:0,g:153,b:255,a:255,t:0,s:0},{r:0,g:153,b:204,a:255,t:0,s:0},{r:0,g:153,b:153,a:255,t:0,s:0},{r:0,g:153,b:102,a:255,t:0,s:0},{r:0,g:153,b:51,a:255,t:0,s:0},{r:0,g:153,b:0,a:255,t:0,s:0},{r:0,g:102,b:255,a:255,t:0,s:0},{r:0,g:102,b:204,a:255,t:0,s:0},{r:0,g:102,b:153,a:255,t:0,s:0},{r:0,g:102,b:102,a:255,t:0,s:0},{r:0,g:102,b:51,a:255,t:0,s:0},{r:0,g:102,b:0,a:255,t:0,s:0},{r:0,g:51,b:255,a:255,t:0,s:0},{r:0,g:51,b:204,a:255,t:0,s:0},{r:0,g:51,b:153,a:255,t:0,s:0},{r:0,g:51,b:102,a:255,t:0,s:0},{r:0,g:51,b:51,a:255,t:0,s:0},{r:0,g:51,b:0,a:255,t:0,s:0},{r:0,g:0,b:255,a:255,t:0,s:0},{r:0,g:0,b:204,a:255,t:0,s:0},{r:0,g:0,b:153,a:255,t:0,s:0},{r:0,g:0,b:102,a:255,t:0,s:0},{r:0,g:0,b:51,a:255,t:0,s:0},{r:238,g:0,b:0,a:255,t:0,s:0},{r:221,g:0,b:0,a:255,t:0,s:0},{r:187,g:0,b:0,a:255,t:0,s:0},{r:170,g:0,b:0,a:255,t:0,s:0},{r:136,g:0,b:0,a:255,t:0,s:0},{r:119,g:0,b:0,a:255,t:0,s:0},{r:85,g:0,b:0,a:255,t:0,s:0},{r:68,g:0,b:0,a:255,t:0,s:0},{r:34,g:0,b:0,a:255,t:0,s:0},{r:17,g:0,b:0,a:255,t:0,s:0},{r:0,g:238,b:0,a:255,t:0,s:0},{r:0,g:221,b:0,a:255,t:0,s:0},{r:0,g:187,b:0,a:255,t:0,s:0},{r:0,g:170,b:0,a:255,t:0,s:0},{r:0,g:136,b:0,a:255,t:0,s:0},{r:0,g:119,b:0,a:255,t:0,s:0},{r:0,g:85,b:0,a:255,t:0,s:0},{r:0,g:68,b:0,a:255,t:0,s:0},{r:0,g:34,b:0,a:255,t:0,s:0},{r:0,g:17,b:0,a:255,t:0,s:0},{r:0,g:0,b:238,a:255,t:0,s:0},{r:0,g:0,b:221,a:255,t:0,s:0},{r:0,g:0,b:187,a:255,t:0,s:0},{r:0,g:0,b:170,a:255,t:0,s:0},{r:0,g:0,b:136,a:255,t:0,s:0},{r:0,g:0,b:119,a:255,t:0,s:0},{r:0,g:0,b:85,a:255,t:0,s:0},{r:0,g:0,b:68,a:255,t:0,s:0},{r:0,g:0,b:34,a:255,t:0,s:0},{r:0,g:0,b:17,a:255,t:0,s:0},{r:238,g:238,b:238,a:255,t:0,s:0},{r:221,g:221,b:221,a:255,t:0,s:0},{r:187,g:187,b:187,a:255,t:0,s:0},{r:170,g:170,b:170,a:255,t:0,s:0},{r:136,g:136,b:136,a:255,t:0,s:0},{r:119,g:119,b:119,a:255,t:0,s:0},{r:85,g:85,b:85,a:255,t:0,s:0},{r:68,g:68,b:68,a:255,t:0,s:0},{r:34,g:34,b:34,a:255,t:0,s:0},{r:17,g:17,b:17,a:255,t:0,s:0}],console.log("default palette");else{for(t=new Uint8Array(c.slice(r,r+s)),j=k=0,y=s;y>k;j=k+=4)q.push(255===t[j]&&0===t[j+1]&&255===t[j+2]?{r:255,g:0,b:255,a:250,t:7,s:7}:{r:t[j],g:t[j+1],b:t[j+2],a:255,t:0,s:0});console.log("palette:"),console.log(q)}for(a.voxels=[],F=new Uint32Array(c.slice(E,E+4))[0],console.log("voxel count: "+F),E+4+4*F!==G&&console.warn("invalid length of voxel chunk"),u=new Uint8Array(c.slice(E+4,E+4+4*F)),j=l=0,z=4*F;z>l;j=l+=4)null==a.voxels[u[j+1]]&&(a.voxels[u[j+1]]=[]),null==a.voxels[u[j+1]][u[j+2]]&&(a.voxels[u[j+1]][u[j+2]]=[]),D=q[u[j+3]-1],a.voxels[u[j+1]][u[j+2]][u[j]]={r:D.r,g:D.g,b:D.b,a:D.a,s:D.s,t:D.t};return console.log("voxels:"),console.log(a.voxels),b()}}(this),console.log("reading file with name: "+a.name),d.readAsArrayBuffer(a))}return b(c,a),c.prototype.export=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;for(e=[86,79,88,32,150,0,0,0,77,65,73,78,0,0,0,0],l=new Uint8Array(new Uint32Array([this.x]).buffer),E=l[0],F=l[1],G=l[2],H=l[3],m=new Uint8Array(new Uint32Array([this.z]).buffer),J=m[0],K=m[1],L=m[2],M=m[3],o=new Uint8Array(new Uint32Array([this.y]).buffer),O=o[0],P=o[1],Q=o[2],R=o[3],B=[83,73,90,69,12,0,0,0,0,0,0,0,E,F,G,H,J,K,L,M,O,P,Q,R],C=[],k=[82,71,66,65,0,4,0,0,0,0,0,0],f={},N=h=0,p=this.z;p>h;N=h+=1)for(I=i=0,q=this.y;q>i;I=i+=1)for(D=j=0,r=this.x;r>j;D=j+=1)if(null!=(null!=(s=this.voxels[N])&&null!=(t=s[I])?t[D]:void 0)){if(w=(this.voxels[N][I][D].r<<24|this.voxels[N][I][D].g<<16|this.voxels[N][I][D].b<<8|255)>>>0,g=f[w],null==g){if(!(k.length<1036))throw new Error("To many colors for Magica Voxel palette");k.push(this.voxels[N][I][D].r,this.voxels[N][I][D].g,this.voxels[N][I][D].b,255),g=k.length/4-3,f[w]=g}C.push(D,N,I,g)}for(;k.length<1036;)k.push(255,255,255,255);return u=new Uint8Array(new Uint32Array([1076+C.length]).buffer),x=u[0],y=u[1],z=u[2],A=u[3],e.push(x,y,z,A),e=e.concat(B),v=new Uint8Array(new Uint32Array([C.length+4]).buffer),x=v[0],y=v[1],z=v[2],A=v[3],n=new Uint8Array(new Uint32Array([C.length/4]).buffer),a=n[0],b=n[1],c=n[2],d=n[3],e.push(88,89,90,73,x,y,z,A,0,0,0,0,a,b,c,d),e=e.concat(C),e=e.concat(k),console.log("export Magica:"),console.log(e),URL.createObjectURL(new Blob([new Uint8Array(e)],{type:"application/octet-binary"}))},c}(IO),"object"==typeof module?module.exports=a:window.MagicaIO=a}.call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a,b){var d;c.__super__.constructor.call(this,a)||(this.voxels=[],d=new FileReader,d.onloadend=function(a){return function(){var c,e,f,g,h,i,j,k,l,m,n,o,p,q;for(e=JSON.parse(d.result),c=e.creator,a.x=e.width,a.y=e.height,a.z=e.depth,n=e.version,g=e.frames,console.log("creator: "+o),console.log("version: "+n+" (expected 1)"),console.log("frames: "+g+" (expected 1)"),console.log("dimensions: width : "+a.x+" height: "+a.y+" depth: "+a.z),console.log("frame data:"),f=h=1,k=g;k>=h;f=h+=1)for(console.log(e["frame"+f]),l=e["frame"+f],i=0,j=l.length;j>i;i++)m=l[i],o=m[0],p=m[1],q=m[2],c=m[3],null==a.voxels[q]&&(a.voxels[q]=[]),null==a.voxels[q][p]&&(a.voxels[q][p]=[]),a.voxels[q][p][o]={r:(4278190080&c)>>>24,g:(16711680&c)>>>16,b:(65280&c)>>>8,a:255,t:0,s:0},255===a.voxels[q][p][o].r&&0===a.voxels[q][p][o].g&&255===a.voxels[q][p][o].b&&(a.voxels[q][p][o]={r:255,g:0,b:255,a:250,t:7,s:7});return console.log("voxels:"),console.log(a.voxels),b()}}(this),console.log("reading file with name: "+a.name),d.readAsText(a))}return b(c,a),c.prototype.export=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(a=[],l=this.voxels,e=b=0,i=l.length;i>b;e=++b)if(o=l[e],null!=o)for(d=f=0,j=o.length;j>f;d=++f)if(n=o[d],null!=n)for(c=h=0,k=n.length;k>h;c=++h)m=n[c],null!=m&&a.push([c,d,e,(m.r<<24|m.g<<16|m.b<<8|255)>>>0]);return g={creator:"Troxel",width:this.x,height:this.y,depth:this.z,version:1,frames:1,frame1:a},console.log("Zoxel export:"),console.log(g),"data:application/octet-binary;base64,"+btoa(JSON.stringify(g))},c}(IO),"object"==typeof module?module.exports=a:window.ZoxelIO=a}.call(this),function(){"use strict";var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty,e=[].slice;a=function(a){function b(a){var c,d,f,g,h,i,j,k,l,m,n,o,p,q;if(!b.__super__.constructor.call(this,a)){for(this.voxels=[],j=atob(a).split("").map(function(a){return a.charCodeAt(0)}),this.x=j[0],this.y=j[1],this.z=j[2],this.readonly=j[3],c=5<=j.length?e.call(j,4):[],d=i=0,n={},q=f=0,k=this.z;k>f;q=f+=1)for(p=g=0,l=this.y;l>g;p=g+=1)for(o=h=0,m=this.x;m>h;o=h+=1){if(0===i){if(c[d]>127?(i=c[d]-127,d++):i=1,c[d]>127)throw new Error("Base64 parsing error");c[d]<64?(n={r:c[d+1],g:c[d+2],b:c[d+3],a:c[d+4],s:c[d]%8,t:c[d]>>3},d+=5):(n=null,d++)}null!=n&&(null==this.voxels[q]&&(this.voxels[q]=[]),null==this.voxels[q][p]&&(this.voxels[q][p]=[]),this.voxels[q][p][o]={r:n.r,g:n.g,b:n.b,a:n.a,s:n.s,t:n.t}),i--}d!==c.length&&console.warn("There shouldn't be any bytes left"),this.readonly||console.log("voxels:"),this.readonly||console.log(this.voxels)}}return c(b,a),b.prototype.export=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(c=function(a,b,c){var d,e,f,g;if(!(c<n.length))return!1;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;for(g=["r","g","b","a","t","s"],e=0,f=g.length;f>e;e++)if(d=g[e],a[d]!==b[d])return!1;return!0},b=[this.x,this.y,this.z,a?1:0],n=[],q=e=0,i=this.z;i>e;q=e+=1)for(p=f=0,j=this.y;j>f;p=f+=1)for(o=g=0,k=this.x;k>g;o=g+=1)n.push(null!=(l=this.voxels[q])&&null!=(m=l[p])?m[o]:void 0);for(d=0;d<n.length;){for(h=1;128>h&&c(n[d+h-1],n[d+h],d+h);)h++;h>1&&b.push(127+h),null!=n[d]?b.push(8*n[d].t+n[d].s,n[d].r,n[d].g,n[d].b,n[d].a):b.push(64),d+=h}return console.log("export base64:"),console.log(b),btoa(String.fromCharCode.apply(null,b))},b}(IO),b=function(a){function b(a){var c;b.__super__.constructor.call(this,a)||(c=JSON.parse(a),this.x=c.x,this.y=c.y,this.z=c.z,this.voxels=c.voxels)}return c(b,a),b.prototype.export=function(a){return JSON.stringify({x:this.x,y:this.y,z:this.z,voxels:this.voxels},null,a?"    ":"")
},b}(IO),("undefined"!=typeof exports&&null!==exports?exports:window).Base64IO=a,("undefined"!=typeof exports&&null!==exports?exports:window).JsonIO=b}.call(this),function(){"use strict";var a;a=function(){function a(a,b,c,d){var e,f,g,h,i,j,k,l,m;if(this.embedded=null!=b?b:!1,this.domContainer=null!=c?c:$("#WebGlContainer"),null==d&&(d=!0),this.width=this.domContainer.width(),this.height=this.domContainer.height()-(this.embedded?0:5),this.scene=new THREE.Scene,this.reload(a.voxels,a.x,a.y,a.z,!1,!0),this.ambientLight=new THREE.AmbientLight(6316128),this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(16777215,.3),this.directionalLight.position.set(-.5,-.5,1).normalize(),this.scene.add(this.directionalLight),this.spotLight=new THREE.SpotLight(16777215,.7,1e5),this.spotLightTarget=new THREE.Object3D,this.spotLightTarget.position.x=25*this.z,this.spotLightTarget.position.y=25*this.y,this.spotLightTarget.position.z=25*this.x,this.scene.add(this.spotLightTarget),this.spotLight.target=this.spotLightTarget,this.scene.add(this.spotLight),this.renderer=new THREE.WebGLRenderer({antialias:d}),this.renderer.setClearColor(8947848),this.renderer.setSize(this.width,this.height),this.domContainer.empty().append(this.renderer.domElement),this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e5),h=0,this.embedded){for(h=this.y,m=f=0,i=this.z;i>f;m=f+=1)if(null!=this.voxels[m])for(l=g=0,j=this.y;j>g;l=g+=1)if(null!=(null!=(k=this.voxels[m])?k[l]:void 0)){h=Math.min(h,l);break}e=Math.max(this.x,this.y-h,this.z),this.camera.position.x=-80*e,this.camera.position.y=50*(e+h),this.camera.position.z=25*e}else this.camera.position.x=-50*this.y-20*this.x-10*this.z,this.camera.position.y=50*this.y,this.camera.position.z=25*this.x;this.controls=new THREE.OrbitControls(this.camera,this.domContainer[0]),this.controls.target=new THREE.Vector3(25*this.z,25*(this.y+h),25*this.x),this.controls.noKeys=!0,this.controls.addEventListener("change",function(a){return function(){return a.render()}}(this)),document.addEventListener("keydown",function(a){return function(b){return a.onDocumentKeyDown(b)}}(this)),window.addEventListener("resize",function(a){return function(b){return a.onWindowResize(b)}}(this)),this.embedded&&this.animate()}return a.prototype.getMaterial=function(a,b,c,d){var e;return e=new THREE.MeshPhongMaterial({color:a,ambient:a}),(3===c||4===c)&&(e.emissive=e.color.multiplyScalar(.5)),1===d&&(e.specular=e.color.multiplyScalar(.5)),(1===c||2===c||4===c)&&(e.transparent=!0,e.opacity=b/255),e},a.prototype.reload=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$;for(this.voxels=a,this.x=b,this.y=c,this.z=d,l=new THREE.Matrix4,p=new THREE.PlaneGeometry(50,50),p.applyMatrix(l.makeRotationY(Math.PI/2)),p.applyMatrix(l.makeTranslation(25,0,0)),m=new THREE.PlaneGeometry(50,50),m.applyMatrix(l.makeRotationY(-Math.PI/2)),m.applyMatrix(l.makeTranslation(-25,0,0)),q=new THREE.PlaneGeometry(50,50),q.applyMatrix(l.makeRotationX(-Math.PI/2)),q.applyMatrix(l.makeTranslation(0,25,0)),n=new THREE.PlaneGeometry(50,50),n.applyMatrix(l.makeRotationX(Math.PI/2)),n.applyMatrix(l.makeTranslation(0,-25,0)),r=new THREE.PlaneGeometry(50,50),r.applyMatrix(l.makeTranslation(0,0,25)),o=new THREE.PlaneGeometry(50,50),o.applyMatrix(l.makeRotationY(Math.PI)),o.applyMatrix(l.makeTranslation(0,0,-25)),f=new THREE.Geometry,k=[],X=[],$=g=0,s=this.z;s>g;$=g+=1)if(null!=this.voxels[$])for(Z=h=0,t=this.y;t>h;Z=h+=1)if(null!=(null!=(E=this.voxels[$])?E[Z]:void 0))for(Y=i=0,P=this.x;P>i;Y=i+=1)null!=(null!=(R=this.voxels[$])&&null!=(S=R[Z])?S[Y]:void 0)&&(e=new THREE.Color("rgb("+this.voxels[$][Z][Y].r+","+this.voxels[$][Z][Y].g+","+this.voxels[$][Z][Y].b+")"),j=null,null!=(null!=(T=X[e.getHex()])?T[this.voxels[$][Z][Y].a+256*this.voxels[$][Z][Y].t+2048*this.voxels[$][Z][Y].s]:void 0)?j=X[e.getHex()][this.voxels[$][Z][Y].a+256*this.voxels[$][Z][Y].t+2048*this.voxels[$][Z][Y].s]:(j=k.length,k.push(this.getMaterial(e,this.voxels[$][Z][Y].a,this.voxels[$][Z][Y].t,this.voxels[$][Z][Y].s)),null==X[e.getHex()]&&(X[e.getHex()]=[]),X[e.getHex()][this.voxels[$][Z][Y].a+256*this.voxels[$][Z][Y].t+2048*this.voxels[$][Z][Y].s]=j),l.makeTranslation(50*$+25,50*Z+25,50*Y+25),(null==(null!=(U=this.voxels[$+1])&&null!=(V=U[Z])?V[Y]:void 0)||(1===(W=this.voxels[$+1][Z][Y].t)||2===W||4===W)&&1!==(u=this.voxels[$][Z][Y].t)&&2!==u&&4!==u)&&f.merge(p,l,j),(null==(null!=(v=this.voxels[$-1])&&null!=(w=v[Z])?w[Y]:void 0)||(1===(x=this.voxels[$-1][Z][Y].t)||2===x||4===x)&&1!==(y=this.voxels[$][Z][Y].t)&&2!==y&&4!==y)&&f.merge(m,l,j),(null==(null!=(z=this.voxels[$])&&null!=(A=z[Z+1])?A[Y]:void 0)||(1===(B=this.voxels[$][Z+1][Y].t)||2===B||4===B)&&1!==(C=this.voxels[$][Z][Y].t)&&2!==C&&4!==C)&&f.merge(q,l,j),(null==(null!=(D=this.voxels[$])&&null!=(F=D[Z-1])?F[Y]:void 0)||(1===(G=this.voxels[$][Z-1][Y].t)||2===G||4===G)&&1!==(H=this.voxels[$][Z][Y].t)&&2!==H&&4!==H)&&f.merge(n,l,j),(null==(null!=(I=this.voxels[$])&&null!=(J=I[Z])?J[Y+1]:void 0)||(1===(K=this.voxels[$][Z][Y+1].t)||2===K||4===K)&&1!==(L=this.voxels[$][Z][Y].t)&&2!==L&&4!==L)&&f.merge(r,l,j),(null==(null!=(M=this.voxels[$])&&null!=(N=M[Z])?N[Y-1]:void 0)||(1===(O=this.voxels[$][Z][Y-1].t)||2===O||4===O)&&1!==(Q=this.voxels[$][Z][Y].t)&&2!==Q&&4!==Q)&&f.merge(o,l,j));return this.mesh=new THREE.Mesh(f,new THREE.MeshFaceMaterial(k)),this.scene.add(this.mesh)},a.prototype.animate=function(){return requestAnimationFrame(function(a){return function(){return a.animate()}}(this)),this.controls.update(),this.embedded?void 0:this.stats.update()},a.prototype.render=function(a){return this.spotLight.position.copy(this.camera.position),this.renderer.render(this.scene,this.camera),a?window.open(this.renderer.domElement.toDataURL("image/png"),"Exported png"):void 0},a.prototype.onDocumentKeyDown=function(a){switch(a.keyCode){case 87:return this.controls.rotateUp(-.05);case 65:return this.controls.rotateLeft(-.05);case 83:return this.controls.rotateUp(.05);case 68:return this.controls.rotateLeft(.05);case 81:return this.controls.dollyIn();case 69:return this.controls.dollyOut();case 37:return this.controls.pan(7,0);case 38:return this.controls.pan(0,7);case 39:return this.controls.pan(-7,0);case 40:return this.controls.pan(0,-7);default:return!0}},a.prototype.onWindowResize=function(){return this.width=this.domContainer.width(),this.height=this.domContainer.height()-(this.embedded?0:5),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.render()},a}(),"object"==typeof module?module.exports=a:window.Renderer=a}.call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty,d=function(a,b){return(+a%(b=+b)+b)%b},e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(a){function c(a,b,d){this.embedded=null!=b?b:!1,this.domContainer=null!=d?d:$("#WebGlContainer"),this.objects=[],c.__super__.constructor.call(this,a,this.embedded,this.domContainer,"1"===$("#rendererAntialias").val()),this.rollOverMesh=new THREE.Mesh(new THREE.BoxGeometry(48,48,48),new THREE.MeshBasicMaterial({wireframe:!0,color:0})),this.scene.add(this.rollOverMesh),this.vector=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.setupGrid(),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.domContainer.append(this.stats.domElement),this.changeEditMode($("#modeEdit").parent().hasClass("active")),this.domContainer.on("mousedown",function(a){return function(b){return a.onDocumentMouseDown(b)}}(this)),this.domContainer.on("mousemove",function(a){return function(b){return a.onDocumentMouseMove(b)}}(this)),document.addEventListener("keyup",function(a){return function(b){return a.onDocumentKeyUp(b)}}(this)),this.animate()}return b(c,a),c.prototype.setupGrid=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(this.planes=[],a=new THREE.PlaneBufferGeometry(50*this.x,50*this.y),a.applyMatrix((new THREE.Matrix4).makeRotationY(-Math.PI/2)),f=new THREE.Mesh(a),f.position.x=50*this.z,f.position.y=25*this.y,f.position.z=25*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),a=new THREE.PlaneBufferGeometry(50*this.z,50*this.x),a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),f=new THREE.Mesh(a),f.position.x=25*this.z,f.position.z=25*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),a=new THREE.PlaneBufferGeometry(50*this.y,50*this.z),a.applyMatrix((new THREE.Matrix4).makeRotationZ(-Math.PI/2)),f=new THREE.Mesh(a),f.position.x=25*this.z,f.position.y=25*this.y,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),a=new THREE.Geometry,j=b=0,g=this.x;g>=b;j=b+=1)a.vertices.push(new THREE.Vector3(0,0,50*j)),a.vertices.push(new THREE.Vector3(50*this.z,0,50*j)),a.vertices.push(new THREE.Vector3(50*this.z,0,50*j)),a.vertices.push(new THREE.Vector3(50*this.z,50*this.y,50*j));for(k=c=0,h=this.y;h>=c;k=c+=1)a.vertices.push(new THREE.Vector3(0,50*k,0)),a.vertices.push(new THREE.Vector3(50*this.z,50*k,0)),a.vertices.push(new THREE.Vector3(50*this.z,50*k,0)),a.vertices.push(new THREE.Vector3(50*this.z,50*k,50*this.x));for(l=d=0,i=this.z;i>=d;l=d+=1)a.vertices.push(new THREE.Vector3(50*l,0,0)),a.vertices.push(new THREE.Vector3(50*l,0,50*this.x)),a.vertices.push(new THREE.Vector3(50*l,0,0)),a.vertices.push(new THREE.Vector3(50*l,50*this.y,0));return e=new THREE.LineBasicMaterial({color:0,opacity:.2,transparent:!0}),this.grid=new THREE.Line(a,e,THREE.LinePieces),this.scene.add(this.grid)},c.prototype.changeEditMode=function(a){return this.editMode=a,this.editMode?(this.grid.visible=!0,this.rollOverMesh.visible=!0,this.controls.enabled=!1):(this.grid.visible=!1,this.rollOverMesh.visible=!1,this.controls.enabled=!0),this.render()},c.prototype.reload=function(a,b,d,e,f,g){var h,i,j,k;if(this.voxels=a,this.x=b,this.y=d,this.z=e,null==f&&(f=!1),null==g&&(g=!1),f){for(k=this.planes,h=0,i=k.length;i>h;h++)j=k[h],this.scene.remove(j);this.scene.remove(this.grid),this.setupGrid(),this.spotLightTarget.position.x=25*this.z,this.spotLightTarget.position.y=25*this.y,this.spotLightTarget.position.z=25*this.x,this.spotLight.target=this.spotLightTarget,this.camera.position.x=-50*this.y-20*this.x-10*this.z,this.camera.position.y=50*this.y,this.camera.position.z=25*this.x,this.controls.target=new THREE.Vector3(25*this.z,25*this.y,25*this.x),this.changeEditMode($("#modeEdit").parent().hasClass("active"))}return g||(this.scene.remove(this.mesh),this.objects=this.planes.slice(0)),c.__super__.reload.call(this,this.voxels,this.x,this.y,this.z),this.objects.push(this.mesh),g?void 0:this.render()},c.prototype.onDocumentMouseMove=function(a){var b,c;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display"))return a.preventDefault(),this.vector.set(a.clientX/this.width*2-1,2*-((a.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),c=this.raycaster.intersectObjects(this.objects),c.length>0&&(b=c[0],this.rollOverMesh.position.copy(b.point).add(b.face.normal),this.rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)),this.render()},c.prototype.onDocumentMouseDown=function(a){var b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display")&&(i=function(a,b,c){var e;return b>0&&(a.multiplyScalar(2*Math.random()*b+1-b),a.r>1&&(a.r=1),a.g>1&&(a.g=1),a.b>1&&(a.b=1)),c>0&&(e=a.getHSL(),e.h=d(e.h+.1*(2*Math.random()*c-c),1),e.s=Math.max(0,Math.min(1,e.s+2*Math.random()*c-c)),e.l=Math.max(0,Math.min(1,e.l+2*Math.random()*c-c)),a.setHSL(e.h,e.s,e.l)),a},this.vector.set(a.clientX/this.width*2-1,2*-((a.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),l=this.raycaster.intersectObjects(this.objects),l.length>0)){switch(k=l[0],a.button){case 0:switch($(".active .editTool").data("edittool")){case 0:if(f=i(new THREE.Color($("#addVoxColor").val()),parseFloat($("#editVoxNoiseBright").val(),parseFloat($("#editVoxNoiseHSL").val()))),b=parseInt($("#addVoxAlpha").val()),D=parseInt($("#addVoxType").val()),C=parseInt($("#addVoxSpecular").val()),(0===D||3===D)&&(b=255),"#ff00ff"===$("#addVoxColor").val()&&(b=250,D=C=7),k.point.add(k.face.normal).divideScalar(50).floor(),H=k.point.z,I=k.point.y,J=k.point.x,!(H>=0&&H<this.x&&I>=0&&I<this.y&&J>=0&&J<this.z))return;null==this.voxels[J]&&(this.voxels[J]=[]),null==this.voxels[J][I]&&(this.voxels[J][I]=[]),this.voxels[J][I][H]={r:Math.floor(255*f.r),g:Math.floor(255*f.g),b:Math.floor(255*f.b),a:b,t:D,s:C};break;case 1:if(r=k.object,e.call(this.planes,r)>=0)return;k.point.add(k.face.normal).divideScalar(50).floor().sub(k.face.normal),H=k.point.z,I=k.point.y,J=k.point.x,f=i(new THREE.Color($("#addVoxColor").val()),parseFloat($("#editVoxNoiseBright").val(),parseFloat($("#editVoxNoiseHSL").val()))),b=parseInt($("#addVoxAlpha").val()),D=parseInt($("#addVoxType").val()),C=parseInt($("#addVoxSpecular").val()),(0===D||3===D)&&(b=255),1===f.r&&0===f.g&&1===f.b&&(b=250,D=C=7),this.voxels[J][I][H].r=Math.floor(255*f.r),this.voxels[J][I][H].g=Math.floor(255*f.g),this.voxels[J][I][H].b=Math.floor(255*f.b),this.voxels[J][I][H].a=b,this.voxels[J][I][H].t=D,this.voxels[J][I][H].s=C}break;case 2:if(s=k.object,e.call(this.planes,s)>=0)return;switch(k.point.add(k.face.normal).divideScalar(50).floor().sub(k.face.normal),H=k.point.z,I=k.point.y,J=k.point.x,$(".active .editTool").data("edittool")){case 0:delete this.voxels[J][I][H],0===this.voxels[J][I].filter(function(a){return void 0!==a}).length&&delete this.voxels[J][I],0===this.voxels[J].filter(function(a){return void 0!==a}).length&&delete this.voxels[J];break;case 1:if(h=function(a,b,c){var d,e;return null!=(null!=(d=this.voxels[a])&&null!=(e=d[b])?e[c]:void 0)&&!this.voxels[a][b][c].filled&&(!g||F.r===this.voxels[a][b][c].r&&F.g===this.voxels[a][b][c].g&&F.b===this.voxels[a][b][c].b&&F.a===this.voxels[a][b][c].a&&F.t===this.voxels[a][b][c].t&&F.s===this.voxels[a][b][c].s)},c=$("#addVoxColor").val(),p=parseFloat($("#editVoxNoiseBright").val()),q=parseFloat($("#editVoxNoiseHSL").val()),g=$("#fillSameColor").prop("checked"),b=parseInt($("#addVoxAlpha").val()),D=parseInt($("#addVoxType").val()),C=parseInt($("#addVoxSpecular").val()),(0===D||3===D)&&(b=255),"#ff00ff"===c)return;for(E=[[J,I,H]],this.voxels[J][I][H].filled=!0;E.length>0;)u=E.pop(),J=u[0],I=u[1],H=u[2],F={r:this.voxels[J][I][H].r,g:this.voxels[J][I][H].g,b:this.voxels[J][I][H].b,a:this.voxels[J][I][H].a,t:this.voxels[J][I][H].t,s:this.voxels[J][I][H].s},f=i(new THREE.Color(c),p,q),this.voxels[J][I][H].r=Math.floor(255*f.r),this.voxels[J][I][H].g=Math.floor(255*f.g),this.voxels[J][I][H].b=Math.floor(255*f.b),1===f.r&&0===f.g&&1===f.b&&(this.voxels[J][I][H].g=1),this.voxels[J][I][H].a=b,this.voxels[J][I][H].t=D,this.voxels[J][I][H].s=C,h.call(this,J,I,H+1)&&(this.voxels[J][I][H+1].filled=!0,E.push([J,I,H+1])),h.call(this,J,I,H-1)&&(this.voxels[J][I][H-1].filled=!0,E.push([J,I,H-1])),h.call(this,J,I+1,H)&&(this.voxels[J][I+1][H].filled=!0,E.push([J,I+1,H])),h.call(this,J,I-1,H)&&(this.voxels[J][I-1][H].filled=!0,E.push([J,I-1,H])),h.call(this,J+1,I,H)&&(this.voxels[J+1][I][H].filled=!0,E.push([J+1,I,H])),h.call(this,J-1,I,H)&&(this.voxels[J-1][I][H].filled=!0,E.push([J-1,I,H]));for(J=j=0,v=this.z;v>j;J=j+=1)if(null!=this.voxels[J])for(I=n=0,w=this.y;w>n;I=n+=1)if(null!=(null!=(x=this.voxels[J])?x[I]:void 0))for(H=o=0,y=this.x;y>o;H=o+=1)null!=(null!=(z=this.voxels[J])&&null!=(A=z[I])?A[H]:void 0)&&this.voxels[J][I][H].filled&&delete this.voxels[J][I][H].filled}break;case 1:if(B=k.object,e.call(this.planes,B)>=0)return;return k.point.add(k.face.normal).divideScalar(50).floor().sub(k.face.normal),H=k.point.z,I=k.point.y,J=k.point.x,G=this.voxels[J][I][H],$("#addVoxColor").val("#"+new THREE.Color("rgb("+G.r+","+G.g+","+G.b+")").getHexString()),G.r===(t=G.b)&&255===t&&0===G.g?$("#addVoxColor").change():($("#addVoxAlpha").val(G.a),$("#addVoxType").val(G.t),$("#addVoxSpecular").val(G.s),$("#addVoxColor").change())}return m={voxels:this.voxels,x:this.x,y:this.y,z:this.z},this.reload(this.voxels,this.x,this.y,this.z),history.pushState(m,"Troxel","#m="+new Base64IO(m).export(!1)),this.render()}},c.prototype.onDocumentKeyDown=function(a){if(null!=c.__super__.onDocumentKeyDown.call(this,a)&&1!==$(".active #modeView").length)switch(a.keyCode){case 18:return this.controls.enabled=!0,this.editMode=!1}},c.prototype.onDocumentKeyUp=function(a){if(1!==$(".active #modeView").length)switch(a.keyCode){case 18:return this.controls.enabled=!1,this.editMode=!0}},c}(Renderer),"object"==typeof module?module.exports=a:window.Editor=a}.call(this),function(){"use strict";var a,b,c,d;c=null,a=null,b=null,window.applicationCache.status!==window.applicationCache.UNCACHED&&(window.applicationCache.addEventListener("updateready",function(){return window.applicationCache.status===window.applicationCache.UPDATEREADY?($.ajax({url:"static/Recent_Changes.html",cache:!1}).done(function(a){return $("#recentChangesDiv").prepend(a)}),$("#updateModal").modal("show"),clearInterval(d)):void 0}),d=setInterval(function(){return window.applicationCache.update()},3e5)),$("#updateLater").click(function(){return d=setInterval(function(){return window.applicationCache.update()},parseInt($("#remindUpdateTime").val())),$("#updateModal").modal("hide")}),window.onpopstate=function(a){var d,e,f,g,h,i,j,k,l;if(null!=(null!=a?a.state:void 0))return j=null!=c,k=c.x!==a.state.x||c.y!==a.state.y||c.z!==a.state.z,c=new IO(a.state),null==c.readonly||0===c.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),j?b.reload(c.voxels,c.x,c.y,c.z,k):b=new Editor(c);for(c=null,h=decodeURI(window.location.hash).replace("#","").split("&"),e=0,f=h.length;f>e;e++){if(d=h[e],i=d.split("="),g=i[0],l=i[1],"m"===g){c=new Base64IO(l),1===c.readonly&&$("#btnExport").hide(),0===c.readonly&&$("#btnExport").show(),$("#btnExportPng").show(),b=new Editor(c);break}if("b"===g){$.getJSON("static/Trove.json",function(a){var d;return d=a[l],null!=d?(c=new Base64IO(d),$("#btnExport").hide(),$("#btnExportPng").show(),b=new Editor(c)):void 0});break}}return null==c?$("#WebGlContainer").empty():void 0},window.onpopstate(),$('input[type="file"]').change(function(){var b,c,d,e;if($(this).prop("files").length>1){for(a=$(this).prop("files"),$("#filetabs li:last a").tab("show"),$("#tabdrag ul").empty(),e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push($("#tabdrag ul").append($("<li>"+b.name+"</li>")));return e}}),document.addEventListener("dragover",function(a){return a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}),document.addEventListener("drop",function(b){var c,d,e,f;if(b.stopPropagation(),b.preventDefault(),a=b.dataTransfer.files,a.length>0){for($("#openModal").modal("show"),$("#dragTab").click(),$("#tabdrag ul").empty(),f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push($("#tabdrag ul").append($("<li>"+c.name+"</li>")));return f}}),$("#open").click(function(){var d,e,f,g,h,i,j,k,l,m,n,o,p;switch(g=function(){return $("#openModal").modal("hide"),$("#modeEdit").parent().hasClass("active")&&$("#modeView").click(),null==c.readonly||0===c.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),null!=b?b.reload(c.voxels,c.x,c.y,c.z,!0):b=new Editor(c),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Troxel","#m="+new Base64IO(c).export(!1))},console.log("##################################################"),$("#filetabs li.active a").attr("href")){case"#tabdrag":if("zox"===a[0].name.split(".").pop())c=new ZoxelIO(a[0],g);else if("vox"===a[0].name.split(".").pop())c=new MagicaIO(a[0],g);else if("qb"===a[0].name.split(".").pop()){for(i={},j=k=0,l=a.length;l>k;j=++k)switch(h=a[j],h.name.substr(-5)){case"_a.qb":null==i.a&&(i.a=h);break;case"_t.qb":null==i.t&&(i.t=h);break;case"_s.qb":null==i.s&&(i.s=h);break;default:".qb"===h.name.substr(-3)&&(i.m=h)}null!=i.m?c=new QubicleIO(i,g):alert("Can't find Qubicle main mesh file!")}else alert("Can't import selected file format.");break;case"#tabqb":h=$("#fqb").prop("files")[0],h&&"qb"===h.name.split(".").pop()?c=new QubicleIO({m:h,a:h=$("#fqba").prop("files")[0],t:h=$("#fqbt").prop("files")[0],s:h=$("#fqbs").prop("files")[0]},g):alert("Please choose at least a valid main mesh Qubicle (.qb) file above!");break;case"#tabvox":h=$("#fvox").prop("files")[0],h&&"vox"===h.name.split(".").pop()?c=new MagicaIO(h,g):alert("Please choose a valid Magica Voxel (.vox) file above!");break;case"#tabzox":h=$("#fzox").prop("files")[0],h&&"zox"===h.name.split(".").pop()?c=new ZoxelIO(h,g):alert("Please choose a valid Zoxel (.zox) file above!");break;case"#tabjson":c=new JsonIO($("#sjson").val()),g();break;case"#tabtrove":$.getJSON("static/Trove.json",function(a){var d;return d=a[$("#sbtrove").val()],null!=d?(c=new Base64IO(d),$("#openModal").modal("hide"),$("#modeEdit").parent().hasClass("active")&&$("#modeView").click(),$("#btnExport").hide(),$("#btnExportPng").show(),null!=b?b.reload(c.voxels,c.x,c.y,c.z,!0):b=new Editor(c),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Troxel","#b="+$("#sbtrove").val())):void 0});break;case"#tabnew":n=parseInt($("#snewX").val()),o=parseInt($("#snewY").val()),p=parseInt($("#snewZ").val()),m=[],$("#cbnewAp").prop("checked")&&(d=parseInt($("#snewApX").val()),e=parseInt($("#snewApY").val()),f=parseInt($("#snewApZ").val()),n>d&&o>e&&p>f&&(m[f]=[],m[f][e]=[],m[f][e][d]={r:255,g:0,b:255,a:250,t:7,s:7})),c=new IO({x:n,y:o,z:p,voxels:m}),g(),$("#modeEdit").click()}}),$("#openTroveTab").click(function(){var a,b;return b=0,a=new Bloodhound({datumTokenizer:function(a){return a.value.split(/[\[,\],_]/i)},queryTokenizer:function(a){return a.split(/[\s,_]/i)},limit:1e4,prefetch:{url:"static/Trove.json",cacheKey:"TroveBlueprintCache",filter:function(a){return $.map(a,function(a,b){return{value:b}})}}}),a.initialize(),$("#sbtrove").typeahead({highlight:!0,minLength:2,hint:!1},{name:"troveBlueprints",source:a.ttAdapter()})}),$(".snewApPos").prop("disabled",!0),$("#cbnewAp").prop("checked",!1).change(function(){return $(".snewApPos").prop("disabled",!$(this).prop("checked"))}),$("#btnExport").click(function(){return $("#exportQb").text("Export as Qubicle (.qb) ...").removeAttr("href"),$("#exportQba").hide().removeAttr("href"),$("#exportQbt").hide().removeAttr("href"),$("#exportQbs").hide().removeAttr("href"),$("#exportZox").text("Export as Zoxel (.zox) ...").removeAttr("href"),$("#exportVox").text("Export as Magica Voxel (.vox) ...").removeAttr("href"),$("#exportBase64Ta").hide(),$("#exportJsonTa").hide()}),$("#exportQb").click(function(){var a,b,d,e,f,g;if(!c.readonly)return null==$(this).attr("href")?(g=new QubicleIO(c).export($("#exportQbComp").prop("checked")),b=g[0],d=g[1],f=g[2],e=g[3],a=$("#exportFilenameQb").val()||"Model",$(this).text("Download main mash (.qb)").attr("download",a+".qb").attr("href",b),$("#exportQba").show().attr("download",a+"_a.qb").attr("href",d),$("#exportQbt").show().attr("download",a+"_t.qb").attr("href",f),$("#exportQbs").show().attr("download",a+"_s.qb").attr("href",e)):void 0}),$("#exportZox").click(function(){var a;if(!c.readonly)return a=$("#exportFilenameZox").val()||"Model",null==$(this).attr("href")?$(this).text("Download as Zoxel (.zox)").attr("download",a+".zox").attr("href",new ZoxelIO(c).export()):void 0}),$("#exportVox").click(function(){var a;if(!c.readonly)return a=$("#exportFilenameVox").val()||"Model",null==$(this).attr("href")?$(this).text("Download as Magica Voxel (.vox)").attr("download",a+".vox").attr("href",new MagicaIO(c).export()):void 0}),$("#exportBase64").click(function(){return c.readonly?void 0:$("#exportBase64Ta").val(window.location.toString().split("#")[0]+"#m="+new Base64IO(c).export($("#exportBase64Ro").prop("checked"))).fadeIn()}),$("#exportJson").click(function(){return c.readonly?void 0:$("#exportJsonTa").val(new JsonIO(c).export($("#exportJsonPret").prop("checked"))).fadeIn()}),$("#btnExportPng").click(function(){return b.render(!0)}),$("#ulSavedModels").parent().on("show.bs.dropdown",function(a){var d,e,f,g;if("#ulSavedModels"===$(a.relatedTarget).data("tag")){for(null==c||1===c.readonly?$(this).find("a[data-target=#saveModal]").prop("disabled",!0).parent().addClass("disabled"):$(this).find("a[data-target=#saveModal]").prop("disabled",!1).parent().removeClass("disabled"),$("#ulSavedModels li:gt(6)").remove(),d=e=0,g=window.localStorage.length;g>e;d=e+=1)f=window.localStorage.key(d),0!==f.indexOf("__")&&$("#ulSavedModels").append("<li><a class='openSavedModel' data-model='"+window.localStorage.getItem(f)+"'>"+f+"</a></li>");0===$(".openSavedModel").length&&$("#ulSavedModels").append('<li class="disabled"><a>No saved models</a></li>')}return $(".openSavedModel").click(function(){return c=new Base64IO($(this).data("model")),(null==c.readonly||0===c.readonly)&&$("#btnExport").show(),$("#btnExportPng").show(),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Toxel","#m="+$(this).data("model")),null!=b?b.reload(c.voxels,c.x,c.y,c.z,!0):b=new Editor(c),$("#ulSavedModels li:eq(1) a").text($(this).text())})}),$("#saveModelAs").click(function(){return 0===$("#saveModelName").val().length||null==c||c.readonly?void 0:(window.localStorage.setItem($("#saveModelName").val(),new Base64IO(c).export(c.readonly)),$("#saveModal").modal("hide"))}),$("#modeView").click(function(){return $(this).parent().addClass("active"),$("#modeEdit").parent().removeClass("active"),b.changeEditMode(!1),$("#addPanel").fadeOut()}),$("#modeEdit").click(function(){return null==c||c.readonly?void 0:($(this).parent().addClass("active"),$("#modeView").parent().removeClass("active"),b.changeEditMode(!0),$("#addPanel").fadeIn())}),$(".rotateBtn").click(function(){if(null!=c){switch($(this).data("rotate")){case"x":c.rotateX(!0);break;case"-x":c.rotateX(!1);break;case"y":c.rotateY(!0);break;case"-y":c.rotateY(!1);break;case"z":c.rotateZ(!0);break;case"-z":c.rotateZ(!1)}return b.reload(c.voxels,c.x,c.y,c.z,!0),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Troxel","#m="+new Base64IO(c).export(!1))}}),$(".moveBtn").click(function(){if(null!=c){switch($(this).data("move")){case"x":c.moveX(!0,!0);break;case"-x":c.moveX(!1,!0);break;case"y":c.moveY(!0,!0);break;case"-y":c.moveY(!1,!0);break;case"z":c.moveZ(!0,!0);break;case"-z":c.moveZ(!1,!0)}return b.reload(c.voxels,c.x,c.y,c.z),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Troxel","#m="+new Base64IO(c).export(!1))}}),$(".mirrorBtn").click(function(){if(null!=c){switch($(this).data("mirror")){case"x":c.mirrorX(!0);break;case"y":c.mirrorY(!0);break;case"z":c.mirrorZ(!0)}return b.reload(c.voxels,c.x,c.y,c.z),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Troxel","#m="+new Base64IO(c).export(!1))}}),$(".panel-heading").click(function(){var a;return a=$(this).find("button span"),a.hasClass("glyphicon-minus")?a.removeClass("glyphicon-minus").addClass("glyphicon-plus"):a.removeClass("glyphicon-plus").addClass("glyphicon-minus"),$(this).next().toggle()}),$("#ambLightColor").val("#606060").change(function(){return null!=c?(b.ambientLight.color=new THREE.Color($(this).val()),b.render()):void 0}),$("#dirLightColor").val("#ffffff").change(function(){return null!=c?(b.directionalLight.color=new THREE.Color($(this).val()),b.render()):void 0}),$("#dirLightIntensity").val(.3).change(function(){return null!=c?(b.directionalLight.intensity=$(this).val(),b.render()):void 0}),$("#spotLightColor").val("#ffffff").change(function(){return null!=c?(b.spotLight.color=new THREE.Color($(this).val()),b.render()):void 0}),$("#spotLightIntensity").val(.7).change(function(){return null!=c?(b.spotLight.intensity=$(this).val(),b.render()):void 0}),$("#dirLightX").val("-0.5"),$("#dirLightY").val("-0.5"),$("#dirLightZ").val("1"),$("#dirLightVector").click(function(){return null!=c?(b.directionalLight.position.set(parseFloat($("#dirLightX").val()),parseFloat($("#dirLightY").val()),parseFloat($("#dirLightZ").val())).normalize(),b.render()):void 0}),$("#addVoxAP").click(function(){return $("#addVoxColor").val("#ff00ff"),$("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0)}),$("#addVoxColor").change(function(){switch($(this).val()){case"#ff00ff":return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0);default:return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!1),$("#addVoxType").change()}}),$("#addVoxType").change(function(){switch(parseInt($(this).val())){case 1:case 2:case 4:return $("#addVoxAlpha").prop("disabled",!1);case 0:case 3:return $("#addVoxAlpha").prop("disabled",!0)}}),$("#addVoxAlpha").val(112),$("#editVoxNoiseBright").val(0),$("#editVoxNoiseHSL").val(0),$("#openResizeModal").click(function(){return null!=c?($("#resizeX").val(c.x),$("#resizeY").val(c.y),$("#resizeZ").val(c.z)):void 0}),$("#resizeBtn").click(function(){return null==c||c.readonly?void 0:($("#resizeModal").modal("hide"),c.resize(parseInt($("#resizeX").val()),parseInt($("#resizeY").val()),parseInt($("#resizeZ").val())),b.reload(c.voxels,c.x,c.y,c.z,!0),history.pushState({voxels:c.voxels,x:c.x,y:c.y,z:c.z},"Troxel","#m="+new Base64IO(c).export(!1)))}),$($(".editTool")[0]).parent().button("toggle"),$("#fillSameColor").prop("checked",!0),$(".editTool").change(function(){switch($(this).data("edittool")){case 1:return $("#fillSameColorDiv").show();default:return $("#fillSameColorDiv").hide()}}),$('[data-toggle="tooltip"]').tooltip(),$("#rendererAntialias").change(function(){return null!=c?b=new Editor(c):void 0})}.call(this);